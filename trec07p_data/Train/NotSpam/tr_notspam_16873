From samba-technical-bounces+ktwarwic=speedy.uwaterloo.ca@lists.samba.org  Wed Jun  6 08:37:35 2007
Return-Path: <samba-technical-bounces+ktwarwic=speedy.uwaterloo.ca@lists.samba.org>
Received: from lists.samba.org (mail.samba.org [66.70.73.150])
	by flax9.uwaterloo.ca (8.12.8/8.12.5) with ESMTP id l56CbZhB021449
	for <ktwarwic@speedy.uwaterloo.ca>; Wed, 6 Jun 2007 08:37:35 -0400
Received: from dp.samba.org (localhost [127.0.0.1])
	by lists.samba.org (Postfix) with ESMTP id 24C46163989
	for <ktwarwic@speedy.uwaterloo.ca>; Wed,  6 Jun 2007 12:37:29 +0000 (GMT)
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on dp.samba.org
X-Spam-Level: 
X-Spam-Status: No, score=-0.3 required=3.8 tests=AWL,BAYES_00,NO_REAL_NAME,
	NO_RELAYS,RCVD_IN_DSBL autolearn=no version=3.1.7
X-Original-To: samba-technical@lists.samba.org
Delivered-To: samba-technical@lists.samba.org
Received: by lists.samba.org (Postfix, from userid 603)
	id 04F301638FE; Wed,  6 Jun 2007 12:37:03 +0000 (GMT)
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Message-ID: <18022.43695.79583.817856@samba.org>
Date: Wed, 6 Jun 2007 22:38:07 +1000
To: "Gerald (Jerry) Carter" <jerry@samba.org>
In-Reply-To: <4666A3D3.5070009@samba.org>
References: <D4ADD9E4-9613-466E-9618-6DC251575315@samba.org>
	<1180906540.24923.198.camel@localhost.localdomain>
	<46636B0C.2030202@samba.org>
	<1180928372.24923.238.camel@localhost.localdomain>
	<089D1CE1-5D21-4711-918B-48E2C36C5D1D@samba.org>
	<18021.64361.164851.672386@samba.org>
	<5A8F8CFA-D862-4C8D-8134-A88913D85DED@samba.org>
	<Pine.LNX.4.64.0706052130040.22014@dolby.south.ad.plainjoe.org>
	<18022.10164.545376.678905@samba.org> <46662AD0.50301@samba.org>
	<18022.12332.550130.866023@samba.org> <4666A3D3.5070009@samba.org>
X-Mailer: VM 7.19 under Emacs 22.0.95.1
From: tridge@samba.org
Cc: samba-technical@lists.samba.org
Subject: Re: getting rid of mkproto.sh from Samba3
X-BeenThere: samba-technical@lists.samba.org
X-Mailman-Version: 2.1.5
Precedence: list
Reply-To: tridge@samba.org
List-Id: "Discussions on Samba internals. For general questions please
	subscribe to the list samba@samba.org"
	<samba-technical.lists.samba.org>
List-Unsubscribe: <https://lists.samba.org/mailman/listinfo/samba-technical>, 
	<mailto:samba-technical-request@lists.samba.org?subject=unsubscribe>
List-Archive: <http://lists.samba.org/archive/samba-technical>
List-Post: <mailto:samba-technical@lists.samba.org>
List-Help: <mailto:samba-technical-request@lists.samba.org?subject=help>
List-Subscribe: <https://lists.samba.org/mailman/listinfo/samba-technical>,
	<mailto:samba-technical-request@lists.samba.org?subject=subscribe>
Sender: samba-technical-bounces+ktwarwic=speedy.uwaterloo.ca@lists.samba.org
Errors-To: samba-technical-bounces+ktwarwic=speedy.uwaterloo.ca@lists.samba.org

Jerry,

 > Autogenerated headers are like sharp knives.  They can be
 > use and have their place in some areas.

err, I think not generating as much as you can is like running with a
sharp knife (or the proverbial scissors).  The examples I gave are not
just philosphical, I gave real examples of where it has saved our
bacon. 

Can you point to any large C project which doesn't automate this stuff
and doesn't have the sort of errors I mentioned? 

 > But they can cause
 > a lot of damage if used in correctly.  proto.h has caused
 > a lot of damage in Samba IMO.  It's has led us to the
 > libbigballofmud.so in the Makefile.  In fact, I would argue,
 > like James, that it has promoted code duplication and not
 > code reuse.

yes, we have a libbigballofmud, and that's bad, but I hardly see how
you can pin the blame on auto-generating prototypes. As we've
demonstrated in Samba4, you can generate and still have nicely
separated headers and separated libraries, so blaming it on
auto-generating headers makes no sense.

The way Samba3 does it now is bad, sure, but it makes no more sense to
blame the idea of generating headers than to blame C.

 > The turnover of the developer base on in open source means
 > that I value maintainable code above convenient or clever
 > code.  proto.h is convenient and clever, but not maintainable.

which is why we've put so much effort into making Samba4 very clean
and have really good, maintainable interfaces.

 > And if autogenerated headers are so great, why are tdb.h
 > and ldb.h checked into the source tree?

because ldb and tdb are both incorporated directly (as source trees)
into other projects, and I don't want to dictate my coding approach on
those other projects. Those projects may not even be able to run perl,
or may not be unix based.

 > Your points about static functions just don't hold any
 > convincing truth for me.  In fact, autogenerating headers
 > makes such functions more likely to be placed in the header
 > as the programmers has to consciously think about what
 > is placed in the public and private headers.

How? The generator doesn't look at static functions, and findstatic.pl
ensures you make all functions that can be static be static.

 > You might argue that an tool to autogenerate the headers
 > could be smart enough to know what to do.  My point is that
 > once you reach that point, you have to embed so much
 > information in the tool or source code that you should just
 > be writing the header yourself.

oh come on! Jelmer has already done it (look for is_public in
mkproto.pl), and do you seriously compare the half dozen lines of perl
written once in mkproto.pl versus every programmer having to get this
right for every function for the rest of the life of the project? Even
worse, when they don't get it right, no tool to tell them they have
screwed up?

 > So in summary, your points are not technical,  only philosphical.

nope. If we do it manually we will screw up, just like every other C
project has screwed it up. Maybe there is a perfect team of
programmers somewhere in the world, but we are not it. It's not
philosphy to realise that we are fallible.

Cheers, Tridge

