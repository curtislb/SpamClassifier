From r-help-bounces@stat.math.ethz.ch  Tue May 29 10:04:28 2007
Return-Path: <r-help-bounces@stat.math.ethz.ch>
Received: from hypatia.math.ethz.ch (hypatia.math.ethz.ch [129.132.145.15])
	by flax9.uwaterloo.ca (8.12.8/8.12.5) with ESMTP id l4TE4QhB031676
	for <ktwarwic@flax9.uwaterloo.ca>; Tue, 29 May 2007 10:04:27 -0400
Received: from hypatia.math.ethz.ch (hypatia [129.132.145.15])
	by hypatia.math.ethz.ch (8.13.6/8.13.6) with ESMTP id l4TE3iCC031488;
	Tue, 29 May 2007 16:03:54 +0200
X-Spam-Checker-Version: SpamAssassin 3.2.0 (2007-05-01) on hypatia.math.ethz.ch
X-Spam-Level: 
X-Spam-Status: No, score=-0.1 required=5.0 tests=AWL, DKIM_POLICY_SIGNSOME,
	OBSCURED_EMAIL autolearn=no version=3.2.0
Received: from ipex3.johnshopkins.edu (ipex3.johnshopkins.edu
	[128.220.161.140])
	by hypatia.math.ethz.ch (8.13.6/8.13.6) with ESMTP id l4TDpotV025412
	(version=TLSv1/SSLv3 cipher=RC4-SHA bits=128 verify=FAIL);
	Tue, 29 May 2007 15:51:54 +0200
Received: from dom-59mfy81.monument1.jhmi.edu (HELO DOM59MFY81)
	([10.16.148.124]) by ipex3.johnshopkins.edu with ESMTP/TLS/RC4-MD5;
	29 May 2007 09:51:50 -0400
X-BrightmailFiltered: true
X-Brightmail-Tracker: AAAAAA==
X-IronPort-AV: i="4.14,588,1170651600"; 
	d="txt'?scan'208"; a="305393184:sNHT33999708"
From: "Ravi Varadhan" <rvaradhan@jhmi.edu>
To: "'Martin Maechler'" <maechler@stat.math.ethz.ch>
References: <4656C3CE.BAC5.00EE.0@umoncton.ca>
	<99D2C293-CF11-4FCC-ADA8-7CED401BCC4F@DAL.CA>
	<4677FCB5A35A0441A0E0C99D56B23D910777FE74@UTHEVS2.mail.uthouston.edu>
	<48470650-4DC3-4073-91AF-31497EBD4540@DAL.CA>
	<001201c79ef9$e97f5530$7c94100a@win.ad.jhu.edu>
	<18010.41642.684443.327882@stat.math.ethz.ch>
Date: Tue, 29 May 2007 09:51:49 -0400
Message-ID: <000301c7a1f8$819119c0$7c94100a@win.ad.jhu.edu>
MIME-Version: 1.0
Content-Type: multipart/mixed;
	boundary="----=_NextPart_000_0004_01C7A1D6.FA7F79C0"
X-Mailer: Microsoft Office Outlook 11
In-reply-to: <18010.41642.684443.327882@stat.math.ethz.ch>
X-MIMEOLE: Produced By Microsoft MimeOLE V6.00.2900.3028
Thread-index: AcehC7SZCsNuBL1mS2GnyhiPF24akAA7FwCw
X-Virus-Scanned: by amavisd-new at stat.math.ethz.ch
Cc: R-help@stat.math.ethz.ch
Subject: Re: [R] ratio distribution - missing attachment
X-BeenThere: r-help@stat.math.ethz.ch
X-Mailman-Version: 2.1.9
Precedence: list
List-Id: "Main R Mailing List: Primary help" <r-help.stat.math.ethz.ch>
List-Unsubscribe: <https://stat.ethz.ch/mailman/listinfo/r-help>,
	<mailto:r-help-request@stat.math.ethz.ch?subject=unsubscribe>
List-Archive: <https://stat.ethz.ch/pipermail/r-help>
List-Post: <mailto:r-help@stat.math.ethz.ch>
List-Help: <mailto:r-help-request@stat.math.ethz.ch?subject=help>
List-Subscribe: <https://stat.ethz.ch/mailman/listinfo/r-help>,
	<mailto:r-help-request@stat.math.ethz.ch?subject=subscribe>
Sender: r-help-bounces@stat.math.ethz.ch
Errors-To: r-help-bounces@stat.math.ethz.ch

This is a multi-part message in MIME format.

------=_NextPart_000_0004_01C7A1D6.FA7F79C0
Content-Type: text/plain;
	charset="us-ascii"
Content-Transfer-Encoding: 7bit

Dear Martin and Vitto,

Please find attached the R function to compute the density of the ratio of 2
dependent normal variates.

Best,
Ravi.

----------------------------------------------------------------------------
-------

Ravi Varadhan, Ph.D.

Assistant Professor, The Center on Aging and Health

Division of Geriatric Medicine and Gerontology 

Johns Hopkins University

Ph: (410) 502-2619

Fax: (410) 614-9625

Email: rvaradhan@jhmi.edu

Webpage:  http://www.jhsph.edu/agingandhealth/People/Faculty/Varadhan.html

 

----------------------------------------------------------------------------
--------

-----Original Message-----
From: Martin Maechler [mailto:maechler@stat.math.ethz.ch] 
Sent: Monday, May 28, 2007 5:37 AM
To: Ravi Varadhan
Cc: R-help@stat.math.ethz.ch
Subject: Re: [R] ratio distribution - missing attachment

Thank you, Ravi.
You probably will have noticed, that the attachment didn't make
it to the mailing list.

The reason is that the we let the mailing list software strip 
"binary" attachments which can easily be misused to spread
viruses; see --> http://www.r-project.org/mail.html (search "attachment")
or the posting-guide.

OTOH, the software allows attachments with MIME type text/plain.
If you use an e-mail software for sophisticated users, the
software allows you to specify the MIME type of your
attachments;
otherwise (as with most "user friendly", "modern" e-mail
software), attach a *.txt file (Spie Bates uses  <foo>_R.txt) 
and it should make it to the lists;
as a third alternative, just "cut & paste" the corresponding
text into your e-mal.

I think your R function should make it to R-help (and its
archives), so I'd be thankful for a repost.

Martin


>>>>> "Ravi" == Ravi Varadhan <rvaradhan@jhmi.edu>
>>>>>     on Fri, 25 May 2007 14:24:20 -0400 writes:

    Ravi> Mike, Attached is an R function to do this, along with
    Ravi> an example that will reproduce the MathCad plot shown
    Ravi> in your attached paper. I haven't checked it
    Ravi> thoroughly, but it seems to reproduce the MathCad
    Ravi> example well.

    Ravi> Ravi.

    Ravi>
----------------------------------------------------------------------------
    Ravi> -------

    Ravi> Ravi Varadhan, Ph.D.

    Ravi> Assistant Professor, The Center on Aging and Health

    Ravi> Division of Geriatric Medicine and Gerontology

    Ravi> Johns Hopkins University

    Ravi> Ph: (410) 502-2619

    Ravi> Fax: (410) 614-9625

    Ravi> Email: rvaradhan@jhmi.edu

    Ravi> Webpage:
    Ravi> http://www.jhsph.edu/agingandhealth/People/Faculty/Varadhan.html

 

    Ravi>
----------------------------------------------------------------------------
    Ravi> --------


    Ravi> -----Original Message----- From:
    Ravi> r-help-bounces@stat.math.ethz.ch
    Ravi> [mailto:r-help-bounces@stat.math.ethz.ch] On Behalf Of
    Ravi> Mike Lawrence Sent: Friday, May 25, 2007 1:55 PM To:
    Ravi> Lucke, Joseph F Cc: Rhelp Subject: Re: [R] Calculation
    Ravi> of ratio distribution properties

    Ravi> According to the paper I cited, there is controversy
    Ravi> over the sufficiency of Hinkley's solution, hence
    Ravi> their proposed more complete solution.

    Ravi> On 25-May-07, at 2:45 PM, Lucke, Joseph F wrote:

    >> The exact ratio is given in
    >> 
    >> On the Ratio of Two Correlated Normal Random Variables,
    >> D. V.  Hinkley, Biometrika, Vol. 56, No. 3. (Dec., 1969),
    >> pp. 635-639.
    >> 

    Ravi> -- Mike Lawrence Graduate Student, Department of
    Ravi> Psychology, Dalhousie University

    Ravi> Website: http://myweb.dal.ca/mc973993 Public calendar:
    Ravi> http://icalx.com/public/informavore/Public

    Ravi> "The road to wisdom? Well, it's plain and simple to
    Ravi> express: Err and err and err again, but less and less
    Ravi> and less."  - Piet Hein

------=_NextPart_000_0004_01C7A1D6.FA7F79C0
Content-Type: text/plain;
	name="ratio2normals_R.txt"
Content-Transfer-Encoding: quoted-printable
Content-Disposition: attachment;
	filename="ratio2normals_R.txt"

ratio2normals <- function(x, mean1,mean2,sd1,sd2,rho){
# A function to compute ratio of 2 normals
# R code written by Ravi Varadhan=20
# May 25, 2007
# Based on the paper by Pham Gia et al., Comm in Stats (2006)
A <- 1 / (2*pi*sd1*sd2*sqrt(1-rho^2))
exponent.num <- -sd2^2*mean1^2 - sd1^2*mean2^2 + =
2*rho*sd1*sd2*mean1*mean2
exponent.denom <- 2*(1-rho^2)*sd1^2*sd2^2
K <- A * exp(exponent.num/exponent.denom)
t2x.num <- -sd2^2*mean1*x - sd1^2*mean2 + rho*sd1*sd2*(mean2*x + mean1)
t2x.denom <- sd1*sd2*sqrt(2*(1-rho^2)*(sd2^2*x^2 - 2*rho*x*sd1*sd2 + =
sd1^2))
t2x <- t2x.num / t2x.denom
erf.term <- 2 * pnorm(sqrt(2) * t2x) - 1
Ft2x <- sqrt(pi) * t2x * exp(t2x^2) * erf.term + 1
fx <- K * Ft2x * 2 * (1 - rho^2) * sd1^2 * sd2^2 / (sd2^2 * x^2 + sd1^2 =
- 2*x*rho*sd1*sd2)
return(fx)
}


mean1 <- 75.25
mean2 <- 71.58=20
sd1 <- 6.25
sd2 <- 5.45
rho <- 0.76

x <- seq(0.5,1.5, length=3D100)
y <- ratio2normals(x,mean1,mean2, sd1,sd2,rho)
plot(x,y, type=3D"l")


# compute the mean and variance via quadrature
m1 <- function(x, mean1, mean2, sd1, sd2, rho){
x * ratio2normals(x, mean1, mean2, sd1, sd2, rho)
}

m2 <- function(x, mean1, mean2, sd1, sd2, rho){
x^2 * ratio2normals(x, mean1, mean2, sd1, sd2, rho)
}

m.1 <- integrate(m1, lower=3D-Inf, upper=3DInf, mean1=3Dmean1, =
mean2=3Dmean2, sd1=3Dsd1, sd2=3Dsd2, rho=3Drho, rel.tol=3D1.e-07)$val

m.2 <- integrate(m2, lower=3D-Inf, upper=3DInf, mean1=3Dmean1, =
mean2=3Dmean2, sd1=3Dsd1, sd2=3Dsd2, rho=3Drho, rel.tol=3D1.e-07)$val

mean <- m.1
variance <- m.2 - m.1^2


------=_NextPart_000_0004_01C7A1D6.FA7F79C0
Content-Type: text/plain; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

______________________________________________
R-help@stat.math.ethz.ch mailing list
https://stat.ethz.ch/mailman/listinfo/r-help
PLEASE do read the posting guide http://www.R-project.org/posting-guide.html
and provide commented, minimal, self-contained, reproducible code.

------=_NextPart_000_0004_01C7A1D6.FA7F79C0--

