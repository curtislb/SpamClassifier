From perl6-all-return-81262-ktwarwic=speedy.uwaterloo.ca@perl.org  Fri May 11 19:01:53 2007
Return-Path: <perl6-all-return-81262-ktwarwic=speedy.uwaterloo.ca@perl.org>
Received: from lists.develooper.com (x6.develooper.com [63.251.223.186])
	by flax9.uwaterloo.ca (8.12.8/8.12.5) with SMTP id l4BN1qqD003056
	for <ktwarwic@flax9.uwaterloo.ca>; Fri, 11 May 2007 19:01:52 -0400
Received: (qmail 8074 invoked by uid 514); 11 May 2007 22:54:15 -0000
Mailing-List: contact perl6-all-help@perl.org; run by ezmlm
Precedence: bulk
List-Post: <mailto:perl6-all@perl.org>
List-Help: <mailto:perl6-all-help@perl.org>
List-Unsubscribe: <mailto:perl6-all-unsubscribe@perl.org>
List-Subscribe: <mailto:perl6-all-subscribe@perl.org>
List-Id: <perl6-all.perl.org>
Delivered-To: mailing list perl6-all@perl.org
Received: (qmail 8069 invoked from network); 11 May 2007 22:54:15 -0000
Delivered-To: perl6-all-poster@perl.org
X-Spam-Status: No, hits=-2.6 required=8.0
	tests=BAYES_00,DKIM_SIGNED,DKIM_VERIFIED,DK_POLICY_SIGNSOME,DK_SIGNED,HTML_MESSAGE,SPF_PASS
X-Spam-Check-By: la.mx.develooper.com
Received-SPF: pass (x1.develooper.com: local policy)
X-Mailing-List: contact perl6-internals-help@perl.org; run by ezmlm
X-Mailing-List-Name: perl6-internals
List-Id: <perl6-internals.perl.org>
Delivered-To: mailing list perl6-internals@perl.org
Delivered-To: perl6-internals@perl.org
Received-SPF: pass (x1.develooper.com: domain of alek.storm@gmail.com designates 66.249.92.171 as permitted sender)
DKIM-Signature: a=rsa-sha1; c=relaxed/relaxed;
        d=gmail.com; s=beta;
        h=domainkey-signature:received:received:message-id:date:from:to:subject:cc:in-reply-to:mime-version:content-type:references;
        b=dO4eeu/G47OoaID0ohCPUAozq2iq/PIB3JcymKpnEblDJ3KVKvTMe+HGK2P6WBYssKDI79miSIHAYAmZhDW2gck0vJLMT1SkazlOX9tkQltATyWECncgIy3dWZ18baxvet41jYfl6ifRn3EufHGTCf2NEpFFgLEjET9RJHiGwXs=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=gmail.com; s=beta;
        h=received:message-id:date:from:to:subject:cc:in-reply-to:mime-version:content-type:references;
        b=AzfEwJrKIC6PMAlUhZpu4srEhWJ1O1p+KdyiE0ZBOI19XhByhIp/41zx2/vzFUeWyb98f6JBFSbUwMXhxwBH3OXlSyTYKP3ta5L0pQ7GsKecC4ZA22ej7ks6z274WLH/H8g588qP5oisk8dn3leltezKUepCcil4FeYXcb7XeEg=
Message-ID: <189adbd0705111541n269cf41cnbeb3eaa2e873e95a@mail.gmail.com>
Date: Fri, 11 May 2007 22:41:31 +0000
From: "Alek Storm" <alek.storm@gmail.com>
To: "Allison Randal" <allison@perl.org>
Subject: Re: [perl #42905] [PATCH] implement vtable overriding for PDD15, bugfix
Cc: perl6-internals@perl.org
In-Reply-To: <189adbd0705101700k684bc587he3ceadc28b3afb1@mail.gmail.com>
MIME-Version: 1.0
Content-Type: multipart/mixed; 
	boundary="----=_Part_92135_15666672.1178923291060"
References: <RT-Ticket-42905@perl.org>
	 <189adbd0705071821l427409d9v94895cc11b9a374@mail.gmail.com>
	 <rt-3.6.HEAD-12281-1178587398-1986.42905-72-0@perl.org>
	 <464124ED.2090102@perl.org>
	 <189adbd0705101700k684bc587he3ceadc28b3afb1@mail.gmail.com>
X-Virus-Checked: Checked
X-Virus-Checked: Checked
X-Old-Spam-Check-By: la.mx.develooper.com
X-Old-Spam-Status: No, hits=-2.6 required=8.0
	tests=BAYES_00,DKIM_SIGNED,DKIM_VERIFIED,DK_POLICY_SIGNSOME,DK_SIGNED,HTML_MESSAGE,SPF_PASS

------=_Part_92135_15666672.1178923291060
Content-Type: multipart/alternative; 
	boundary="----=_Part_92136_8142966.1178923291060"

------=_Part_92136_8142966.1178923291060
Content-Type: text/plain; charset=ISO-8859-1; format=flowed
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

On 5/11/07, Alek Storm <alek.storm@gmail.com> wrote:
>
> Whew.  Thanks for looking over my giant patch :).  I've split the original
> patch into three parts - testing, specs, and code, and rebased it on
> r18494.  I've also cut out the code that modified the implementation of
> invoke() in the old object system, but kept the modification in the new one,
> and cut out the changes to the tests related to that.
>

Since I've submitted a separate ticket related to overriding 'invoke'
(#42919) in ParrotObject, I've changed this code patch to work without the
#42919 patch.  In this patch, Object works the same as ParrotObject
currently does - it expects the current object to be passed as an explicit
parameter.  I've included a second patch, to be applied after the main code
patch and the #42919 patch are applied, which fixes the 'invoke' problem for
Object.  So that brings the total to four patches - the new
pdd15_code.patch, pdd15_code_invoke.patch, pdd15_spec.patch, and
pdd15_tests.patch.  Thanks.

-- 
Alek Storm

------=_Part_92136_8142966.1178923291060
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

On 5/11/07, <b class="gmail_sendername">Alek Storm</b> &lt;<a href="mailto:alek.storm@gmail.com" target="_blank" onclick="return top.js.OpenExtLink(window,event,this)">alek.storm@gmail.com</a>&gt; wrote:<div><span class="gmail_quote">
</span><blockquote class="gmail_quote" style="border-left: 1px solid rgb(204, 204, 204); margin: 0pt 0pt 0pt 0.8ex; padding-left: 1ex;">
<span></span>Whew.&nbsp; Thanks for looking over my giant patch :).&nbsp; I&#39;ve split the original patch into three parts - testing, specs, and code, and rebased it on r18494.&nbsp; I&#39;ve also cut out the code that modified the implementation of invoke() in the old object system, but kept the modification in the new one, and cut out the changes to the tests related to that.
<span></span><br clear="all"></blockquote></div><br>Since I&#39;ve submitted a separate ticket related to overriding &#39;invoke&#39; (#42919) in ParrotObject, I&#39;ve changed this code patch to work without the #42919 patch.&nbsp; In this patch, Object works the same as ParrotObject currently does - it expects the current object to be passed as an explicit parameter.&nbsp; I&#39;ve included a second patch, to be applied after the main code patch and the #42919 patch are applied, which fixes the &#39;invoke&#39; problem for Object.&nbsp; So that brings the total to four patches - the new pdd15_code.patch, pdd15_code_invoke.patch, pdd15_spec.patch, and pdd15_tests.patch.&nbsp; Thanks.
<br clear="all"><br>-- <br>Alek Storm

------=_Part_92136_8142966.1178923291060--

------=_Part_92135_15666672.1178923291060
Content-Type: application/octet-stream; name=pdd15_code.patch
Content-Transfer-Encoding: base64
X-Attachment-Id: f_f1kxl3sw
Content-Disposition: attachment; filename="pdd15_code.patch"

SW5kZXg6IHNyYy9vcHMvb2JqZWN0Lm9wcwo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci0tLSBzcmMvb3BzL29iamVjdC5v
cHMJKHJldmlzaW9uIDE4NDU1KQorKysgc3JjL29wcy9vYmplY3Qub3BzCSh3b3JraW5nIGNvcHkp
CkBAIC01NSw3ICs1NSw3IEBACiAgIG1ldGggPSAkMjsKICAgbmV4dCA9IGV4cHIgTkVYVCgpOwog
ICBtZXRob2RfcG1jID0gVlRBQkxFX2ZpbmRfbWV0aG9kKGludGVycCwgb2JqZWN0LCBtZXRoKTsK
LSAgaWYgKCFtZXRob2RfcG1jKSB7CisgIGlmIChQTUNfSVNfTlVMTChtZXRob2RfcG1jKSkgewog
ICAgIHJlYWxfZXhjZXB0aW9uKGludGVycCwgbmV4dCwgTUVUSF9OT1RfRk9VTkQsCiAgICAgICAg
ICJNZXRob2QgJyVTcycgbm90IGZvdW5kIiwgbWV0aCk7CiAgIH0KQEAgLTkxLDcgKzkxLDcgQEAK
ICAgbWV0aCA9ICQyOwogICBuZXh0ID0gZXhwciBORVhUKCk7CiAgIG1ldGhvZF9wbWMgPSBWVEFC
TEVfZmluZF9tZXRob2QoaW50ZXJwLCBvYmplY3QsIG1ldGgpOwotICBpZiAoIW1ldGhvZF9wbWMp
IHsKKyAgaWYgKFBNQ19JU19OVUxMKG1ldGhvZF9wbWMpKSB7CiAgICAgcmVhbF9leGNlcHRpb24o
aW50ZXJwLCBuZXh0LCBNRVRIX05PVF9GT1VORCwKICAgICAgICAgIk1ldGhvZCAnJVNzJyBub3Qg
Zm91bmQiLCBtZXRoKTsKICAgfQpJbmRleDogc3JjL29iamVjdHMuYwo9PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci0tLSBz
cmMvb2JqZWN0cy5jCShyZXZpc2lvbiAxODQ1NSkKKysrIHNyYy9vYmplY3RzLmMJKHdvcmtpbmcg
Y29weSkKQEAgLTcyLDYgKzcyLDEzIEBACiAgICAgcmV0dXJuIC0xOwogfQogCitTVFJJTkcqCitQ
YXJyb3RfZ2V0X3Z0YWJsZV9uYW1lKEludGVycCAqaW50ZXJwLCBJTlRWQUwgaW5kZXgpCit7Cisg
ICAgY29uc3QgY2hhciAqdnRhYmxlX25hbWUgPSBQYXJyb3RfdnRhYmxlX3Nsb3RfbmFtZXNbaW5k
ZXhdOworICAgIHJldHVybiBzdHJpbmdfZnJvbV9jc3RyaW5nKGludGVycCwgdnRhYmxlX25hbWUs
IHN0cmxlbih2dGFibGVfbmFtZSkpOworfQorCiAvKgogCiA9aXRlbSBDPHN0YXRpYyBQTUMqIGZp
bmRfdnRhYmxlX21ldGhfbnMoSW50ZXJwICppbnRlcnAsIFBNQyAqbnMsIElOVFZBTCB2dGFibGVf
aW5kZXgpPgpJbmRleDogc3JjL3BtYy9jbGFzc29iamVjdC5oCj09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLS0tIHNyYy9w
bWMvY2xhc3NvYmplY3QuaAkyMDA3LTA1LTEwIDE3OjUwOjU1LjAwMDAwMDAwMCArMDAwMAorKysg
c3JjL3BtYy9jbGFzc29iamVjdC5oCTIwMDctMDUtMTAgMTc6NTI6MzQuMDAwMDAwMDAwICswMDAw
CkBAIC00MSw2ICs0MSwxMCBAQAogCiAvKiBGdWxseSBxdWFsaWZpZWQgY2xhc3MgbmFtZSBnZW5l
cmF0aW9uOyBkZWZpbmVkIGluIENsYXNzLCB1c2VkIGJ5IE9iamVjdC4gKi8KIFNUUklORyogUGFy
cm90X0NsYXNzX2dldF9mcV9jbGFzc25hbWUoUGFycm90X0ludGVycCBpbnRlcnAsIFBhcnJvdF9D
bGFzcyAqY2xhc3NfaW5mbyk7CitQTUMqIFBhcnJvdF9DbGFzc19maW5kX3Z0YWJsZV9tZXRob2Qo
UGFycm90X0ludGVycCBpbnRlcnAsIFBNQyAqc2VsZiwgU1RSSU5HICptZXRoKTsKKworLyogVGhy
b3cgYW4gZXhjZXB0aW9uIGlmIHdlIHRyeSB0byBvdmVycmlkZSB0aGVzZS4gKi8KK3N0YXRpYyBj
b25zdCBjaGFyICpjb25zdCBjYW50X292ZXJyaWRlW10gPSB7ICJpbml0X3BtYyIsICJkZXN0cm95
IiwgIm1hcmsiLCAibW9ycGgiLCBOVUxMIH07CiAKICNlbmRpZiAvKiBQQVJST1RfQ0xBU1NPQkpF
Q1RfSF9HVUFSRCAqLwogCgpJbmRleDogc3JjL3BtYy9jbGFzcy5wbWMKPT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQotLS0g
c3JjL3BtYy9jbGFzcy5wbWMJKHJldmlzaW9uIDE4NDU1KQorKysgc3JjL3BtYy9jbGFzcy5wbWMJ
KHdvcmtpbmcgY29weSkKQEAgLTExMiw3ICsxMTIsMjUgQEAKICAgICByZXR1cm4gZnFfY2xhc3M7
CiB9CiAKKy8qIEZpbmQgYSB2dGFibGUgbWV0aG9kIGluIHRoZSB2dGFibGVfbWV0aG9kcyBoYXNo
ICovCitQTUMqIFBhcnJvdF9DbGFzc19maW5kX3Z0YWJsZV9tZXRob2QoUGFycm90X0ludGVycCBp
bnRlcnAsIFBNQyAqc2VsZiwgU1RSSU5HICptZXRoKSB7CisgICAgUGFycm90X0NsYXNzICpfY2xh
c3MgPSBQQVJST1RfQ0xBU1Moc2VsZik7CisgICAgaW50IGk7CisgICAgSU5UVkFMIG4gPSBWVEFC
TEVfZWxlbWVudHMoaW50ZXJwLCBfY2xhc3MtPmFsbF9wYXJlbnRzKTsKIAorICAgIC8qIFdhbGsg
dXAgTVJPLCBsb29raW5nIGZvciB0aGUgdnRhYmxlIG1ldGhvZCAqLworICAgIGZvciAoIGkgPSAw
OyBpIDwgbjsgaSsrICkgeworICAgICAgICBQTUMgKnBhcmVudCA9IFZUQUJMRV9nZXRfcG1jX2tl
eWVkX2ludChpbnRlcnAsIF9jbGFzcy0+YWxsX3BhcmVudHMsIGkpOworICAgICAgICBQYXJyb3Rf
Q2xhc3MgKnBhcmVudF9jbGFzcyA9IFBBUlJPVF9DTEFTUyhwYXJlbnQpOworCisgICAgICAgIFBN
QyAqc3ViID0gVlRBQkxFX2dldF9wbWNfa2V5ZWRfc3RyKGludGVycCwgcGFyZW50X2NsYXNzLT52
dGFibGVfbWV0aG9kcywgbWV0aCk7CisgICAgICAgIGlmICghUE1DX0lTX05VTEwoc3ViKSkKKyAg
ICAgICAgICAgIHJldHVybiBzdWI7CisgICAgfQorCisgICAgcmV0dXJuIFBNQ05VTEw7Cit9CisK
IC8qIFRoaXMgZnVuY3Rpb24gYnVpbGRzIHRoZSBhdHRyaWJ1dGUgaW5kZXggKHRhYmxlIHRvIG1h
cCBjbGFzcyBuYW1lIGFuZAogICogYXR0cmlidXRlIG5hbWUgdG8gYW4gaW5kZXgpIGZvciB0aGUg
Y3VycmVudCBjbGFzcy4gKi8KIHN0YXRpYyB2b2lkIGJ1aWxkX2F0dHJpYl9pbmRleChQYXJyb3Rf
SW50ZXJwIGludGVycCwgUE1DICpzZWxmKSB7CkBAIC0zMDksNyArMzI3LDI2IEBACiAgICAgfQog
fQogCitzdGF0aWMgdm9pZCBhZGRfdnRhYmxlX21ldGhvZChQYXJyb3RfSW50ZXJwIGludGVycCwg
UE1DICpzZWxmLCBTVFJJTkcgKm5hbWUsIFBNQyAqc3ViKQoreworICAgIGludCBpOworICAgIFBh
cnJvdF9DbGFzcyAqX2NsYXNzID0gUEFSUk9UX0NMQVNTKHNlbGYpOworICAgIGNoYXIqIG5hbWVf
YyA9IHN0cmluZ190b19jc3RyaW5nKGludGVycCwgbmFtZSk7CiAKKyAgICAvKiBDaGVjayBpZiBp
dCdzIGFuIHVuLW92ZXJyaWRhYmxlIHZ0YWJsZSBtZXRob2QgKi8KKyAgICBmb3IgKCBpID0gMDsg
Y2FudF9vdmVycmlkZVtpXTsgaSsrICkgeworICAgICAgICBpZiAoIHN0cmNtcChuYW1lX2MsIGNh
bnRfb3ZlcnJpZGVbaV0pID09IDAgKSB7CisgICAgICAgICAgICBzdHJpbmdfY3N0cmluZ19mcmVl
KG5hbWVfYyk7CisgICAgICAgICAgICByZWFsX2V4Y2VwdGlvbihpbnRlcnAsIE5VTEwsIEVfTmFt
ZUVycm9yLAorICAgICAgICAgICAgICAgICJDYW5ub3Qgb3ZlcnJpZGUgJyVzJyB2dGFibGUgbWV0
aG9kIiwgY2FudF9vdmVycmlkZVtpXSk7CisgICAgICAgIH0KKyAgICB9CisKKyAgICBpZiAoIVBN
Q19JU19OVUxMKHN1YikpCisgICAgICAgIFZUQUJMRV9zZXRfcG1jX2tleWVkX3N0cihpbnRlcnAs
IF9jbGFzcy0+dnRhYmxlX21ldGhvZHMsIG5hbWUsIHN1Yik7CisgICAgc3RyaW5nX2NzdHJpbmdf
ZnJlZShuYW1lX2MpOworfQorCiAvKgogCiA9YmFjawpAQCAtMzI1LDcgKzM2Miw2IEBACiBwbWNs
YXNzIENsYXNzCiAgICAgbmVlZF9leHQgewogCi0KIC8qCiAKID1pdGVtIEM8dm9pZCBpbml0KCk+
CkBAIC00OTYsOSArNTMyLDI0IEBACiAgICAgICAgICAgICByZWFsX2V4Y2VwdGlvbihpbnRlcnAs
IE5VTEwsIEVfTm90SW1wbGVtZW50ZWRFcnJvciwKICAgICAgICAgICAgICAgICAiQSBtZXRob2Qg
b2YgdGhpcyBuYW1lIGFscmVhZHkgZXhpc3RzLiBJdCBtYXkgaGF2ZSBiZWVuIHN1cHBsaWVkIGJ5
IGEgcm9sZS4iKTsKICAgICAgICAgfQotICAgICAgICBlbHNlIHsKKyAgICAgICAgZWxzZSBpZiAo
IVBNQ19JU19OVUxMKHN1YikpIHsKICAgICAgICAgICAgIC8qIEVudGVyIGl0IGludG8gdGhlIHRh
YmxlLiAqLwogICAgICAgICAgICAgVlRBQkxFX3NldF9wbWNfa2V5ZWRfc3RyKGludGVycCwgX2Ns
YXNzLT5tZXRob2RzLCBuYW1lLCBzdWIpOworCisgICAgICAgICAgICAvKiBJZiBtZXRob2Qgb3Zl
cnJpZGVzIGEgdnRhYmxlIG1ldGhvZCwgc3RpY2sgaXQgaW4gdGhlCisgICAgICAgICAgICAgICB2
dGFibGUgbWV0aG9kIGhhc2ggKi8KKyAgICAgICAgICAgIC8qIFhYWCB0aGlzIHNob3VsZCByZWFs
bHkgb25seSBiZSBkb25lIGZyb20gdGhlCisgICAgICAgICAgICAgICBhZGRfdnRhYmxlX21ldGhv
ZCBQQ0NNRVRIT0QgKi8KKyAgICAgICAgICAgIGlmICggUE1DX3N1YihzdWIpLT52dGFibGVfaW5k
ZXggPiAtMSApIHsKKyAgICAgICAgICAgICAgICBJTlRWQUwgdnRhYmxlX2luZGV4ID0gUE1DX3N1
YihzdWIpLT52dGFibGVfaW5kZXg7CisgICAgICAgICAgICAgICAgU1RSSU5HICp2dGFibGVfbmFt
ZSA9IFBhcnJvdF9nZXRfdnRhYmxlX25hbWUoaW50ZXJwLCB2dGFibGVfaW5kZXgpOworCisgICAg
ICAgICAgICAgICAgLyogQ2hvcCBvZmYgdW5kZXJzY29yZXMgKi8KKyAgICAgICAgICAgICAgICB2
dGFibGVfbmFtZS0+c3Ryc3RhcnQgKz0gMjsKKyAgICAgICAgICAgICAgICB2dGFibGVfbmFtZS0+
c3RybGVuIC09IDI7CisKKyAgICAgICAgICAgICAgICBhZGRfdnRhYmxlX21ldGhvZChpbnRlcnAs
IFNFTEYsIHZ0YWJsZV9uYW1lLCBzdWIpOworICAgICAgICAgICAgfQogICAgICAgICB9CiAgICAg
fQogCkBAIC03OTksMTEgKzg1MCwxMSBAQAogPWN1dAogCiAqLwotICAgIFBDQ01FVEhPRCB2b2lk
IG5ldyhQTUMgKmFyZ3MgOnNsdXJweSA6bmFtZWQpIHsKKyAgICBQQ0NNRVRIT0Qgdm9pZCBuZXco
UE1DICpwYXJhbXMgOnNsdXJweSkgewogICAgICAgICBQYXJyb3RfQ2xhc3MgKl9jbGFzcyA9IFBB
UlJPVF9DTEFTUyhTRUxGKTsKLSAgICAgICAgUE1DICpvYmo7Ci0gICAgICAgIFBNQyAqaXRlcjsK
KyAgICAgICAgUE1DICpvYmosICppdGVyOwogICAgICAgICBQYXJyb3RfT2JqZWN0ICpvYmpfZ3V0
cyA9IE5VTEw7CisgICAgICAgIElOVFZBTCBuOwogCiAgICAgICAgIC8qIElmIHdlJ3ZlIG5vdCBi
ZWVuIGluc3RhbnRpYXRlZCBiZWZvcmUuLi4gKi8KICAgICAgICAgaWYgKCFfY2xhc3MtPmluc3Rh
bnRpYXRlZCkgewpAQCAtODQ3LDE5ICs4OTgsNzUgQEAKICAgICAgICAgb2JqX2d1dHMtPmF0dHJp
Yl9zdG9yZSA9IHBtY19uZXcoaW50ZXJwLCBlbnVtX2NsYXNzX1Jlc2l6YWJsZVBNQ0FycmF5KTsK
ICAgICAgICAgUE1DX2RhdGEob2JqKSA9IG9ial9ndXRzOwogCi0gICAgICAgIC8qIEluaXRpYWxp
emUgYXR0cmlidXRlcyB3aXRoIHRoZSBzdXBwbGllZCB2YWx1ZXMuICovCi0gICAgICAgIGl0ZXIg
PSBWVEFCTEVfZ2V0X2l0ZXIoaW50ZXJwLCBhcmdzKTsKLSAgICAgICAgd2hpbGUgKFZUQUJMRV9n
ZXRfYm9vbChpbnRlcnAsIGl0ZXIpKSB7Ci0gICAgICAgICAgICAvKiBHZXQgbmFtZSBhbmQgdmFs
dWUuICovCi0gICAgICAgICAgICBTVFJJTkcgKmF0dHJfbmFtZSA9IFZUQUJMRV9zaGlmdF9zdHJp
bmcoaW50ZXJwLCBpdGVyKTsKLSAgICAgICAgICAgIFBNQyAqYXR0cl92YWx1ZSA9IFZUQUJMRV9n
ZXRfcG1jX2tleWVkX3N0cihpbnRlcnAsIGFyZ3MsIGF0dHJfbmFtZSk7CisgICAgICAgIC8qIENh
bGwgaW5pdCwgaWYgaXQncyBvdmVycmlkZGVuLiBUaGlzIGNodW5rIGRvZXMgYSA6ZmxhdCBvbiB0
aGUgcGFyYW1zCisgICAgICAgICAqIHNsdXJweSBtYW51YWxseSwgdGhlbiBwYXNzZXMgaXQgdG8g
dGhlIGluaXQoKSBvdmVycmlkZS4gQWRhcHRlZCBmcm9tCisgICAgICAgICAqIFBDQ0lOVk9LRS4g
Ki8KKyAgICAgICAgSU5UVkFMIHNpZ19sZW4gICAgICAgPSBWVEFCTEVfZWxlbWVudHMoaW50ZXJw
LCBwYXJhbXMpICsgMTsKKyAgICAgICAgSU5UVkFMIG5fcmVnc191c2VkW10gPSB7IDAsIDAsIDAs
IHNpZ19sZW4gfTsKIAotICAgICAgICAgICAgLyogU2V0IHRoZSBhdHRyaWJ1dGUuICovCi0gICAg
ICAgICAgICBWVEFCTEVfc2V0X2F0dHJfc3RyKGludGVycCwgb2JqLCBhdHRyX25hbWUsIGF0dHJf
dmFsdWUpOworICAgICAgICBvcGNvZGVfdCBhcmdfaW5kZXhlc1tzaWdfbGVuXTsKKyAgICAgICAg
aW50IGk7CisgICAgICAgIGZvciAoIGkgPSAwOyBpIDwgc2lnX2xlbjsgaSsrICkKKyAgICAgICAg
ICAgIGFyZ19pbmRleGVzW2ldID0gaTsKKyAgICAgICAgb3Bjb2RlX3QgcmVzdWx0X2luZGV4ZXNb
XSA9IHsgMCB9OworCisgICAgICAgIC8qIEZpbGwgdGhlIGFyZ3Mgc2lnbmF0dXJlIHdpdGggUE1D
cywgc2luY2UgdGhhdCdzIGFsbCB3ZSBrbm93CisgICAgICAgICAqIGFib3V0IHRoZSBzbHVycHkn
cyBjb250ZW50cyAtIHRoZXkgZ2V0IGNvbnZlcnRlZCB0byBpbnQsIGV0YworICAgICAgICAgKiBh
ZnRlciB0aGUgY2FsbC4gKi8KKyAgICAgICAgUE1DKiBhcmdzX3NpZyA9IHBtY19uZXcoaW50ZXJw
LCBlbnVtX2NsYXNzX0ZpeGVkSW50ZWdlckFycmF5KTsKKyAgICAgICAgVlRBQkxFX3NldF9pbnRl
Z2VyX25hdGl2ZShpbnRlcnAsIGFyZ3Nfc2lnLCBzaWdfbGVuKTsKKyAgICAgICAgZm9yICggaSA9
IDA7IGkgPCBzaWdfbGVuOyBpKysgKQorICAgICAgICAgICAgVlRBQkxFX3NldF9pbnRlZ2VyX2tl
eWVkX2ludChpbnRlcnAsIGFyZ3Nfc2lnLCBpLCBQQVJST1RfQVJHX1BNQyk7CisKKyAgICAgICAg
UE1DKiByZXN1bHRzX3NpZyA9IHBtY19uZXcoaW50ZXJwLCBlbnVtX2NsYXNzX0ZpeGVkSW50ZWdl
ckFycmF5KTsKKworICAgICAgICBQTUMqIHJldF9jb250ICAgICAgICAgPSBuZXdfcmV0X2NvbnRp
bnVhdGlvbl9wbWMoaW50ZXJwLCBOVUxMKTsKKyAgICAgICAgcGFycm90X2NvbnRleHRfdCAqY3R4
ID0gUGFycm90X3B1c2hfY29udGV4dChpbnRlcnAsIG5fcmVnc191c2VkKTsKKworICAgICAgICBv
cGNvZGVfdCogc2F2ZV9jdXJyZW50X2FyZ3MgPSBpbnRlcnAtPmN1cnJlbnRfYXJnczsKKyAgICAg
ICAgUE1DKiBzYXZlX2FyZ3Nfc2lnbmF0dXJlICAgID0gaW50ZXJwLT5hcmdzX3NpZ25hdHVyZTsK
KyAgICAgICAgUE1DKiBzYXZlX2N1cnJlbnRfb2JqZWN0ICAgID0gaW50ZXJwLT5jdXJyZW50X29i
amVjdDsKKworICAgICAgICAvKiBGbGF0dGVuIHRoZSBzbHVycHkgaW50byByZWdpc3RlciBzbG90
cy4gKi8KKyAgICAgICAgQ1RYX1JFR19QTUMoY3R4LCAwKSA9IG9iajsKKyAgICAgICAgZm9yICgg
aSA9IDE7IGkgPCBzaWdfbGVuOyBpKysgKQorICAgICAgICAgICAgQ1RYX1JFR19QTUMoY3R4LCBp
KSA9IFZUQUJMRV9nZXRfcG1jX2tleWVkX2ludChpbnRlcnAsIHBhcmFtcywgaS0xKTsKKworICAg
ICAgICAvKiBXYWxrIHVwIE1STywgbG9va2luZyBmb3IgdGhlIHZ0YWJsZSBtZXRob2QgKi8KKyAg
ICAgICAgbiA9IFZUQUJMRV9lbGVtZW50cyhpbnRlcnAsIF9jbGFzcy0+YWxsX3BhcmVudHMpOwor
ICAgICAgICBmb3IgKCBpID0gMDsgaSA8IG47IGkrKyApIHsKKyAgICAgICAgICAgIFBNQyAqcGFy
ZW50ID0gVlRBQkxFX2dldF9wbWNfa2V5ZWRfaW50KGludGVycCwKKyAgICAgICAgICAgICAgICBf
Y2xhc3MtPmFsbF9wYXJlbnRzLCBpKTsKKyAgICAgICAgICAgIFBhcnJvdF9DbGFzcyAqcGFyZW50
X2NsYXNzID0gUEFSUk9UX0NMQVNTKHBhcmVudCk7CisKKyAgICAgICAgICAgIFBNQyAqc3ViID0g
VlRBQkxFX2dldF9wbWNfa2V5ZWRfc3RyKGludGVycCwKKyAgICAgICAgICAgICAgICBwYXJlbnRf
Y2xhc3MtPnZ0YWJsZV9tZXRob2RzLCBDT05TVF9TVFJJTkcoaW50ZXJwLCAiaW5pdCIpKTsKKyAg
ICAgICAgICAgIGlmICghUE1DX0lTX05VTEwoc3ViKSkgeworICAgICAgICAgICAgICAgIGludGVy
cC0+Y3VycmVudF9hcmdzICAgPSBhcmdfaW5kZXhlczsKKyAgICAgICAgICAgICAgICBpbnRlcnAt
PmFyZ3Nfc2lnbmF0dXJlID0gYXJnc19zaWc7CisgICAgICAgICAgICAgICAgY3R4LT5jdXJyZW50
X3Jlc3VsdHMgICA9IHJlc3VsdF9pbmRleGVzOworICAgICAgICAgICAgICAgIGN0eC0+cmVzdWx0
c19zaWduYXR1cmUgPSByZXN1bHRzX3NpZzsKKworICAgICAgICAgICAgICAgIGludGVycC0+Y3Vy
cmVudF9vYmplY3QgICAgICAgPSBvYmo7CisgICAgICAgICAgICAgICAgaW50ZXJwLT5jdXJyZW50
X2NvbnQgICAgICAgICA9IE5FRURfQ09OVElOVUFUSU9OOworICAgICAgICAgICAgICAgIGN0eC0+
Y3VycmVudF9jb250ICAgICAgICAgICAgPSByZXRfY29udDsKKyAgICAgICAgICAgICAgICBQTUNf
Y29udChyZXRfY29udCktPmZyb21fY3R4ID0gY3R4OworCisgICAgICAgICAgICAgICAgLyogRmlu
YWxseSwgY2FsbCB0aGUgc3ViICovCisgICAgICAgICAgICAgICAgUGFycm90X3J1bm9wc19mcm9t
YyhJTlRFUlAsIHN1Yik7CisgICAgICAgICAgICB9CiAgICAgICAgIH0KIAorICAgICAgICBQT2Jq
X2xpdmVfQ0xFQVIoYXJnc19zaWcpOworICAgICAgICBQT2JqX2xpdmVfQ0xFQVIocmVzdWx0c19z
aWcpOworICAgICAgICBQYXJyb3RfcG9wX2NvbnRleHQoaW50ZXJwKTsKKworICAgICAgICBpbnRl
cnAtPmN1cnJlbnRfYXJncyAgID0gc2F2ZV9jdXJyZW50X2FyZ3M7CisgICAgICAgIGludGVycC0+
YXJnc19zaWduYXR1cmUgPSBzYXZlX2FyZ3Nfc2lnbmF0dXJlOworICAgICAgICBpbnRlcnAtPmN1
cnJlbnRfb2JqZWN0ID0gc2F2ZV9jdXJyZW50X29iamVjdDsKKwogICAgICAgICBQQ0NSRVRVUk4o
UE1DICpvYmopCi0gICAgIH0KKyAgICB9CiAKIC8qCiAKQEAgLTg3MSw2ICs5NzgsNyBAQAogPWN1
dAogCiAqLworCiAgICAgUENDTUVUSE9EIHZvaWQgYXR0cmlidXRlcygpIHsKICAgICAgICAgUE1D
ICpyZXRfYXR0cmliX21ldGFkYXRhID0gVlRBQkxFX2luc3BlY3Rfc3RyKGludGVycCwgU0VMRiwg
Q09OU1RfU1RSSU5HKGludGVycCwgImF0dHJpYnV0ZXMiKSk7CiAgICAgICAgIFBDQ1JFVFVSTihQ
TUMgKnJldF9hdHRyaWJfbWV0YWRhdGEpOwpAQCAtOTIyLDYgKzEwMzAsMjAgQEAKIAogLyoKIAor
PWl0ZW0gQzx2b2lkIGFkZF92dGFibGVfbWV0aG9kKFNUUklORyAqbmFtZSwgUE1DICpzdWIpPgor
CitBZGRzIHRoZSBnaXZlbiBzdWIgUE1DIGFzIGEgdnRhYmxlIG1ldGhvZCB3aXRoIHRoZSBnaXZl
biBuYW1lLgorCis9Y3V0CisKKyovCisgICAgUENDTUVUSE9EIHZvaWQgYWRkX3Z0YWJsZV9tZXRo
b2QoU1RSSU5HICpuYW1lLCBQTUMgKnN1YikKKyAgICB7CisgICAgICAgIGFkZF92dGFibGVfbWV0
aG9kKGludGVycCwgU0VMRiwgbmFtZSwgc3ViKTsKKyAgICB9CisKKy8qCisKID1pdGVtIEM8dm9p
ZCBwYXJlbnRzKCk+CiAKIFJldHVybiB0aGUgcGFyZW50cyBhcnJheSBQTUMuCkluZGV4OiBzcmMv
cG1jL29iamVjdC5wbWMKPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PQotLS0gc3JjL3BtYy9vYmplY3QucG1jCTIwMDctMDUt
MTEgMTY6NTM6MzEuMDAwMDAwMDAwICswMDAwCisrKyBzcmMvcG1jL29iamVjdC5wbWMJMjAwNy0w
NS0xMSAxNjo1NDoxNy4wMDAwMDAwMDAgKzAwMDAKQEAgLTYxLDYgKzYxLDE2IEBACiAgICAgcmV0
dXJuIGluZGV4OwogfQogCitzdGF0aWMgdm9pZAordnRhYmxlX21ldGhfbm90X2ZvdW5kKEludGVy
cCAqaW50ZXJwLCBQTUMgKnBtYywgY29uc3QgY2hhciAqbWV0aCkKK3sKKyAgICBQYXJyb3RfT2Jq
ZWN0ICpvYmogPSBQQVJST1RfT0JKRUNUKHBtYyk7CisgICAgU1RSSU5HICpuYW1lID0gUEFSUk9U
X0NMQVNTKG9iai0+X2NsYXNzKS0+bmFtZTsKKyAgICBjb25zdCBjaGFyICpuYW1lX2MgPSBzdHJp
bmdfdG9fY3N0cmluZyhpbnRlcnAsIG5hbWUpOworCisgICAgcmVhbF9leGNlcHRpb24oaW50ZXJw
LCBOVUxMLCBFX0xvb2t1cEVycm9yLAorICAgICAgICAiQ2FuJ3QgZmluZCB2dGFibGUgbWV0aG9k
ICclcycgaW4gY2xhc3MgJyVzJyIsIG1ldGgsIG5hbWVfYyk7Cit9CiAKIHBtY2xhc3MgT2JqZWN0
IG5lZWRfZXh0IHsKIApAQCAtMjExLDYgKzIyMSwyMyBAQAogCiAvKgogCis9aXRlbSBDPFBNQyog
aW52b2tlKCk+CisKK0ludm9rZSB0aGUgb2JqZWN0IGFzIGEgbWV0aG9kLgorCis9Y3V0CisKKyov
CisgICAgb3Bjb2RlX3QqIGludm9rZSh2b2lkICpuZXh0KSB7CisgICAgICAgIFNUUklORyAqbWV0
aCA9IENPTlNUX1NUUklORyhpbnRlcnAsICJpbnZva2UiKTsKKyAgICAgICAgUE1DICpzdWIgPSBQ
YXJyb3RfQ2xhc3NfZmluZF92dGFibGVfbWV0aG9kKGludGVycCwgUEFSUk9UX09CSkVDVChTRUxG
KS0+X2NsYXNzLCBtZXRoKTsKKyAgICAgICAgaWYgKFBNQ19JU19OVUxMKHN1YikpCisgICAgICAg
ICAgICB2dGFibGVfbWV0aF9ub3RfZm91bmQoaW50ZXJwLCBwbWMsICJpbnZva2UiKTsKKyAgICAg
ICAgcmV0dXJuIFZUQUJMRV9pbnZva2UoaW50ZXJwLCBzdWIsIG5leHQpOworICAgIH0KKworLyoK
KwogPWl0ZW0gQzxQTUMqIGdldF9jbGFzcygpPgogCiBHZXQgdGhlIGNsYXNzIFBNQyByZXByZXNl
bnRpbmcgdGhlIGNsYXNzIHRoYXQgdGhpcyBvYmplY3QgaXMgYW4gaW5zdGFuY2Ugb2YuCkluZGV4
OiBsaWIvUGFycm90L1BtYzJjLnBtCj09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLS0tIGxpYi9QYXJyb3QvUG1jMmMucG0J
KHJldmlzaW9uIDE4NDU1KQorKysgbGliL1BhcnJvdC9QbWMyYy5wbQkod29ya2luZyBjb3B5KQpA
QCAtNDAsMTUgKzQwLDE0IEBACiAKIEM8JHNlbGY+IGlzIGEgaGFzaCByZWZlcmVuY2UgQzxldmFs
Pi1lZCBmcm9tIGEgRjwqLmR1bXA+IGZpbGUgZ2VuZXJhdGVkCiBieSBGPHRvb2xzL2J1aWxkL3Bt
YzJjLnBsPiBmcm9tIGEgRjwqLnBtYz4gZmlsZS4gSXQgaXMgQzxibGVzcz4tZWQgZWl0aGVyIGlu
dG8KLUM8UGFycm90OjpQbWMyYzo6U3RhbmRhcmQ+LCBvciBpbnRvIG9uZSBvZiB0aGUgb3RoZXIg
STxzcGVjaWFsPiBQTUNzOgotRjxkZWZhdWx0PiwgQzxkZWxlZ2F0ZT4sIEM8TnVsbD4sIEM8UmVm
PiBvciBDPFNoYXJlZFJlZj4uCitDPFBhcnJvdDo6UG1jMmM6OlN0YW5kYXJkPiwgb3IgaW50byBv
bmUgb2YgdGhlIG90aGVyIEk8c3BlY2lhbD4gUE1Dcy4KIAogQzwkb3B0PiBpcyBhIGhhc2ggcmVm
ZXJlbmNlLgogCiA9Y3V0CiAKIG15ICVzcGVjaWFsX2NsYXNzX25hbWUgPQotICAgIG1hcCB7ICgg
JF8sIDEgKSB9IHF3KCBTVE1SZWYgUmVmIGRlZmF1bHQgTnVsbCBkZWxlZ2F0ZSBTaGFyZWRSZWYg
ZGVsZWdfcG1jICk7CisgICAgbWFwIHsgKCAkXywgMSApIH0gcXcoIFNUTVJlZiBSZWYgZGVmYXVs
dCBOdWxsIE9iamVjdCBTaGFyZWRSZWYgZGVsZWdhdGUgZGVsZWdfcG1jICk7CiAKIHN1YiBuZXcg
ewogICAgIG15ICggJHRoaXMsICRzZWxmLCAkb3B0aW9ucyApID0gQF87CkBAIC0xMjE5LDYgKzEy
MTgsNyBAQAogcmVxdWlyZSBQYXJyb3Q6OlBtYzJjOjpkZWZhdWx0OwogcmVxdWlyZSBQYXJyb3Q6
OlBtYzJjOjpkZWxlZ2F0ZTsKIHJlcXVpcmUgUGFycm90OjpQbWMyYzo6ZGVsZWdfcG1jOworcmVx
dWlyZSBQYXJyb3Q6OlBtYzJjOjpPYmplY3Q7CiByZXF1aXJlIFBhcnJvdDo6UG1jMmM6Ok51bGw7
CiByZXF1aXJlIFBhcnJvdDo6UG1jMmM6OlJlZjsKIHJlcXVpcmUgUGFycm90OjpQbWMyYzo6U2hh
cmVkUmVmOwpJbmRleDogbGliL1BhcnJvdC9QbWMyYy9QQ0NNRVRIT0QucG0KPT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQot
LS0gbGliL1BhcnJvdC9QbWMyYy9QQ0NNRVRIT0QucG0JKHJldmlzaW9uIDE4NDU1KQorKysgbGli
L1BhcnJvdC9QbWMyYy9QQ0NNRVRIT0QucG0JKHdvcmtpbmcgY29weSkKQEAgLTUyNCw3ICs1MjQs
NyBAQAogICAgICAgUE1DX2NvbnQocmV0X2NvbnQpLT5mcm9tX2N0eCA9IGN0eDsKIAogICAgICAg
cGNjaW52b2tlX21ldGggPSBWVEFCTEVfZmluZF9tZXRob2QoaW50ZXJwLCAkaW52b2NhbnQsICRt
ZXRob2RfbmFtZSk7Ci0gICAgICBpZiAoIXBjY2ludm9rZV9tZXRoKQorICAgICAgaWYgKFBNQ19J
U19OVUxMKHBjY2ludm9rZV9tZXRoKSkKICAgICAgICAgICByZWFsX2V4Y2VwdGlvbihpbnRlcnAs
IE5VTEwsIE1FVEhfTk9UX0ZPVU5ELAogICAgICAgICAgICAgIk1ldGhvZCAnJVNzJyBub3QgZm91
bmQiLCAkbWV0aG9kX25hbWUpOwogICAgICAgZWxzZQpJbmRleDogbGliL1BhcnJvdC9QbWMyYy9P
YmplY3QucG0KPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PQotLS0gbGliL1BhcnJvdC9QbWMyYy9PYmplY3QucG0JKHJldmlz
aW9uIDApCisrKyBsaWIvUGFycm90L1BtYzJjL09iamVjdC5wbQkocmV2aXNpb24gMCkKQEAgLTAs
MCArMSwxNTggQEAKKworPWhlYWQxIFBhcnJvdDo6UG1jMmM6OmRlbGVnYXRlIEluc3RhbmNlIE1l
dGhvZHMKKworPW92ZXIgNAorCis9Y3V0CisKK3BhY2thZ2UgUGFycm90OjpQbWMyYzo6T2JqZWN0
OwordXNlIGJhc2UgJ1BhcnJvdDo6UG1jMmMnOwordXNlIHN0cmljdDsKK3VzZSB3YXJuaW5nczsK
KworPWl0ZW0gQzxpbXBsZW1lbnRzKCRtZXRob2QpPgorCitUcnVlIGZvciB2dGFibGVzLgorCis9
Y3V0CisKK3N1YiBpbXBsZW1lbnRzIHsKKyAgICBteSAoICRzZWxmLCAkbWV0aCApID0gQF87Cisg
ICAgJHNlbGYtPmltcGxlbWVudHNfdnRhYmxlKCRtZXRoKTsKK30KKworPWl0ZW0gQzx0cmFucygk
dHlwZSk+CisKK1VzZWQgaW4gQzxzaWduYXR1cmUoKT4gdG8gbm9ybWFsaXplIGFyZ3VtZW50IHR5
cGVzLgorCis9Y3V0CisKK3N1YiB0cmFucyB7CisgICAgbXkgKCAkc2VsZiwgJHR5cGUgKSA9IEBf
OworCisgICAgbXkgJGNoYXIgPSBzdWJzdHIgJHR5cGUsIDAsIDE7CisgICAgcmV0dXJuICQxIGlm
ICggJGNoYXIgPX4gLyhbSVNQXSkvICk7CisgICAgcmV0dXJuICdOJyBpZiAoICRjaGFyIGVxICdG
JyApOworICAgIHJldHVybiAndicgaWYgKCAkdHlwZSBlcSAndm9pZCcgKTsKKyAgICByZXR1cm4g
Jz8nOworfQorCis9aXRlbSBDPHNpZ25hdHVyZSgkcGFyYW1zKT4KKworUmV0dXJucyB0aGUgbWV0
aG9kIHNpZ25hdHVyZSBmb3IgQzwkcGFyYW1zPi4KKworPWN1dAorCitzdWIgc2lnbmF0dXJlIHsK
KyAgICBteSAoICRzZWxmLCAkcGFyYW1zICkgPSBAXzsKKworICAgIG15ICRuID0gMTsKKyAgICBt
eSBAdHlwZXMgPSBncmVwIHsgJG4rKyAmIDEgPyAkXyA6IDAgfSBzcGxpdCAvIC8sICRwYXJhbXM7
CisgICAgQHR5cGVzID0gbWFwIHsgJHNlbGYtPnRyYW5zKCRfKSB9IEB0eXBlczsKKyAgICByZXR1
cm4gam9pbiAnJywgQHR5cGVzOworfQorCis9aXRlbSBDPGJvZHkoJG1ldGhvZCwgJGxpbmUsICRv
dXRfbmFtZSk+CisKK1JldHVybnMgdGhlIEMgY29kZSBmb3IgdGhlIG1ldGhvZCBib2R5LiBDPCRs
aW5lPiBpcyB1c2VkIHRvIGFjY3VtdWxhdGUKK3RoZSBudW1iZXIgb2YgbGluZXMsIEM8JG91dF9u
YW1lPiBpcyB0aGUgbmFtZSBvZiB0aGUgb3V0cHV0IGZpbGUgd2UgYXJlCitnZW5lcmF0aW5nLgor
CitUaGUgQzxkZWxlZ2F0ZT4gUE1DIHJlZGlyZWN0cyBhbGwgbWV0aG9kcyB0byBieXRlY29kZS4K
KworPWJhY2sKKworPWN1dAorCitzdWIgYm9keSB7CisgICAgbXkgKCAkc2VsZiwgJG1ldGhvZCwg
JGxpbmUsICRvdXRfbmFtZSApID0gQF87CisKKyAgICBteSAkbWV0aCA9ICRtZXRob2QtPnttZXRo
fTsKKworICAgIG15ICRmdW5jX3JldCA9ICcnOworICAgIG15ICRyZXRfdHlwZSA9ICcnOworICAg
IG15ICR0eXBlID0gJG1ldGhvZC0+e3R5cGV9OworICAgIGlmICggJHR5cGUgbmUgJ3ZvaWQnICkg
eworICAgICAgICAkZnVuY19yZXQgPSAicmV0dXJuICgkdHlwZSkiOworICAgICAgICBpZiAoICR0
eXBlICF+IC9cKi8gKSB7CisgICAgICAgICAgICAkZnVuY19yZXQgPSAicmV0dXJuICI7CisgICAg
ICAgICAgICAkcmV0X3R5cGUgPSAiX3JldCIgLiBsYyBzdWJzdHIgJHR5cGUsIDAsIDE7CisgICAg
ICAgICAgICAkcmV0X3R5cGUgPSAiX3JldGkiIGlmICRyZXRfdHlwZSBlcSAnX3JldHUnOworICAg
ICAgICB9CisgICAgfQorCisgICAgbXkgJGJvZHk7CisgICAgaWYgKCBleGlzdHMgJG1ldGhvZC0+
e2xvY30gYW5kICRtZXRob2QtPntsb2N9IG5lICd2dGFibGUnICkgeworICAgICAgICAjIG1ldGhv
ZCBpcyBQQ0NNRVRIT0QsIGV0YyAtIGxldCBkZWZhdWx0IGhhbmRsZXIgZG8gaXQKKyAgICAgICAg
cmV0dXJuICRzZWxmLT5TVVBFUjo6Ym9keSggJG1ldGhvZCwgJGxpbmUsICRvdXRfbmFtZSApOwor
ICAgIH0KKyAgICBlbHNpZiAoICRzZWxmLT5TVVBFUjo6aW1wbGVtZW50cygkbWV0aCkgKSB7Cisg
ICAgICAgICMgbWV0aG9kIGlzIGltcGxlbWVudGVkIC0gZ2V0IGJvZHkgYW5kIGZvcm1hdCBpdAor
ICAgICAgICBteSAkbiAgID0gJHNlbGYtPntoYXNfbWV0aG9kfXskbWV0aH07CisgICAgICAgICRt
ZXRob2QgPSAkc2VsZi0+e21ldGhvZHN9WyRuXTsKKworICAgICAgICAkYm9keSA9ICRtZXRob2Qt
Pntib2R5fTsKKyAgICAgICAgJGJvZHkgPX4gcy9eXHQvICAgICAgICAvbWc7CisgICAgICAgICRi
b2R5ID1+IHMvXlsgXXs0fS8vbWc7CisKKyAgICAgICAgbXkgJHN0YXJ0X2lkeCA9IGluZGV4KCRi
b2R5LCAiXG4iKTsKKyAgICAgICAgJGJvZHkgICAgICAgICA9IHN1YnN0ciAkYm9keSwgJHN0YXJ0
X2lkeCsxLCBsZW5ndGgoJGJvZHkpLSRzdGFydF9pZHgtcmluZGV4KCRib2R5LCAnfScpLTE7Cisg
ICAgfQorICAgIGVsc2UgeworICAgICAgICAjIHRocm93IGV4Y2VwdGlvbgorICAgICAgICBteSAk
bnVsbF9yZXQgPSAicmV0dXJuIjsKKyAgICAgICAgJG51bGxfcmV0IC49ICIgKCR0eXBlKTAiIGlm
ICR0eXBlIG5lICd2b2lkJzsKKyAgICAgICAgJGJvZHkgPSA8PEVPQzsKK3Z0YWJsZV9tZXRoX25v
dF9mb3VuZChJTlRFUlAsIFNFTEYsICIkbWV0aCIpOworICAgICAgICAkbnVsbF9yZXQ7CitFT0MK
KyAgICB9CisKKyAgICBteSAkZGVjbCAgICAgICA9ICRzZWxmLT5kZWNsKCAkc2VsZi0+e2NsYXNz
fSwgJG1ldGhvZCwgMCApOworICAgIG15ICRwYXJhbWV0ZXJzID0gJG1ldGhvZC0+e3BhcmFtZXRl
cnN9OworICAgIG15ICRuICAgICAgICAgID0gMDsKKyAgICBteSBAYXJncyAgICAgICA9IGdyZXAg
eyAkbisrICYgMSA/ICRfIDogMCB9IHNwbGl0IC8gLywgJHBhcmFtZXRlcnM7CisgICAgbXkgJGFy
ZyAgICAgICAgPSAnJzsKKyAgICAkYXJnICAgICAgICAgICA9ICIsICIgLiBqb2luKCAnICcsIEBh
cmdzICkgaWYgQGFyZ3M7CisgICAgbXkgJHNpZyAgICAgICAgPSAkc2VsZi0+c2lnbmF0dXJlKCRw
YXJhbWV0ZXJzKTsKKyAgICAkc2lnICAgICAgICAgICA9ICRzZWxmLT50cmFucyggJG1ldGhvZC0+
e3R5cGV9ICkgLiAkc2lnOworCisgICAgJGJvZHkgPSAkc2VsZi0+cmV3cml0ZV92dGFibGVfbWV0
aG9kKCAkc2VsZi0+e2NsYXNzfSwgJG1ldGgsCisgICAgICAgICRzZWxmLT57c3VwZXJ9eyRtZXRo
fSwgJHNlbGYtPntzdXBlcn0sICRib2R5ICk7CisgICAgUGFycm90OjpQbWMyYzo6UENDTUVUSE9E
OjpyZXdyaXRlX3BjY2ludm9rZSggJG1ldGhvZCwgXCRib2R5ICk7CisKKyAgICAjIEkgdGhpbmsg
dGhhdCB0aGVzZSB3aWxsIGJlIG91dCBieSBvbmUgLSBOV0MKKyAgICBteSAkbCA9ICRzZWxmLT5s
aW5lX2RpcmVjdGl2ZSggJGxpbmUsICJvYmplY3QuYyIgKTsKKworICAgICMgbWV0aG9kcyB3ZSBk
b24ndCB3YW50IG92ZXJyaWRkZW4KKyAgICBteSBAb21pdF9tZXRocyA9IHF3KGluaXQgaW5pdF9w
bWMgaW52b2tlIGRlc3Ryb3kgbWFyayBtb3JwaCk7CisKKyAgICBpZiAoIHNjYWxhciBncmVwKC8k
bWV0aC8sIEBvbWl0X21ldGhzKSA9PSAwICkgeworICAgICAgICAkYm9keSA9IDw8RU9DOworICAg
IFNUUklORyAqX19tZXRoID0gQ09OU1RfU1RSSU5HKGludGVycCwgIiRtZXRoIik7CisgICAgUE1D
ICpfX3N1YiA9IFBhcnJvdF9DbGFzc19maW5kX3Z0YWJsZV9tZXRob2QoaW50ZXJwLCBQQVJST1Rf
T0JKRUNUKHBtYyktPl9jbGFzcywgX19tZXRoKTsKKyAgICBpZiAoUE1DX0lTX05VTEwoX19zdWIp
KSB7CisgICAgICAgICRib2R5ICAgIH0KKyAgICBlbHNlCisgICAgICAgICR7ZnVuY19yZXR9UGFy
cm90X3J1bl9tZXRoX2Zyb21jX2FyZ3MkcmV0X3R5cGUoaW50ZXJwLCBfX3N1YiwKKyAgICAgICAg
ICAgIHBtYywgX19tZXRoLCAiJHNpZyIkYXJnKTsKK0VPQworICAgIH0KKworICAgIHJldHVybiA8
PEVPQzsKKyRsCiske2RlY2x9eworJGJvZHkKK30KKworRU9DCit9CisKKzE7CisKKyMgTG9jYWwg
VmFyaWFibGVzOgorIyAgIG1vZGU6IGNwZXJsCisjICAgY3BlcmwtaW5kZW50LWxldmVsOiA0Cisj
ICAgZmlsbC1jb2x1bW46IDEwMAorIyBFbmQ6CisjIHZpbTogZXhwYW5kdGFiIHNoaWZ0d2lkdGg9
NDoKSW5kZXg6IGluY2x1ZGUvcGFycm90L29iamVjdHMuaAo9PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci0tLSBpbmNsdWRl
L3BhcnJvdC9vYmplY3RzLmgJKHJldmlzaW9uIDE4NDU1KQorKysgaW5jbHVkZS9wYXJyb3Qvb2Jq
ZWN0cy5oCSh3b3JraW5nIGNvcHkpCkBAIC01OCw2ICs1OCw3IEBACiBQQVJST1RfQVBJIHZvaWQg
UGFycm90X2ludmFsaWRhdGVfbWV0aG9kX2NhY2hlKEludGVycCosIFNUUklORyAqX2NsYXNzLCBT
VFJJTkcgKm1ldGgpOwogUEFSUk9UX0FQSSBTVFJJTkcgKnJlYWRhYmxlX25hbWUoUGFycm90X0lu
dGVycCwgUE1DICopOwogUEFSUk9UX0FQSSBJTlRWQUwgUGFycm90X2dldF92dGFibGVfaW5kZXgo
SW50ZXJwICosIFNUUklORyAqbmFtZSk7CitQQVJST1RfQVBJIFNUUklORyAqUGFycm90X2dldF92
dGFibGVfbmFtZShJbnRlcnAgKmludGVycCwgSU5UVkFMIGluZGV4KTsKIFBBUlJPVF9BUEkgUE1D
ICpQYXJyb3RfZmluZF92dGFibGVfbWV0aChJbnRlcnAqIGludGVycCwgUE1DICpwbWMsIFNUUklO
RyAqbWV0aCk7CiAKIC8qIE9iamVjdHMsIGNsYXNzZXMgYW5kIFBNQ2FycmF5cyBhbGwgdXNlIHRo
ZSBzYW1lIGRhdGEgc2NoZW1lOgo=
------=_Part_92135_15666672.1178923291060
Content-Type: application/octet-stream; name=pdd15_code_invoke.patch
Content-Transfer-Encoding: base64
X-Attachment-Id: f_f1kxleka
Content-Disposition: attachment; filename="pdd15_code_invoke.patch"

LS0tIC9ob21lL2FsZWsvcGFycm90LnBkZDE1L3NyYy9wbWMvb2JqZWN0LnBtYwkyMDA3LTA1LTEx
IDE3OjAxOjU2LjAwMDAwMDAwMCArMDAwMAorKysgc3JjL3BtYy9vYmplY3QucG1jCTIwMDctMDUt
MTEgMTc6MjQ6NDguMDAwMDAwMDAwICswMDAwCkBAIC0yMzAsMTAgKzIzMCwzNCBAQAogKi8KICAg
ICBvcGNvZGVfdCogaW52b2tlKHZvaWQgKm5leHQpIHsKICAgICAgICAgU1RSSU5HICptZXRoID0g
Q09OU1RfU1RSSU5HKGludGVycCwgImludm9rZSIpOwotICAgICAgICBQTUMgKnN1YiA9IFBhcnJv
dF9DbGFzc19maW5kX3Z0YWJsZV9tZXRob2QoaW50ZXJwLCBQQVJST1RfT0JKRUNUKFNFTEYpLT5f
Y2xhc3MsIG1ldGgpOwotICAgICAgICBpZiAoUE1DX0lTX05VTEwoc3ViKSkKKyAgICAgICAgUE1D
ICpzdWIgPSBQYXJyb3RfQ2xhc3NfZmluZF92dGFibGVfbWV0aG9kKGludGVycCwgUEFSUk9UX09C
SkVDVChwbWMpLT5fY2xhc3MsIG1ldGgpOworICAgICAgICBpZiAoUE1DX0lTX05VTEwoc3ViKSkg
ewogICAgICAgICAgICAgdnRhYmxlX21ldGhfbm90X2ZvdW5kKGludGVycCwgcG1jLCAiaW52b2tl
Iik7Ci0gICAgICAgIHJldHVybiBWVEFCTEVfaW52b2tlKGludGVycCwgc3ViLCBuZXh0KTsKKyAg
ICAgICAgICAgIHJldHVybiBOVUxMOworICAgICAgICB9CisgICAgICAgIGVsc2UgeworICAgICAg
ICAgICAgLyogU2luY2UgaW52b2tlKCkgaXMgYSBub3JtYWwgbWV0aG9kLCAnc2VsZicgbXVzdCBi
ZSBwYXNzZWQgYXMgdGhlCisgICAgICAgICAgICAgKiBmaXJzdCBhcmd1bWVudCwgYnV0IGJlY2F1
c2UgdGhpcyBsb29rcyBsaWtlIGEgbm9uLW1ldGhvZCBjYWxsIGluCisgICAgICAgICAgICAgKiBQ
SVIsIHRoZSBhcmdzIHNpZ25hdHVyZSBkb2Vzbid0IGhhdmUgaXQsIHNvIHdlIGhhdmUgdG8gZ2V0
IHRoZQorICAgICAgICAgICAgICogYXJncyBzaWduYXR1cmUgYW5kIHVuc2hpZnQgJ3NlbGYnIG9u
dG8gaXQuICovCisKKyAgICAgICAgICAgIFBNQyAqb2xkX3NpZyA9IENPTlRFWFQoaW50ZXJwLT5j
dHgpLT5jb25zdGFudHNbKihpbnRlcnAtPmN1cnJlbnRfYXJncysxKV0tPnUua2V5OworICAgICAg
ICAgICAgSU5UVkFMIHNpZ19sZW4gPSBWVEFCTEVfZWxlbWVudHMoaW50ZXJwLCBvbGRfc2lnKSAr
IDE7CisgICAgICAgICAgICBpbnQgaTsKKworICAgICAgICAgICAgUE1DICptZXRoX3NpZyA9IHBt
Y19uZXcoaW50ZXJwLCBlbnVtX2NsYXNzX0ZpeGVkSW50ZWdlckFycmF5KTsKKyAgICAgICAgICAg
IFZUQUJMRV9zZXRfaW50ZWdlcl9uYXRpdmUoaW50ZXJwLCBtZXRoX3NpZywgc2lnX2xlbik7CisK
KyAgICAgICAgICAgIFZUQUJMRV9zZXRfaW50ZWdlcl9rZXllZF9pbnQoaW50ZXJwLCBtZXRoX3Np
ZywgMCwgUEFSUk9UX0FSR19QTUMgfCBQQVJST1RfQVJHX09CSkVDVCk7CisgICAgICAgICAgICBm
b3IgKCBpID0gMTsgaSA8IHNpZ19sZW47IGkrKyApCisgICAgICAgICAgICAgICAgVlRBQkxFX3Nl
dF9pbnRlZ2VyX2tleWVkX2ludChpbnRlcnAsIG1ldGhfc2lnLCBpLCBWVEFCTEVfZ2V0X2ludGVn
ZXJfa2V5ZWRfaW50KGludGVycCwgb2xkX3NpZywgaS0xKSk7CisKKyAgICAgICAgICAgIGludGVy
cC0+YXJnc19zaWduYXR1cmUgPSBtZXRoX3NpZzsKKyAgICAgICAgICAgIGludGVycC0+Y3VycmVu
dF9hcmdzKys7CisKKyAgICAgICAgICAgIElOVEVSUC0+Y3VycmVudF9vYmplY3QgPSBTRUxGOwor
ICAgICAgICAgICAgcmV0dXJuIFZUQUJMRV9pbnZva2UoaW50ZXJwLCBzdWIsIG5leHQpOworICAg
ICAgICB9CiAgICAgfQogCiAvKgo=
------=_Part_92135_15666672.1178923291060--

