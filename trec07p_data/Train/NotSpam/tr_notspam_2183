From sugar-bounces@laptop.org  Mon Apr 16 16:19:14 2007
Return-Path: <sugar-bounces@laptop.org>
Received: from pedal.laptop.org (pedal.laptop.org [18.85.2.148])
	by speedy.uwaterloo.ca (8.12.8/8.12.5) with ESMTP id l3GKJD0I018319
	for <ktwarwic@speedy.uwaterloo.ca>; Mon, 16 Apr 2007 16:19:13 -0400
Received: from pedal.laptop.org (localhost [127.0.0.1])
	by pedal.laptop.org (Postfix) with ESMTP id D2BD54F876;
	Mon, 16 Apr 2007 16:18:23 -0400 (EDT)
X-Original-To: sugar@laptop.org
Delivered-To: sugar@laptop.org
Received: from spam.laptop.org (spam.laptop.org [18.85.46.23])
	by pedal.laptop.org (Postfix) with ESMTP id D75354F873
	for <sugar@laptop.org>; Mon, 16 Apr 2007 16:18:22 -0400 (EDT)
X-ASG-Debug-ID: 1176754726-587200000000-3Xmyjt
X-Barracuda-URL: http://18.85.46.23:8000/cgi-bin/mark.cgi
X-Barracuda-Connect: theworths.org[217.160.253.102]
X-Barracuda-Start-Time: 1176754726
X-Barracuda-Encrypted: DHE-RSA-AES256-SHA
Received: from theworths.org (theworths.org [217.160.253.102])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by spam.laptop.org (Spam Firewall) with ESMTP id 51DBF2C98
	for <sugar@laptop.org>; Mon, 16 Apr 2007 16:18:47 -0400 (EDT)
Received: (qmail 16145 invoked from network); 16 Apr 2007 16:18:46 -0400
Received: from localhost (HELO raht.cworth.org) (127.0.0.1)
	by localhost with SMTP; 16 Apr 2007 16:18:46 -0400
Date: Mon, 16 Apr 2007 13:18:44 -0700
Message-ID: <87d524t6mz.wl%cworth@cworth.org>
From: Carl Worth <cworth@redhat.com>
To: Dan Williams <dcbw@redhat.com>
X-ASG-Orig-Subj: Re: [sugar] Cairo tile engine,
	and accessing 565 buffers	from	cairo and C
In-Reply-To: <1176753788.29852.17.camel@localhost.localdomain>
References: <461F508F.8000406@rpi.edu> <46216D8A.4000103@DonHopkins.com>
	<1176615055.864.14.camel@localhost.localdomain>
	<87fy70tdn9.wl%cworth@cworth.org>
	<1176753788.29852.17.camel@localhost.localdomain>
User-Agent: Wanderlust/2.14.0 (Africa) Emacs/21.4 Mule/5.0 (SAKAKI)
Organization: Red Hat
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
X-Barracuda-Bayes: INNOCENT GLOBAL 0.0000 1.0000 -2.0210
X-Barracuda-Virus-Scanned: by Barracuda Spam Firewall at laptop.org
X-Barracuda-Spam-Score: -2.02
X-Barracuda-Spam-Status: No, SCORE=-2.02 using global scores of TAG_LEVEL=3.5
	QUARANTINE_LEVEL=1000.0 KILL_LEVEL=5.5 tests=
X-Barracuda-Spam-Report: Code version 3.1, rules version 3.1.14387
	Rule breakdown below
	pts rule name              description
	---- ----------------------
	--------------------------------------------------
Cc: Games for the OLPC <games@laptop.org>,
   "OLPC Developer's List" <devel@laptop.org>,
   "'Sugar List'" <sugar@laptop.org>, Don Hopkins <dhopkins@DonHopkins.com>
Subject: Re: [sugar] Cairo tile engine,
	and accessing 565 buffers	from	cairo and C
X-BeenThere: sugar@laptop.org
X-Mailman-Version: 2.1.9
Precedence: list
List-Id: "Discussion of OLPC design,
	desktop platform and user experience" <sugar.laptop.org>
List-Unsubscribe: <http://mailman.laptop.org/mailman/listinfo/sugar>,
	<mailto:sugar-request@laptop.org?subject=unsubscribe>
List-Archive: <http://mailman.laptop.org/pipermail/sugar>
List-Post: <mailto:sugar@laptop.org>
List-Help: <mailto:sugar-request@laptop.org?subject=help>
List-Subscribe: <http://mailman.laptop.org/mailman/listinfo/sugar>,
	<mailto:sugar-request@laptop.org?subject=subscribe>
Content-Type: multipart/mixed; boundary="===============6113675470379307345=="
Mime-version: 1.0
Sender: sugar-bounces@laptop.org
Errors-To: sugar-bounces@laptop.org
Status: O
Content-Length: 3059
Lines: 84

--===============6113675470379307345==
Content-Type: multipart/signed;
 boundary="pgp-sign-Multipart_Mon_Apr_16_13:18:44_2007-1"; micalg=pgp-sha1;
 protocol="application/pgp-signature"
Content-Transfer-Encoding: 7bit

--pgp-sign-Multipart_Mon_Apr_16_13:18:44_2007-1
Content-Type: text/plain; charset=US-ASCII

On Mon, 16 Apr 2007 16:03:08 -0400, Dan Williams wrote:
>     source = cairo_surface_create_similar (target,
> 			CAIRO_CONTENT_COLOR_ALPHA,
> 			width, height);
>
> gives you a 32-bit ARGB surface.

Yes, this is what I described as a likely cause.

Now, are you getting an xlib surface or an image surface from that?

> I can understand why; but in our case it's undesirable.  We'd rather
> have 16bpp, but _some_ kind of alpha.

This is why I asked what the X server provides. Is there some X server
visual that provides that? If so, then it's really trivial to fix
cairo_surface_create_similar to just use that and we're done.

> Ideally we could ask Cairo to create a surface of _any_ type we want,
> either 1555, 4444, 0565, 8888, 0888, 0444, etc.  But cairo can't do that
> AFAIK.  That's why I said "grudgingly supports 565" and "it's native
> format is really 32bpp".  When I say "manually create" a surface, I mean
> telling cairo _exactly_ what format of surface you want.

I still say that's a total mischaracterization of cairo.

Cairo's _image_ backend only accepts 32-bit surfaces. But the xlib
backend is usually much more _native_ anyway, (it's what lets you get
at access to GPU capabilities for example). And when "manually
creating" a surface with cairo's xlib backend you can definitely
create a surface with _exactly_ whatever formats are supported by your
X server.

When I say "manually creating" I mean using cairo_xlib_surface_create
instead of cairo_surface_create_similar. If you want an xlib surface
with a particular format, then you should be asking for it.

The reason to use cairo_surface_create_similar is when you don't
particularly care what kind of surface you want, (you likely don't
know what type the target surface is), and you just want to get the
best possible. And we can still fix the implementation of how cairo
implements "best possible".

But in the meantime, you can absolutely avoid that by just calling
cairo_xlib_surface_create with any X server visual. And cairo won't be
grudging at all.

-Carl

--pgp-sign-Multipart_Mon_Apr_16_13:18:44_2007-1
Content-Type: application/pgp-signature
Content-Transfer-Encoding: 7bit

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)

iD8DBQBGI9ok6JDdNq8qSWgRAokJAJ9A0u8K/i2mC2vmv6Om7Bs8Ml2KXACgklwp
Zd4mvZ0tr4i2AJfFk2ckI6Y=
=w7sC
-----END PGP SIGNATURE-----

--pgp-sign-Multipart_Mon_Apr_16_13:18:44_2007-1--

--===============6113675470379307345==
Content-Type: text/plain; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

_______________________________________________
Sugar mailing list
Sugar@laptop.org
http://mailman.laptop.org/mailman/listinfo/sugar

--===============6113675470379307345==--

