From samba-technical-bounces+ktwarwic=speedy.uwaterloo.ca@lists.samba.org  Thu Apr 12 09:41:28 2007
Return-Path: <samba-technical-bounces+ktwarwic=speedy.uwaterloo.ca@lists.samba.org>
Received: from lists.samba.org (mail.samba.org [66.70.73.150])
	by speedy.uwaterloo.ca (8.12.8/8.12.5) with ESMTP id l3CDfS0I030228
	for <ktwarwic@speedy.uwaterloo.ca>; Thu, 12 Apr 2007 09:41:28 -0400
Received: from dp.samba.org (localhost [127.0.0.1])
	by lists.samba.org (Postfix) with ESMTP id 1DEFA16381B
	for <ktwarwic@speedy.uwaterloo.ca>; Thu, 12 Apr 2007 13:41:05 +0000 (GMT)
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on dp.samba.org
X-Spam-Level: 
X-Spam-Status: No, score=-2.1 required=3.8 tests=ALL_TRUSTED,AWL,BAYES_00,
	RCVD_IN_DSBL autolearn=ham version=3.1.7
X-Original-To: samba-technical@lists.samba.org
Delivered-To: samba-technical@lists.samba.org
Received: from localhost.localdomain (localhost [127.0.0.1])
	by lists.samba.org (Postfix) with ESMTP id 58E2E162AD5;
	Thu, 12 Apr 2007 13:40:15 +0000 (GMT)
From: Andrew Bartlett <abartlet@samba.org>
To: Samba Technical <samba-technical@lists.samba.org>
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature";
	boundary="=-232FtEZ8rboVq3wUgPj0"
Date: Thu, 12 Apr 2007 23:40:12 +1000
Message-Id: <1176385212.8644.78.camel@localhost.localdomain>
Mime-Version: 1.0
X-Mailer: Evolution 2.6.3 (2.6.3-1.fc5.5) 
Cc: "Stefan \(metze\) Metzmacher" <metze@samba.org>
Subject: [PATCH] Test Samba4 PKINIT code, update socket-wrapper
X-BeenThere: samba-technical@lists.samba.org
X-Mailman-Version: 2.1.5
Precedence: list
List-Id: "Discussions on Samba internals. For general questions please
	subscribe to the list samba@samba.org"
	<samba-technical.lists.samba.org>
List-Unsubscribe: <https://lists.samba.org/mailman/listinfo/samba-technical>, 
	<mailto:samba-technical-request@lists.samba.org?subject=unsubscribe>
List-Archive: <http://lists.samba.org/archive/samba-technical>
List-Post: <mailto:samba-technical@lists.samba.org>
List-Help: <mailto:samba-technical-request@lists.samba.org?subject=help>
List-Subscribe: <https://lists.samba.org/mailman/listinfo/samba-technical>,
	<mailto:samba-technical-request@lists.samba.org?subject=subscribe>
Sender: samba-technical-bounces+ktwarwic=speedy.uwaterloo.ca@lists.samba.org
Errors-To: samba-technical-bounces+ktwarwic=speedy.uwaterloo.ca@lists.samba.org
Status: O
Content-Length: 32911
Lines: 460


--=-232FtEZ8rboVq3wUgPj0
Content-Type: multipart/mixed; boundary="=-DQ0UYvJAq8hTMIkJZ3yh"


--=-DQ0UYvJAq8hTMIkJZ3yh
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

Attached are two patches.  The first makes Samba4 test it's PKINIT code,
by use of the kinit binary (this was imported earlier today, but needs
this work to use socket_wrapper).

The second patch is the modifications to socket_wrapper to support IPv6,
which we need for Heimdal's kinit to play nice.

Andrew Bartlett
--=20
Andrew Bartlett                                http://samba.org/~abartlet/
Authentication Developer, Samba Team           http://samba.org
Samba Developer, Red Hat Inc.                  http://redhat.com

--=-DQ0UYvJAq8hTMIkJZ3yh
Content-Disposition: attachment; filename=heimdal-kinit.patch
Content-Transfer-Encoding: base64
Content-Type: text/x-patch; name=heimdal-kinit.patch; charset=UTF-8

SW5kZXg6IHRlc3Rwcm9ncy9ibGFja2JveC90ZXN0X2tpbml0LnNoDQo9PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQotLS0g
dGVzdHByb2dzL2JsYWNrYm94L3Rlc3Rfa2luaXQuc2gJKHJldmlzaW9uIDApDQorKysgdGVzdHBy
b2dzL2JsYWNrYm94L3Rlc3Rfa2luaXQuc2gJKHJldmlzaW9uIDApDQpAQCAtMCwwICsxLDQ1IEBA
DQorIyEvYmluL3NoDQorDQoraWYgWyAkIyAtbHQgNSBdOyB0aGVuDQorY2F0IDw8RU9GDQorVXNh
Z2U6IHRlc3Rfa2luaXQuc2ggU0VSVkVSIFVTRVJOQU1FIFBBU1NXT1JEIFJFQUxNIFBSRUZJWA0K
K0VPRg0KK2V4aXQgMTsNCitmaQ0KKw0KK1NFUlZFUj0kMQ0KK1VTRVJOQU1FPSQyDQorUEFTU1dP
UkQ9JDMNCitSRUFMTT0kNA0KK1BSRUZJWD0kNQ0KK3NoaWZ0IDUNCitmYWlsZWQ9MA0KKw0KK3Rl
c3RpdCgpIHsNCisJbmFtZT0iJDEiDQorCXNoaWZ0DQorCWNtZGxpbmU9IiQqIg0KKwllY2hvICJ0
ZXN0OiAkbmFtZSINCisJJGNtZGxpbmUNCisJc3RhdHVzPSQ/DQorCWlmIFsgeCRzdGF0dXMgPSB4
MCBdOyB0aGVuDQorCQllY2hvICJzdWNjZXNzOiAkbmFtZSINCisJZWxzZQ0KKwkJZWNobyAiZmFp
bHVyZTogJG5hbWUiDQorCWZpDQorCXJldHVybiAkc3RhdHVzDQorfQ0KKw0KK0tSQjVDQ05BTUU9
YHB3ZGAvdG1wY2NhY2hlDQorZXhwb3J0IEtSQjVDQ05BTUUNCisNCitlY2hvICRQQVNTV09SRCA+
IC4vdG1wcGFzc2ZpbGUNCit0ZXN0aXQgImtpbml0IHdpdGggcGFzc3dvcmQiIHNhbWJhNGtpbml0
IC0tcGFzc3dvcmQtZmlsZT0uL3RtcHBhc3NmaWxlIC0tcmVxdWVzdC1wYWMgJFVTRVJOQU1FQCRS
RUFMTSAgIHx8IGZhaWxlZD1gZXhwciAkZmFpbGVkICsgMWANCit0ZXN0aXQgImtpbml0IHdpdGgg
cGtpbml0IiBzYW1iYTRraW5pdCAtLXJlcXVlc3QtcGFjIC0tcGstdXNlcj1GSUxFOiRQUkVGSVgv
ZGMvcHJpdmF0ZS90bHMvYWRtaW5jZXJ0LnBlbSwkUFJFRklYL2RjL3ByaXZhdGUvdGxzL2FkbWlu
a2V5LnBlbSAkVVNFUk5BTUVAJFJFQUxNIHx8IGZhaWxlZD1gZXhwciAkZmFpbGVkICsgMWANCisN
CitlY2hvIGxzIHwgdGVzdGl0ICJUZXN0IGxvZ2luIHdpdGgga2VyYmVyb3MgY2NhY2hlIiAkVkFM
R1JJTkQgYmluL3NtYmNsaWVudCAkQ09ORklHVVJBVElPTiAvLyRTRVJWRVIvdG1wIC1rIHllcyB8
fCBmYWlsZWQ9YGV4cHIgJGZhaWxlZCArIDFgDQorDQordGVzdGl0ICJkb21haW4gam9pbiB3aXRo
IGtlcmJlcm9zIGNjYWNoZSIgJFZBTEdSSU5EIGJpbi9uZXQgam9pbiAkRE9NQUlOICRDT05GSUdV
UkFUSU9OICAtVyAiJERPTUFJTiIgLWsgeWVzICRADQorDQorcm0gLWYgdG1wY2NmaWxlIHRtcHBh
c3NmaWxlDQorZXhpdCAkZmFpbGVkDQpJbmRleDogc291cmNlL3NjcmlwdC90ZXN0cy90ZXN0X2Js
YWNrYm94LnNoDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09DQotLS0gc291cmNlL3NjcmlwdC90ZXN0cy90ZXN0X2JsYWNr
Ym94LnNoCShyZXZpc2lvbiAyMjE4NykNCisrKyBzb3VyY2Uvc2NyaXB0L3Rlc3RzL3Rlc3RfYmxh
Y2tib3guc2gJKHdvcmtpbmcgY29weSkNCkBAIC0xNyw0ICsxNyw2IEBADQogLiAkaW5jZGlyL3Rl
c3RfZnVuY3Rpb25zLnNoDQogDQogcGxhbnRlc3QgImJsYWNrYm94LnNtYmNsaWVudCIgZGMgJGlu
Y2Rpci8uLi8uLi8uLi90ZXN0cHJvZ3MvYmxhY2tib3gvdGVzdF9zbWJjbGllbnQuc2ggIlwkTkVU
QklPU05BTUUiICJcJFVTRVJOQU1FIiAiXCRQQVNTV09SRCIgIlwkRE9NQUlOIiAiJFBSRUZJWCIg
IiRBRERBUkdTIg0KK3BsYW50ZXN0ICJibGFja2JveC5raW5pdCIgZGMgJGluY2Rpci8uLi8uLi8u
Li90ZXN0cHJvZ3MvYmxhY2tib3gvdGVzdF9raW5pdC5zaCAiXCRORVRCSU9TTkFNRSIgIlwkVVNF
Uk5BTUUiICJcJFBBU1NXT1JEIiAiXCRSRUFMTSIgIiRQUkVGSVgiICIkQUREQVJHUyINCisNCiBw
bGFudGVzdCAiYmxhY2tib3guY2lmc2RkIiBkYyAkaW5jZGlyLy4uLy4uLy4uL3Rlc3Rwcm9ncy9i
bGFja2JveC90ZXN0X2NpZnNkZC5zaCAiXCRORVRCSU9TTkFNRSIgIlwkVVNFUk5BTUUiICJcJFBB
U1NXT1JEIiAiXCRET01BSU4iICIkQUREQVJHUyINCkluZGV4OiBzb3VyY2Uvc2NyaXB0L3Rlc3Rz
L3NlbGZ0ZXN0LnBsDQo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09DQotLS0gc291cmNlL3NjcmlwdC90ZXN0cy9zZWxmdGVz
dC5wbAkocmV2aXNpb24gMjIxNzcpDQorKysgc291cmNlL3NjcmlwdC90ZXN0cy9zZWxmdGVzdC5w
bAkod29ya2luZyBjb3B5KQ0KQEAgLTU1OCw3ICs1NTgsNyBAQA0KIAl9DQogCXdyaXRlX2NsaWVu
dGNvbmYoJGNvbmZmaWxlLCAkdGVzdGVudl92YXJzKTsNCiAJZm9yZWFjaCAoIlBBU1NXT1JEIiwg
IkRPTUFJTiIsICJTRVJWRVIiLCAiVVNFUk5BTUUiLCAiTkVUQklPU05BTUUiLCANCi0JCQkgIktS
QjVfQ09ORklHIikgew0KKwkJCSAiS1JCNV9DT05GSUciLCAiUkVBTE0iKSB7DQogCQlpZiAoZGVm
aW5lZCgkdGVzdGVudl92YXJzLT57JF99KSkgew0KIAkJCSRFTlZ7JF99ID0gJHRlc3RlbnZfdmFy
cy0+eyRffTsNCiAJCX0gZWxzZSB7DQpJbmRleDogc291cmNlL2hlaW1kYWxfYnVpbGQvcm9rZW4u
aA0KPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PQ0KLS0tIHNvdXJjZS9oZWltZGFsX2J1aWxkL3Jva2VuLmgJKHJldmlzaW9u
IDIyMTY2KQ0KKysrIHNvdXJjZS9oZWltZGFsX2J1aWxkL3Jva2VuLmgJKHdvcmtpbmcgY29weSkN
CkBAIC02OSw3ICs2OSw5IEBADQogI2RlZmluZSBIQVZFX0lOTkVUR1INCiAjZW5kaWYNCiANCi0j
dW5kZWYgU09DS0VUX1dSQVBQRVJfUkVQTEFDRQ0KKyNpZmRlZiBTT0NLRVRfV1JBUFBFUg0KKyNk
ZWZpbmUgU09DS0VUX1dSQVBQRVJfUkVQTEFDRSBTT0NLRVRfV1JBUFBFUg0KKyNlbmRpZg0KIA0K
ICNpbmNsdWRlICJoZWltZGFsL2xpYi9yb2tlbi9yb2tlbi5oLmluIg0KICNlbmRpZg0KSW5kZXg6
IHNvdXJjZS9oZWltZGFsX2J1aWxkL2NvbmZpZy5taw0KPT09PT09PT09PT09PT09PT09PT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQ0KLS0tIHNvdXJjZS9o
ZWltZGFsX2J1aWxkL2NvbmZpZy5tawkocmV2aXNpb24gMjIxOTEpDQorKysgc291cmNlL2hlaW1k
YWxfYnVpbGQvY29uZmlnLm1rCSh3b3JraW5nIGNvcHkpDQpAQCAtNDkyLDYgKzQ5Miw3IEBADQog
CS4uL2hlaW1kYWwvbGliL3Jva2VuL2VjYWxsb2MuaG8gXA0KIAkuLi9oZWltZGFsL2xpYi9hc24x
L3N5bWJvbC5obyBcDQogCS4uL2hlaW1kYWwvbGliL3ZlcnMvcHJpbnRfdmVyc2lvbi5obyBcDQor
CS4uL2xpYi9zb2NrZXRfd3JhcHBlci9zb2NrZXRfd3JhcHBlci5obyBcDQogCXJlcGxhY2UuaG8N
CiBQUklWQVRFX0RFUEVOREVOQ0lFUyA9IEhFSU1EQUxfQVNOMV9DT01QSUxFX0xFWCBIRUlNREFM
X1JPS0VOX0dFVFBST0dOQU1FX0gNCiAjIEVuZCBCSU5BUlkgYXNuMV9jb21waWxlDQpAQCAtNTE3
LDYgKzUxOCw3IEBADQogCS4uL2hlaW1kYWwvbGliL3Jva2VuL2dldF93aW5kb3dfc2l6ZS5obyBc
DQogCS4uL2hlaW1kYWwvbGliL3Jva2VuL3N0cnVwci5obyBcDQogCS4uL2hlaW1kYWwvbGliL3Jv
a2VuL3NldHByb2duYW1lLmhvIFwNCisJLi4vbGliL3NvY2tldF93cmFwcGVyL3NvY2tldF93cmFw
cGVyLmhvIFwNCiAJcmVwbGFjZS5obw0KIFBSSVZBVEVfREVQRU5ERU5DSUVTID0gSEVJTURBTF9D
T01fRVJSX0NPTVBJTEVfTEVYIEhFSU1EQUxfUk9LRU5fR0VUUFJPR05BTUVfSA0KICMgRW5kIEJJ
TkFSWSBjb21waWxlX2V0DQo=


--=-DQ0UYvJAq8hTMIkJZ3yh
Content-Disposition: attachment; filename=heimdal-socket_wrapper.patch
Content-Transfer-Encoding: base64
Content-Type: text/x-patch; name=heimdal-socket_wrapper.patch; charset=UTF-8

SW5kZXg6IHNvdXJjZS9saWIvc29ja2V0X3dyYXBwZXIvc29ja2V0X3dyYXBwZXIuYw0KPT09PT09
PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09
PT09PQ0KLS0tIHNvdXJjZS9saWIvc29ja2V0X3dyYXBwZXIvc29ja2V0X3dyYXBwZXIuYwkocmV2
aXNpb24gMjIxNTkpDQorKysgc291cmNlL2xpYi9zb2NrZXRfd3JhcHBlci9zb2NrZXRfd3JhcHBl
ci5jCSh3b3JraW5nIGNvcHkpDQpAQCAtMTQ2LDkgKzE0NiwxMyBAQA0KICNkZWZpbmUgU09DS0VU
X0ZPUk1BVCAiJWMlMDJYJTA0WCINCiAjZGVmaW5lIFNPQ0tFVF9UWVBFX0NIQVJfVENQCQknVCcN
CiAjZGVmaW5lIFNPQ0tFVF9UWVBFX0NIQVJfVURQCQknVScNCisjZGVmaW5lIFNPQ0tFVF9UWVBF
X0NIQVJfVENQX1Y2CQknWCcNCisjZGVmaW5lIFNPQ0tFVF9UWVBFX0NIQVJfVURQX1Y2CQknWScN
CiANCiAjZGVmaW5lIE1BWF9XUkFQUEVEX0lOVEVSRkFDRVMgMTYNCiANCisjZGVmaW5lIFNXX0lQ
VjZfQUREUkVTUyAxDQorDQogc3RhdGljIHN0cnVjdCBzb2NrYWRkciAqc29ja2FkZHJfZHVwKGNv
bnN0IHZvaWQgKmRhdGEsIHNvY2tsZW5fdCBsZW4pDQogew0KIAlzdHJ1Y3Qgc29ja2FkZHIgKnJl
dCA9IChzdHJ1Y3Qgc29ja2FkZHIgKiltYWxsb2MobGVuKTsNCkBAIC0xNTYsNiArMTYwLDM1IEBA
DQogCXJldHVybiByZXQ7DQogfQ0KIA0KK3N0YXRpYyB2b2lkIHNldF9wb3J0KGludCBmYW1pbHks
IGludCBwcnQsIHN0cnVjdCBzb2NrYWRkciAqYWRkcikNCit7DQorCXN3aXRjaCAoZmFtaWx5KSB7
DQorCWNhc2UgQUZfSU5FVDoNCisJCSgoc3RydWN0IHNvY2thZGRyX2luICopYWRkciktPnNpbl9w
b3J0ID0gaHRvbnMocHJ0KTsNCisJCWJyZWFrOw0KKyNpZmRlZiBIQVZFX0lQVjYNCisJY2FzZSBB
Rl9JTkVUNjoNCisJCSgoc3RydWN0IHNvY2thZGRyX2luNiAqKWFkZHIpLT5zaW42X3BvcnQgPSBo
dG9ucyhwcnQpOw0KKwkJYnJlYWs7DQorI2VuZGlmDQorCX0NCit9DQorDQorc3RhdGljIGludCBz
b2NrZXRfbGVuZ3RoKGludCBmYW1pbHkpDQorew0KKwlzd2l0Y2ggKGZhbWlseSkgew0KKwljYXNl
IEFGX0lORVQ6DQorCQlyZXR1cm4gc2l6ZW9mKHN0cnVjdCBzb2NrYWRkcl9pbik7DQorI2lmZGVm
IEhBVkVfSVBWNg0KKwljYXNlIEFGX0lORVQ2Og0KKwkJcmV0dXJuIHNpemVvZihzdHJ1Y3Qgc29j
a2FkZHJfaW42KTsNCisjZW5kaWYNCisJfQ0KKwlyZXR1cm4gLTE7DQorfQ0KKw0KKw0KKw0KIHN0
cnVjdCBzb2NrZXRfaW5mbw0KIHsNCiAJaW50IGZkOw0KQEAgLTIwNCwyNiArMjM3LDIzIEBADQog
CWNvbnN0IGNoYXIgKnMgPSBnZXRlbnYoIlNPQ0tFVF9XUkFQUEVSX0RFRkFVTFRfSUZBQ0UiKTsN
CiAJaWYgKHMpIHsNCiAJCXVuc2lnbmVkIGludCBpZmFjZTsNCi0JCWlmYWNlID0gYXRvaShzKTsN
Ci0JCWlmIChpZmFjZSA+PSAxICYmIGlmYWNlIDw9IE1BWF9XUkFQUEVEX0lOVEVSRkFDRVMpIHsN
Ci0JCQlyZXR1cm4gaWZhY2U7DQorCQlpZiAoc3NjYW5mKHMsICIldSIsICZpZmFjZSkgPT0gMSkg
ew0KKwkJCWlmIChpZmFjZSA+PSAxICYmIGlmYWNlIDw9IE1BWF9XUkFQUEVEX0lOVEVSRkFDRVMp
IHsNCisJCQkJcmV0dXJuIGlmYWNlOw0KKwkJCX0NCiAJCX0NCiAJfQ0KIA0KIAlyZXR1cm4gMTsv
KiAxMjcuMC4wLjEgKi8NCiB9DQogDQotc3RhdGljIGludCBjb252ZXJ0X3VuX2luKGNvbnN0IHN0
cnVjdCBzb2NrYWRkcl91biAqdW4sIHN0cnVjdCBzb2NrYWRkcl9pbiAqaW4sIHNvY2tsZW5fdCAq
bGVuKQ0KK3N0YXRpYyBpbnQgY29udmVydF91bl9pbihjb25zdCBzdHJ1Y3Qgc29ja2FkZHJfdW4g
KnVuLCBzdHJ1Y3Qgc29ja2FkZHIgKmluLCBzb2NrbGVuX3QgKmxlbikNCiB7DQogCXVuc2lnbmVk
IGludCBpZmFjZTsNCiAJdW5zaWduZWQgaW50IHBydDsNCiAJY29uc3QgY2hhciAqcDsNCiAJY2hh
ciB0eXBlOw0KIA0KLQlpZiAoKCpsZW4pIDwgc2l6ZW9mKHN0cnVjdCBzb2NrYWRkcl9pbikpIHsN
Ci0JCXJldHVybiAwOw0KLQl9DQotDQogCXAgPSBzdHJyY2hyKHVuLT5zdW5fcGF0aCwgJy8nKTsN
CiAJaWYgKHApIHArKzsgZWxzZSBwID0gdW4tPnN1bl9wYXRoOw0KIA0KQEAgLTIzMiw4MCArMjYy
LDE0NSBAQA0KIAkJcmV0dXJuIC0xOw0KIAl9DQogDQotCWlmICh0eXBlICE9IFNPQ0tFVF9UWVBF
X0NIQVJfVENQICYmIHR5cGUgIT0gU09DS0VUX1RZUEVfQ0hBUl9VRFApIHsNCisJaWYgKGlmYWNl
ID09IDAgfHwgaWZhY2UgPiBNQVhfV1JBUFBFRF9JTlRFUkZBQ0VTKSB7DQogCQllcnJubyA9IEVJ
TlZBTDsNCiAJCXJldHVybiAtMTsNCiAJfQ0KIA0KLQlpZiAoaWZhY2UgPT0gMCB8fCBpZmFjZSA+
IE1BWF9XUkFQUEVEX0lOVEVSRkFDRVMpIHsNCisJaWYgKHBydCA+IDB4RkZGRikgew0KIAkJZXJy
bm8gPSBFSU5WQUw7DQogCQlyZXR1cm4gLTE7DQogCX0NCiANCi0JaWYgKHBydCA+IDB4RkZGRikg
ew0KKwlzd2l0Y2godHlwZSkgew0KKwljYXNlIFNPQ0tFVF9UWVBFX0NIQVJfVENQOg0KKwljYXNl
IFNPQ0tFVF9UWVBFX0NIQVJfVURQOiB7DQorCQlzdHJ1Y3Qgc29ja2FkZHJfaW4gKmluMiA9IChz
dHJ1Y3Qgc29ja2FkZHJfaW4gKilpbjsNCisJCQ0KKwkJaWYgKCgqbGVuKSA8IHNpemVvZigqaW4y
KSkgew0KKwkJICAgIGVycm5vID0gRUlOVkFMOw0KKwkJICAgIHJldHVybiAtMTsNCisJCX0NCisN
CisJCW1lbXNldChpbjIsIDAsIHNpemVvZigqaW4yKSk7DQorCQlpbjItPnNpbl9mYW1pbHkgPSBB
Rl9JTkVUOw0KKwkJaW4yLT5zaW5fYWRkci5zX2FkZHIgPSBodG9ubCgoMTI3PDwyNCkgfCBpZmFj
ZSk7DQorCQlpbjItPnNpbl9wb3J0ID0gaHRvbnMocHJ0KTsNCisNCisJCSpsZW4gPSBzaXplb2Yo
KmluMik7DQorCQlicmVhazsNCisJfQ0KKyNpZmRlZiBIQVZFX0lQVjYNCisJY2FzZSBTT0NLRVRf
VFlQRV9DSEFSX1RDUF9WNjoNCisJY2FzZSBTT0NLRVRfVFlQRV9DSEFSX1VEUF9WNjogew0KKwkJ
c3RydWN0IHNvY2thZGRyX2luNiAqaW4yID0gKHN0cnVjdCBzb2NrYWRkcl9pbjYgKilpbjsNCisJ
CQ0KKwkJaWYgKCgqbGVuKSA8IHNpemVvZigqaW4yKSkgew0KKwkJCWVycm5vID0gRUlOVkFMOw0K
KwkJCXJldHVybiAtMTsNCisJCX0NCisNCisJCW1lbXNldChpbjIsIDAsIHNpemVvZigqaW4yKSk7
DQorCQlpbjItPnNpbjZfZmFtaWx5ID0gQUZfSU5FVDY7DQorCQlpbjItPnNpbjZfYWRkci5zNl9h
ZGRyWzBdID0gU1dfSVBWNl9BRERSRVNTOw0KKwkJaW4yLT5zaW42X3BvcnQgPSBodG9ucyhwcnQp
Ow0KKw0KKwkJKmxlbiA9IHNpemVvZigqaW4yKTsNCisJCWJyZWFrOw0KKwl9DQorI2VuZGlmDQor
CWRlZmF1bHQ6DQogCQllcnJubyA9IEVJTlZBTDsNCiAJCXJldHVybiAtMTsNCiAJfQ0KIA0KLQlp
bi0+c2luX2ZhbWlseSA9IEFGX0lORVQ7DQotCWluLT5zaW5fYWRkci5zX2FkZHIgPSBodG9ubCgo
MTI3PDwyNCkgfCBpZmFjZSk7DQotCWluLT5zaW5fcG9ydCA9IGh0b25zKHBydCk7DQotDQotCSps
ZW4gPSBzaXplb2Yoc3RydWN0IHNvY2thZGRyX2luKTsNCiAJcmV0dXJuIDA7DQogfQ0KIA0KLXN0
YXRpYyBpbnQgY29udmVydF9pbl91bl9yZW1vdGUoc3RydWN0IHNvY2tldF9pbmZvICpzaSwgY29u
c3Qgc3RydWN0IHNvY2thZGRyX2luICppbiwgc3RydWN0IHNvY2thZGRyX3VuICp1biwNCitzdGF0
aWMgaW50IGNvbnZlcnRfaW5fdW5fcmVtb3RlKHN0cnVjdCBzb2NrZXRfaW5mbyAqc2ksIGNvbnN0
IHN0cnVjdCBzb2NrYWRkciAqaW5hZGRyLCBzdHJ1Y3Qgc29ja2FkZHJfdW4gKnVuLA0KIAkJCQlp
bnQgKmJjYXN0KQ0KIHsNCi0JY2hhciB1X3R5cGUgPSAnXDAnOw0KLQljaGFyIGJfdHlwZSA9ICdc
MCc7DQotCWNoYXIgYV90eXBlID0gJ1wwJzsNCiAJY2hhciB0eXBlID0gJ1wwJzsNCi0JdW5zaWdu
ZWQgaW50IGFkZHI9IG50b2hsKGluLT5zaW5fYWRkci5zX2FkZHIpOw0KLQl1bnNpZ25lZCBpbnQg
cHJ0ID0gbnRvaHMoaW4tPnNpbl9wb3J0KTsNCisJdW5zaWduZWQgaW50IHBydDsNCiAJdW5zaWdu
ZWQgaW50IGlmYWNlOw0KIAlpbnQgaXNfYmNhc3QgPSAwOw0KIA0KIAlpZiAoYmNhc3QpICpiY2Fz
dCA9IDA7DQogDQotCWlmIChwcnQgPT0gMCkgew0KLQkJZXJybm8gPSBFSU5WQUw7DQotCQlyZXR1
cm4gLTE7DQorCXN3aXRjaCAoc2ktPmZhbWlseSkgew0KKwljYXNlIEFGX0lORVQ6IHsNCisJCWNv
bnN0IHN0cnVjdCBzb2NrYWRkcl9pbiAqaW4gPSANCisJCSAgICAoY29uc3Qgc3RydWN0IHNvY2th
ZGRyX2luICopaW5hZGRyOw0KKwkJdW5zaWduZWQgaW50IGFkZHIgPSBudG9obChpbi0+c2luX2Fk
ZHIuc19hZGRyKTsNCisJCWNoYXIgdV90eXBlID0gJ1wwJzsNCisJCWNoYXIgYl90eXBlID0gJ1ww
JzsNCisJCWNoYXIgYV90eXBlID0gJ1wwJzsNCisNCisJCXN3aXRjaCAoc2ktPnR5cGUpIHsNCisJ
CWNhc2UgU09DS19TVFJFQU06DQorCQkJdV90eXBlID0gU09DS0VUX1RZUEVfQ0hBUl9UQ1A7DQor
CQkJYnJlYWs7DQorCQljYXNlIFNPQ0tfREdSQU06DQorCQkJdV90eXBlID0gU09DS0VUX1RZUEVf
Q0hBUl9VRFA7DQorCQkJYV90eXBlID0gU09DS0VUX1RZUEVfQ0hBUl9VRFA7DQorCQkJYl90eXBl
ID0gU09DS0VUX1RZUEVfQ0hBUl9VRFA7DQorCQkJYnJlYWs7DQorCQl9DQorDQorCQlwcnQgPSBu
dG9ocyhpbi0+c2luX3BvcnQpOw0KKwkJaWYgKGFfdHlwZSAmJiBhZGRyID09IDB4RkZGRkZGRkYp
IHsNCisJCQkvKiAyNTUuMjU1LjI1NS4yNTUgb25seSB1ZHAgKi8NCisJCQlpc19iY2FzdCA9IDI7
DQorCQkJdHlwZSA9IGFfdHlwZTsNCisJCQlpZmFjZSA9IHNvY2tldF93cmFwcGVyX2RlZmF1bHRf
aWZhY2UoKTsNCisJCX0gZWxzZSBpZiAoYl90eXBlICYmIGFkZHIgPT0gMHg3RkZGRkZGRikgew0K
KwkJCS8qIDEyNy4yNTUuMjU1LjI1NSBvbmx5IHVkcCAqLw0KKwkJCWlzX2JjYXN0ID0gMTsNCisJ
CQl0eXBlID0gYl90eXBlOw0KKwkJCWlmYWNlID0gc29ja2V0X3dyYXBwZXJfZGVmYXVsdF9pZmFj
ZSgpOw0KKwkJfSBlbHNlIGlmICgoYWRkciAmIDB4RkZGRkZGMDApID09IDB4N0YwMDAwMDApIHsN
CisJCQkvKiAxMjcuMC4wLlggKi8NCisJCQlpc19iY2FzdCA9IDA7DQorCQkJdHlwZSA9IHVfdHlw
ZTsNCisJCQlpZmFjZSA9IChhZGRyICYgMHgwMDAwMDBGRik7DQorCQl9IGVsc2Ugew0KKwkJCWVy
cm5vID0gRU5FVFVOUkVBQ0g7DQorCQkJcmV0dXJuIC0xOw0KKwkJfQ0KKwkJaWYgKGJjYXN0KSAq
YmNhc3QgPSBpc19iY2FzdDsNCisJCWJyZWFrOw0KIAl9DQorI2lmZGVmIEhBVkVfSVBWNg0KKwlj
YXNlIEFGX0lORVQ2OiB7DQorCQljb25zdCBzdHJ1Y3Qgc29ja2FkZHJfaW42ICppbiA9IA0KKwkJ
ICAgIChjb25zdCBzdHJ1Y3Qgc29ja2FkZHJfaW42ICopaW5hZGRyOw0KIA0KLQlzd2l0Y2ggKHNp
LT50eXBlKSB7DQotCWNhc2UgU09DS19TVFJFQU06DQotCQl1X3R5cGUgPSBTT0NLRVRfVFlQRV9D
SEFSX1RDUDsNCisJCXN3aXRjaCAoc2ktPnR5cGUpIHsNCisJCWNhc2UgU09DS19TVFJFQU06DQor
CQkJdHlwZSA9IFNPQ0tFVF9UWVBFX0NIQVJfVENQX1Y2Ow0KKwkJCWJyZWFrOw0KKwkJY2FzZSBT
T0NLX0RHUkFNOg0KKwkJCXR5cGUgPSBTT0NLRVRfVFlQRV9DSEFSX1VEUF9WNjsNCisJCQlicmVh
azsNCisJCX0NCisNCisJCS8qIFhYWCBubyBtdWx0aWNhc3QvYnJvYWRjYXN0ICovDQorDQorCQlw
cnQgPSBudG9ocyhpbi0+c2luNl9wb3J0KTsNCisJCWlmYWNlID0gU1dfSVBWNl9BRERSRVNTOw0K
KwkJDQogCQlicmVhazsNCi0JY2FzZSBTT0NLX0RHUkFNOg0KLQkJdV90eXBlID0gU09DS0VUX1RZ
UEVfQ0hBUl9VRFA7DQotCQlhX3R5cGUgPSBTT0NLRVRfVFlQRV9DSEFSX1VEUDsNCi0JCWJfdHlw
ZSA9IFNPQ0tFVF9UWVBFX0NIQVJfVURQOw0KLQkJYnJlYWs7DQogCX0NCi0NCi0JaWYgKGFfdHlw
ZSAmJiBhZGRyID09IDB4RkZGRkZGRkYpIHsNCi0JCS8qIDI1NS4yNTUuMjU1LjI1NSBvbmx5IHVk
cCAqLw0KLQkJaXNfYmNhc3QgPSAyOw0KLQkJdHlwZSA9IGFfdHlwZTsNCi0JCWlmYWNlID0gc29j
a2V0X3dyYXBwZXJfZGVmYXVsdF9pZmFjZSgpOw0KLQl9IGVsc2UgaWYgKGJfdHlwZSAmJiBhZGRy
ID09IDB4N0ZGRkZGRkYpIHsNCi0JCS8qIDEyNy4yNTUuMjU1LjI1NSBvbmx5IHVkcCAqLw0KLQkJ
aXNfYmNhc3QgPSAxOw0KLQkJdHlwZSA9IGJfdHlwZTsNCi0JCWlmYWNlID0gc29ja2V0X3dyYXBw
ZXJfZGVmYXVsdF9pZmFjZSgpOw0KLQl9IGVsc2UgaWYgKChhZGRyICYgMHhGRkZGRkYwMCkgPT0g
MHg3RjAwMDAwMCkgew0KLQkJLyogMTI3LjAuMC5YICovDQotCQlpc19iY2FzdCA9IDA7DQotCQl0
eXBlID0gdV90eXBlOw0KLQkJaWZhY2UgPSAoYWRkciAmIDB4MDAwMDAwRkYpOw0KLQl9IGVsc2Ug
ew0KKyNlbmRpZg0KKwlkZWZhdWx0Og0KIAkJZXJybm8gPSBFTkVUVU5SRUFDSDsNCiAJCXJldHVy
biAtMTsNCiAJfQ0KIA0KLQlpZiAoYmNhc3QpICpiY2FzdCA9IGlzX2JjYXN0Ow0KKwlpZiAocHJ0
ID09IDApIHsNCisJCWVycm5vID0gRUlOVkFMOw0KKwkJcmV0dXJuIC0xOw0KKwl9DQogDQogCWlm
IChpc19iY2FzdCkgew0KIAkJc25wcmludGYodW4tPnN1bl9wYXRoLCBzaXplb2YodW4tPnN1bl9w
YXRoKSwgIiVzL0VJTlZBTCIsIA0KQEAgLTMyMCw2MCArNDE1LDk2IEBADQogCXJldHVybiAwOw0K
IH0NCiANCi1zdGF0aWMgaW50IGNvbnZlcnRfaW5fdW5fYWxsb2Moc3RydWN0IHNvY2tldF9pbmZv
ICpzaSwgY29uc3Qgc3RydWN0IHNvY2thZGRyX2luICppbiwgc3RydWN0IHNvY2thZGRyX3VuICp1
biwNCitzdGF0aWMgaW50IGNvbnZlcnRfaW5fdW5fYWxsb2Moc3RydWN0IHNvY2tldF9pbmZvICpz
aSwgY29uc3Qgc3RydWN0IHNvY2thZGRyICppbmFkZHIsIHN0cnVjdCBzb2NrYWRkcl91biAqdW4s
DQogCQkJICAgICAgIGludCAqYmNhc3QpDQogew0KLQljaGFyIHVfdHlwZSA9ICdcMCc7DQotCWNo
YXIgZF90eXBlID0gJ1wwJzsNCi0JY2hhciBiX3R5cGUgPSAnXDAnOw0KLQljaGFyIGFfdHlwZSA9
ICdcMCc7DQogCWNoYXIgdHlwZSA9ICdcMCc7DQotCXVuc2lnbmVkIGludCBhZGRyPSBudG9obChp
bi0+c2luX2FkZHIuc19hZGRyKTsNCi0JdW5zaWduZWQgaW50IHBydCA9IG50b2hzKGluLT5zaW5f
cG9ydCk7DQorCXVuc2lnbmVkIGludCBwcnQ7DQogCXVuc2lnbmVkIGludCBpZmFjZTsNCiAJc3Ry
dWN0IHN0YXQgc3Q7DQogCWludCBpc19iY2FzdCA9IDA7DQogDQogCWlmIChiY2FzdCkgKmJjYXN0
ID0gMDsNCiANCi0Jc3dpdGNoIChzaS0+dHlwZSkgew0KLQljYXNlIFNPQ0tfU1RSRUFNOg0KLQkJ
dV90eXBlID0gU09DS0VUX1RZUEVfQ0hBUl9UQ1A7DQotCQlkX3R5cGUgPSBTT0NLRVRfVFlQRV9D
SEFSX1RDUDsNCisJc3dpdGNoIChzaS0+ZmFtaWx5KSB7DQorCWNhc2UgQUZfSU5FVDogew0KKwkJ
Y29uc3Qgc3RydWN0IHNvY2thZGRyX2luICppbiA9IA0KKwkJICAgIChjb25zdCBzdHJ1Y3Qgc29j
a2FkZHJfaW4gKilpbmFkZHI7DQorCQl1bnNpZ25lZCBpbnQgYWRkciA9IG50b2hsKGluLT5zaW5f
YWRkci5zX2FkZHIpOw0KKwkJY2hhciB1X3R5cGUgPSAnXDAnOw0KKwkJY2hhciBkX3R5cGUgPSAn
XDAnOw0KKwkJY2hhciBiX3R5cGUgPSAnXDAnOw0KKwkJY2hhciBhX3R5cGUgPSAnXDAnOw0KKw0K
KwkJcHJ0ID0gbnRvaHMoaW4tPnNpbl9wb3J0KTsNCisNCisJCXN3aXRjaCAoc2ktPnR5cGUpIHsN
CisJCWNhc2UgU09DS19TVFJFQU06DQorCQkJdV90eXBlID0gU09DS0VUX1RZUEVfQ0hBUl9UQ1A7
DQorCQkJZF90eXBlID0gU09DS0VUX1RZUEVfQ0hBUl9UQ1A7DQorCQkJYnJlYWs7DQorCQljYXNl
IFNPQ0tfREdSQU06DQorCQkJdV90eXBlID0gU09DS0VUX1RZUEVfQ0hBUl9VRFA7DQorCQkJZF90
eXBlID0gU09DS0VUX1RZUEVfQ0hBUl9VRFA7DQorCQkJYV90eXBlID0gU09DS0VUX1RZUEVfQ0hB
Ul9VRFA7DQorCQkJYl90eXBlID0gU09DS0VUX1RZUEVfQ0hBUl9VRFA7DQorCQkJYnJlYWs7DQor
CQl9DQorDQorCQlpZiAoYWRkciA9PSAwKSB7DQorCQkJLyogMC4wLjAuMCAqLw0KKwkJIAlpc19i
Y2FzdCA9IDA7DQorCQkJdHlwZSA9IGRfdHlwZTsNCisJCQlpZmFjZSA9IHNvY2tldF93cmFwcGVy
X2RlZmF1bHRfaWZhY2UoKTsNCisJCX0gZWxzZSBpZiAoYV90eXBlICYmIGFkZHIgPT0gMHhGRkZG
RkZGRikgew0KKwkJCS8qIDI1NS4yNTUuMjU1LjI1NSBvbmx5IHVkcCAqLw0KKwkJCWlzX2JjYXN0
ID0gMjsNCisJCQl0eXBlID0gYV90eXBlOw0KKwkJCWlmYWNlID0gc29ja2V0X3dyYXBwZXJfZGVm
YXVsdF9pZmFjZSgpOw0KKwkJfSBlbHNlIGlmIChiX3R5cGUgJiYgYWRkciA9PSAweDdGRkZGRkZG
KSB7DQorCQkJLyogMTI3LjI1NS4yNTUuMjU1IG9ubHkgdWRwICovDQorCQkJaXNfYmNhc3QgPSAx
Ow0KKwkJCXR5cGUgPSBiX3R5cGU7DQorCQkJaWZhY2UgPSBzb2NrZXRfd3JhcHBlcl9kZWZhdWx0
X2lmYWNlKCk7DQorCQl9IGVsc2UgaWYgKChhZGRyICYgMHhGRkZGRkYwMCkgPT0gMHg3RjAwMDAw
MCkgew0KKwkJCS8qIDEyNy4wLjAuWCAqLw0KKwkJCWlzX2JjYXN0ID0gMDsNCisJCQl0eXBlID0g
dV90eXBlOw0KKwkJCWlmYWNlID0gKGFkZHIgJiAweDAwMDAwMEZGKTsNCisJCX0gZWxzZSB7DQor
CQkJZXJybm8gPSBFQUREUk5PVEFWQUlMOw0KKwkJCXJldHVybiAtMTsNCisJCX0NCiAJCWJyZWFr
Ow0KLQljYXNlIFNPQ0tfREdSQU06DQotCQl1X3R5cGUgPSBTT0NLRVRfVFlQRV9DSEFSX1VEUDsN
Ci0JCWRfdHlwZSA9IFNPQ0tFVF9UWVBFX0NIQVJfVURQOw0KLQkJYV90eXBlID0gU09DS0VUX1RZ
UEVfQ0hBUl9VRFA7DQotCQliX3R5cGUgPSBTT0NLRVRfVFlQRV9DSEFSX1VEUDsNCisJfQ0KKyNp
ZmRlZiBIQVZFX0lQVjYNCisJY2FzZSBBRl9JTkVUNjogew0KKwkJY29uc3Qgc3RydWN0IHNvY2th
ZGRyX2luNiAqaW4gPSANCisJCSAgICAoY29uc3Qgc3RydWN0IHNvY2thZGRyX2luNiAqKWluYWRk
cjsNCisNCisJCXN3aXRjaCAoc2ktPnR5cGUpIHsNCisJCWNhc2UgU09DS19TVFJFQU06DQorCQkJ
dHlwZSA9IFNPQ0tFVF9UWVBFX0NIQVJfVENQX1Y2Ow0KKwkJCWJyZWFrOw0KKwkJY2FzZSBTT0NL
X0RHUkFNOg0KKwkJCXR5cGUgPSBTT0NLRVRfVFlQRV9DSEFSX1VEUF9WNjsNCisJCQlicmVhazsN
CisJCX0NCisNCisJCS8qIFhYWCBubyBtdWx0aWNhc3QvYnJvYWRjYXN0ICovDQorDQorCQlwcnQg
PSBudG9ocyhpbi0+c2luNl9wb3J0KTsNCisJCWlmYWNlID0gU1dfSVBWNl9BRERSRVNTOw0KKwkJ
DQogCQlicmVhazsNCiAJfQ0KLQ0KLQlpZiAoYWRkciA9PSAwKSB7DQotCQkvKiAwLjAuMC4wICov
DQotCQlpc19iY2FzdCA9IDA7DQotCQl0eXBlID0gZF90eXBlOw0KLQkJaWZhY2UgPSBzb2NrZXRf
d3JhcHBlcl9kZWZhdWx0X2lmYWNlKCk7DQotCX0gZWxzZSBpZiAoYV90eXBlICYmIGFkZHIgPT0g
MHhGRkZGRkZGRikgew0KLQkJLyogMjU1LjI1NS4yNTUuMjU1IG9ubHkgdWRwICovDQotCQlpc19i
Y2FzdCA9IDI7DQotCQl0eXBlID0gYV90eXBlOw0KLQkJaWZhY2UgPSBzb2NrZXRfd3JhcHBlcl9k
ZWZhdWx0X2lmYWNlKCk7DQotCX0gZWxzZSBpZiAoYl90eXBlICYmIGFkZHIgPT0gMHg3RkZGRkZG
Rikgew0KLQkJLyogMTI3LjI1NS4yNTUuMjU1IG9ubHkgdWRwICovDQotCQlpc19iY2FzdCA9IDE7
DQotCQl0eXBlID0gYl90eXBlOw0KLQkJaWZhY2UgPSBzb2NrZXRfd3JhcHBlcl9kZWZhdWx0X2lm
YWNlKCk7DQotCX0gZWxzZSBpZiAoKGFkZHIgJiAweEZGRkZGRjAwKSA9PSAweDdGMDAwMDAwKSB7
DQotCQkvKiAxMjcuMC4wLlggKi8NCi0JCWlzX2JjYXN0ID0gMDsNCi0JCXR5cGUgPSB1X3R5cGU7
DQotCQlpZmFjZSA9IChhZGRyICYgMHgwMDAwMDBGRik7DQotCX0gZWxzZSB7DQotCQllcnJubyA9
IEVBRERSTk9UQVZBSUw7DQorI2VuZGlmDQorCWRlZmF1bHQ6DQorCQllcnJubyA9IEVORVRVTlJF
QUNIOw0KIAkJcmV0dXJuIC0xOw0KIAl9DQogDQorDQogCWlmIChiY2FzdCkgKmJjYXN0ID0gaXNf
YmNhc3Q7DQogDQogCWlmIChwcnQgPT0gMCkgew0KQEAgLTM4MywxMSArNTE0LDggQEANCiAJCQkJ
IHNvY2tldF93cmFwcGVyX2RpcigpLCB0eXBlLCBpZmFjZSwgcHJ0KTsNCiAJCQlpZiAoc3RhdCh1
bi0+c3VuX3BhdGgsICZzdCkgPT0gMCkgY29udGludWU7DQogDQotCQkJKChzdHJ1Y3Qgc29ja2Fk
ZHJfaW4gKilzaS0+bXluYW1lKS0+c2luX3BvcnQgPSBodG9ucyhwcnQpOw0KLQkJCXJldHVybiAw
Ow0KKwkJCXNldF9wb3J0KHNpLT5mYW1pbHksIHBydCwgc2ktPm15bmFtZSk7DQogCQl9DQotCQll
cnJubyA9IEVORklMRTsNCi0JCXJldHVybiAtMTsNCiAJfQ0KIA0KIAlzbnByaW50Zih1bi0+c3Vu
X3BhdGgsIHNpemVvZih1bi0+c3VuX3BhdGgpLCAiJXMvIlNPQ0tFVF9GT1JNQVQsIA0KQEAgLTQx
Niw2ICs1NDQsOSBAQA0KIA0KIAlzd2l0Y2ggKGluX2FkZHItPnNhX2ZhbWlseSkgew0KIAljYXNl
IEFGX0lORVQ6DQorI2lmZGVmIEhBVkVfSVBWNg0KKwljYXNlIEFGX0lORVQ2Og0KKyNlbmRpZg0K
IAkJc3dpdGNoIChzaS0+dHlwZSkgew0KIAkJY2FzZSBTT0NLX1NUUkVBTToNCiAJCWNhc2UgU09D
S19ER1JBTToNCkBAIC00MjUsOSArNTU2LDkgQEANCiAJCQlyZXR1cm4gLTE7DQogCQl9DQogCQlp
ZiAoYWxsb2Nfc29jaykgew0KLQkJCXJldHVybiBjb252ZXJ0X2luX3VuX2FsbG9jKHNpLCAoY29u
c3Qgc3RydWN0IHNvY2thZGRyX2luICopaW5fYWRkciwgb3V0X2FkZHIsIGJjYXN0KTsNCisJCQly
ZXR1cm4gY29udmVydF9pbl91bl9hbGxvYyhzaSwgaW5fYWRkciwgb3V0X2FkZHIsIGJjYXN0KTsN
CiAJCX0gZWxzZSB7DQotCQkJcmV0dXJuIGNvbnZlcnRfaW5fdW5fcmVtb3RlKHNpLCAoY29uc3Qg
c3RydWN0IHNvY2thZGRyX2luICopaW5fYWRkciwgb3V0X2FkZHIsIGJjYXN0KTsNCisJCQlyZXR1
cm4gY29udmVydF9pbl91bl9yZW1vdGUoc2ksIGluX2FkZHIsIG91dF9hZGRyLCBiY2FzdCk7DQog
CQl9DQogCWRlZmF1bHQ6DQogCQlicmVhazsNCkBAIC00NDIsMjUgKzU3MywyMSBAQA0KIAkJCQkg
ICAgc29ja2xlbl90IHVuX2FkZHJsZW4sDQogCQkJCSAgICBpbnQgZmFtaWx5LA0KIAkJCQkgICAg
c3RydWN0IHNvY2thZGRyICpvdXRfYWRkciwNCi0JCQkJICAgIHNvY2tsZW5fdCAqX291dF9hZGRy
bGVuKQ0KKwkJCQkgICAgc29ja2xlbl90ICpvdXRfYWRkcmxlbikNCiB7DQotCXNvY2tsZW5fdCBv
dXRfYWRkcmxlbjsNCi0NCi0JaWYgKG91dF9hZGRyID09IE5VTEwgfHwgX291dF9hZGRybGVuID09
IE5VTEwpIA0KKwlpZiAob3V0X2FkZHIgPT0gTlVMTCB8fCBvdXRfYWRkcmxlbiA9PSBOVUxMKSAN
CiAJCXJldHVybiAwOw0KIA0KIAlpZiAodW5fYWRkcmxlbiA9PSAwKSB7DQotCQkqX291dF9hZGRy
bGVuID0gMDsNCisJCSpvdXRfYWRkcmxlbiA9IDA7DQogCQlyZXR1cm4gMDsNCiAJfQ0KIA0KLQlv
dXRfYWRkcmxlbiA9ICpfb3V0X2FkZHJsZW47DQotCWlmIChvdXRfYWRkcmxlbiA+IHVuX2FkZHJs
ZW4pIHsNCi0JCW91dF9hZGRybGVuID0gdW5fYWRkcmxlbjsNCi0JfQ0KLQ0KIAlzd2l0Y2ggKGZh
bWlseSkgew0KIAljYXNlIEFGX0lORVQ6DQorI2lmZGVmIEhBVkVfSVBWNg0KKwljYXNlIEFGX0lO
RVQ2Og0KKyNlbmRpZg0KIAkJc3dpdGNoIChzaS0+dHlwZSkgew0KIAkJY2FzZSBTT0NLX1NUUkVB
TToNCiAJCWNhc2UgU09DS19ER1JBTToNCkBAIC00NjksNyArNTk2LDcgQEANCiAJCQllcnJubyA9
IEVTT0NLVE5PU1VQUE9SVDsNCiAJCQlyZXR1cm4gLTE7DQogCQl9DQotCQlyZXR1cm4gY29udmVy
dF91bl9pbihpbl9hZGRyLCAoc3RydWN0IHNvY2thZGRyX2luICopb3V0X2FkZHIsIF9vdXRfYWRk
cmxlbik7DQorCQlyZXR1cm4gY29udmVydF91bl9pbihpbl9hZGRyLCBvdXRfYWRkciwgb3V0X2Fk
ZHJsZW4pOw0KIAlkZWZhdWx0Og0KIAkJYnJlYWs7DQogCX0NCkBAIC04MDEsNyArOTI4LDEzIEBA
DQogCQlyZXR1cm47DQogCX0NCiANCi0JaWYgKHNpLT5mYW1pbHkgIT0gQUZfSU5FVCkgew0KKwlz
d2l0Y2ggKHNpLT5mYW1pbHkpIHsNCisJY2FzZSBBRl9JTkVUOg0KKyNpZmRlZiBIQVZFX0lQVjYN
CisJY2FzZSBBRl9JTkVUNjoNCisjZW5kaWYNCisJCWJyZWFrOw0KKwlkZWZhdWx0Og0KIAkJcmV0
dXJuOw0KIAl9DQogDQpAQCAtMTA2NSw2ICsxMTk4LDkgQEANCiANCiAJc3dpdGNoIChmYW1pbHkp
IHsNCiAJY2FzZSBBRl9JTkVUOg0KKyNpZmRlZiBIQVZFX0lQVjYNCisJY2FzZSBBRl9JTkVUNjoN
CisjZW5kaWYNCiAJCWJyZWFrOw0KIAljYXNlIEFGX1VOSVg6DQogCQlyZXR1cm4gcmVhbF9zb2Nr
ZXQoZmFtaWx5LCB0eXBlLCBwcm90b2NvbCk7DQpAQCAtMTA4Myw2ICsxMjE5LDcgQEANCiAJCXJl
dHVybiAtMTsNCiAJfQ0KIA0KKyNpZiAwDQogCXN3aXRjaCAocHJvdG9jb2wpIHsNCiAJY2FzZSAw
Og0KIAkJYnJlYWs7DQpAQCAtMTA5MCw2ICsxMjI3LDcgQEANCiAJCWVycm5vID0gRVBST1RPTk9T
VVBQT1JUOw0KIAkJcmV0dXJuIC0xOw0KIAl9DQorI2VuZGlmDQogDQogCWZkID0gcmVhbF9zb2Nr
ZXQoQUZfVU5JWCwgdHlwZSwgMCk7DQogDQpAQCAtMTExNSw4ICsxMjUzLDggQEANCiAJc29ja2xl
bl90IHVuX2FkZHJsZW4gPSBzaXplb2YodW5fYWRkcik7DQogCXN0cnVjdCBzb2NrYWRkcl91biB1
bl9teV9hZGRyOw0KIAlzb2NrbGVuX3QgdW5fbXlfYWRkcmxlbiA9IHNpemVvZih1bl9teV9hZGRy
KTsNCi0Jc3RydWN0IHNvY2thZGRyIG15X2FkZHI7DQotCXNvY2tsZW5fdCBteV9hZGRybGVuID0g
c2l6ZW9mKG15X2FkZHIpOw0KKwlzdHJ1Y3Qgc29ja2FkZHIgKm15X2FkZHI7DQorCXNvY2tsZW5f
dCBteV9hZGRybGVuLCBsZW47DQogCWludCByZXQ7DQogDQogCXBhcmVudF9zaSA9IGZpbmRfc29j
a2V0X2luZm8ocyk7DQpAQCAtMTEyNCwxOCArMTI2MiwzNyBAQA0KIAkJcmV0dXJuIHJlYWxfYWNj
ZXB0KHMsIGFkZHIsIGFkZHJsZW4pOw0KIAl9DQogDQorCS8qIA0KKwkgKiBhc3N1bWUgb3V0IHNv
Y2thZGRyIGhhdmUgdGhlIHNhbWUgc2l6ZSBhcyB0aGUgaW4gcGFyZW50DQorCSAqIHNvY2tldCBm
YW1pbHkNCisJICovDQorCW15X2FkZHJsZW4gPSBzb2NrZXRfbGVuZ3RoKHBhcmVudF9zaS0+ZmFt
aWx5KTsNCisJaWYgKG15X2FkZHJsZW4gPCAwKSB7DQorCQllcnJubyA9IEVJTlZBTDsNCisJCXJl
dHVybiAtMTsNCisJfQ0KKw0KKwlteV9hZGRyID0gbWFsbG9jKG15X2FkZHJsZW4pOw0KKwlpZiAo
bXlfYWRkciA9PSBOVUxMKSB7DQorCQlyZXR1cm4gLTE7DQorCX0NCisNCiAJbWVtc2V0KCZ1bl9h
ZGRyLCAwLCBzaXplb2YodW5fYWRkcikpOw0KIAltZW1zZXQoJnVuX215X2FkZHIsIDAsIHNpemVv
Zih1bl9teV9hZGRyKSk7DQotCW1lbXNldCgmbXlfYWRkciwgMCwgc2l6ZW9mKG15X2FkZHIpKTsN
CiANCiAJcmV0ID0gcmVhbF9hY2NlcHQocywgKHN0cnVjdCBzb2NrYWRkciAqKSZ1bl9hZGRyLCAm
dW5fYWRkcmxlbik7DQotCWlmIChyZXQgPT0gLTEpIHJldHVybiByZXQ7DQorCWlmIChyZXQgPT0g
LTEpIHsNCisJCWZyZWUobXlfYWRkcik7DQorCQlyZXR1cm4gcmV0Ow0KKwl9DQogDQogCWZkID0g
cmV0Ow0KIA0KKwlsZW4gPSBteV9hZGRybGVuOw0KIAlyZXQgPSBzb2NrYWRkcl9jb252ZXJ0X2Zy
b21fdW4ocGFyZW50X3NpLCAmdW5fYWRkciwgdW5fYWRkcmxlbiwNCi0JCQkJICAgICAgIHBhcmVu
dF9zaS0+ZmFtaWx5LCBhZGRyLCBhZGRybGVuKTsNCisJCQkJICAgICAgIHBhcmVudF9zaS0+ZmFt
aWx5LCBteV9hZGRyLCAmbGVuKTsNCiAJaWYgKHJldCA9PSAtMSkgew0KKwkJZnJlZShteV9hZGRy
KTsNCiAJCWNsb3NlKGZkKTsNCiAJCXJldHVybiByZXQ7DQogCX0NCkBAIC0xMTUwLDYgKzEzMDcs
MTYgQEANCiAJY2hpbGRfc2ktPmJvdW5kID0gMTsNCiAJY2hpbGRfc2ktPmlzX3NlcnZlciA9IDE7
DQogDQorCWNoaWxkX3NpLT5wZWVybmFtZV9sZW4gPSBsZW47DQorCWNoaWxkX3NpLT5wZWVybmFt
ZSA9IHNvY2thZGRyX2R1cChteV9hZGRyLCBsZW4pOw0KKw0KKwlpZiAoYWRkciAhPSBOVUxMICYm
IGFkZHJsZW4gIT0gTlVMTCkgew0KKwkgICAgKmFkZHJsZW4gPSBsZW47DQorCSAgICBpZiAoKmFk
ZHJsZW4gPj0gbGVuKQ0KKwkJbWVtY3B5KGFkZHIsIG15X2FkZHIsIGxlbik7DQorCSAgICAqYWRk
cmxlbiA9IDA7DQorCX0NCisNCiAJcmV0ID0gcmVhbF9nZXRzb2NrbmFtZShmZCwgKHN0cnVjdCBz
b2NrYWRkciAqKSZ1bl9teV9hZGRyLCAmdW5fbXlfYWRkcmxlbik7DQogCWlmIChyZXQgPT0gLTEp
IHsNCiAJCWZyZWUoY2hpbGRfc2kpOw0KQEAgLTExNTcsMjAgKzEzMjQsMjAgQEANCiAJCXJldHVy
biByZXQ7DQogCX0NCiANCisJbGVuID0gbXlfYWRkcmxlbjsNCiAJcmV0ID0gc29ja2FkZHJfY29u
dmVydF9mcm9tX3VuKGNoaWxkX3NpLCAmdW5fbXlfYWRkciwgdW5fbXlfYWRkcmxlbiwNCi0JCQkJ
ICAgICAgIGNoaWxkX3NpLT5mYW1pbHksICZteV9hZGRyLCAmbXlfYWRkcmxlbik7DQorCQkJCSAg
ICAgICBjaGlsZF9zaS0+ZmFtaWx5LCBteV9hZGRyLCAmbGVuKTsNCiAJaWYgKHJldCA9PSAtMSkg
ew0KIAkJZnJlZShjaGlsZF9zaSk7DQorCQlmcmVlKG15X2FkZHIpOw0KIAkJY2xvc2UoZmQpOw0K
IAkJcmV0dXJuIHJldDsNCiAJfQ0KIA0KLQljaGlsZF9zaS0+bXluYW1lX2xlbiA9IG15X2FkZHJs
ZW47DQotCWNoaWxkX3NpLT5teW5hbWUgPSBzb2NrYWRkcl9kdXAoJm15X2FkZHIsIG15X2FkZHJs
ZW4pOw0KKwljaGlsZF9zaS0+bXluYW1lX2xlbiA9IGxlbjsNCisJY2hpbGRfc2ktPm15bmFtZSA9
IHNvY2thZGRyX2R1cChteV9hZGRyLCBsZW4pOw0KKwlmcmVlKG15X2FkZHIpOw0KIA0KLQljaGls
ZF9zaS0+cGVlcm5hbWVfbGVuID0gKmFkZHJsZW47DQotCWNoaWxkX3NpLT5wZWVybmFtZSA9IHNv
Y2thZGRyX2R1cChhZGRyLCAqYWRkcmxlbik7DQotDQogCVNXUkFQX0RMSVNUX0FERChzb2NrZXRz
LCBjaGlsZF9zaSk7DQogDQogCXN3cmFwX2R1bXBfcGFja2V0KGNoaWxkX3NpLCBhZGRyLCBTV1JB
UF9BQ0NFUFRfU0VORCwgTlVMTCwgMCk7DQpAQCAtMTE5MCw3ICsxMzU3LDYgQEANCiBzdGF0aWMg
aW50IHN3cmFwX2F1dG9fYmluZChzdHJ1Y3Qgc29ja2V0X2luZm8gKnNpKQ0KIHsNCiAJc3RydWN0
IHNvY2thZGRyX3VuIHVuX2FkZHI7DQotCXN0cnVjdCBzb2NrYWRkcl9pbiBpbjsNCiAJaW50IGk7
DQogCWNoYXIgdHlwZTsNCiAJaW50IHJldDsNCkBAIC0xMjA2LDEzICsxMzcyLDU1IEBADQogDQog
CXVuX2FkZHIuc3VuX2ZhbWlseSA9IEFGX1VOSVg7DQogDQotCXN3aXRjaCAoc2ktPnR5cGUpIHsN
Ci0JY2FzZSBTT0NLX1NUUkVBTToNCi0JCXR5cGUgPSBTT0NLRVRfVFlQRV9DSEFSX1RDUDsNCisJ
c3dpdGNoIChzaS0+ZmFtaWx5KSB7DQorCWNhc2UgQUZfSU5FVDogew0KKwkJc3RydWN0IHNvY2th
ZGRyX2luIGluOw0KKw0KKwkJc3dpdGNoIChzaS0+dHlwZSkgew0KKwkJY2FzZSBTT0NLX1NUUkVB
TToNCisJCQl0eXBlID0gU09DS0VUX1RZUEVfQ0hBUl9UQ1A7DQorCQkJYnJlYWs7DQorCQljYXNl
IFNPQ0tfREdSQU06DQorCQkgICAgCXR5cGUgPSBTT0NLRVRfVFlQRV9DSEFSX1VEUDsNCisJCQli
cmVhazsNCisJCWRlZmF1bHQ6DQorCQkgICAgZXJybm8gPSBFU09DS1ROT1NVUFBPUlQ7DQorCQkg
ICAgcmV0dXJuIC0xOw0KKwkJfQ0KKw0KKwkJbWVtc2V0KCZpbiwgMCwgc2l6ZW9mKGluKSk7DQor
CQlpbi5zaW5fZmFtaWx5ID0gQUZfSU5FVDsNCisJCWluLnNpbl9hZGRyLnNfYWRkciA9IGh0b25s
KDEyNzw8MjQgfCANCisJCQkJCSAgIHNvY2tldF93cmFwcGVyX2RlZmF1bHRfaWZhY2UoKSk7DQor
DQorCQlzaS0+bXluYW1lX2xlbiA9IHNpemVvZihpbik7DQorCQlzaS0+bXluYW1lID0gc29ja2Fk
ZHJfZHVwKCZpbiwgc2ktPm15bmFtZV9sZW4pOw0KIAkJYnJlYWs7DQotCWNhc2UgU09DS19ER1JB
TToNCi0JCXR5cGUgPSBTT0NLRVRfVFlQRV9DSEFSX1VEUDsNCisJfQ0KKyNpZmRlZiBIQVZFX0lQ
VjYNCisJY2FzZSBBRl9JTkVUNjogew0KKwkJc3RydWN0IHNvY2thZGRyX2luNiBpbjY7DQorDQor
CQlzd2l0Y2ggKHNpLT50eXBlKSB7DQorCQljYXNlIFNPQ0tfU1RSRUFNOg0KKwkJCXR5cGUgPSBT
T0NLRVRfVFlQRV9DSEFSX1RDUF9WNjsNCisJCQlicmVhazsNCisJCWNhc2UgU09DS19ER1JBTToN
CisJCSAgICAJdHlwZSA9IFNPQ0tFVF9UWVBFX0NIQVJfVURQX1Y2Ow0KKwkJCWJyZWFrOw0KKwkJ
ZGVmYXVsdDoNCisJCSAgICBlcnJubyA9IEVTT0NLVE5PU1VQUE9SVDsNCisJCSAgICByZXR1cm4g
LTE7DQorCQl9DQorDQorCQltZW1zZXQoJmluNiwgMCwgc2l6ZW9mKGluNikpOw0KKwkJaW42LnNp
bjZfZmFtaWx5ID0gQUZfSU5FVDY7DQorCQlpbjYuc2luNl9hZGRyLnM2X2FkZHJbMF0gPSBTV19J
UFY2X0FERFJFU1M7DQorCQlzaS0+bXluYW1lX2xlbiA9IHNpemVvZihpbjYpOw0KKwkJc2ktPm15
bmFtZSA9IHNvY2thZGRyX2R1cCgmaW42LCBzaS0+bXluYW1lX2xlbik7DQogCQlicmVhazsNCisJ
fQ0KKyNlbmRpZg0KIAlkZWZhdWx0Og0KIAkJZXJybm8gPSBFU09DS1ROT1NVUFBPUlQ7DQogCQly
ZXR1cm4gLTE7DQpAQCAtMTI0MiwxMyArMTQ1MCw4IEBADQogCQlyZXR1cm4gLTE7DQogCX0NCiAN
Ci0JbWVtc2V0KCZpbiwgMCwgc2l6ZW9mKGluKSk7DQotCWluLnNpbl9mYW1pbHkgPSBBRl9JTkVU
Ow0KLQlpbi5zaW5fcG9ydCAgID0gaHRvbnMocG9ydCk7DQotCWluLnNpbl9hZGRyLnNfYWRkciA9
IGh0b25sKDEyNzw8MjQgfCBzb2NrZXRfd3JhcHBlcl9kZWZhdWx0X2lmYWNlKCkpOw0KLQkNCi0J
c2ktPm15bmFtZV9sZW4gPSBzaXplb2YoaW4pOw0KLQlzaS0+bXluYW1lID0gc29ja2FkZHJfZHVw
KCZpbiwgc2ktPm15bmFtZV9sZW4pOw0KKwlzZXRfcG9ydChzaS0+ZmFtaWx5LCBwb3J0LCBzaS0+
bXluYW1lKTsNCisNCiAJcmV0dXJuIDA7DQogfQ0KIA0KQEAgLTEyNjgsNiArMTQ3MSwxMSBAQA0K
IAkJaWYgKHJldCA9PSAtMSkgcmV0dXJuIC0xOw0KIAl9DQogDQorCWlmIChzaS0+ZmFtaWx5ICE9
IHNlcnZfYWRkci0+c2FfZmFtaWx5KSB7DQorCQllcnJubyA9IEVJTlZBTDsNCisJCXJldHVybiAt
MTsNCisJfQ0KKw0KIAlyZXQgPSBzb2NrYWRkcl9jb252ZXJ0X3RvX3VuKHNpLCAoY29uc3Qgc3Ry
dWN0IHNvY2thZGRyICopc2Vydl9hZGRyLCBhZGRybGVuLCAmdW5fYWRkciwgMCwgTlVMTCk7DQog
CWlmIChyZXQgPT0gLTEpIHJldHVybiAtMTsNCiANCkBAIC0xNDQ2LDM4ICsxNjU0LDQ5IEBADQog
CQlyZXR1cm4gcmVhbF9zZW5kdG8ocywgYnVmLCBsZW4sIGZsYWdzLCB0bywgdG9sZW4pOw0KIAl9
DQogDQotCWlmIChzaS0+Ym91bmQgPT0gMCkgew0KLQkJcmV0ID0gc3dyYXBfYXV0b19iaW5kKHNp
KTsNCisJc3dpdGNoIChzaS0+dHlwZSkgew0KKwljYXNlIFNPQ0tfU1RSRUFNOg0KKwkJcmV0ID0g
cmVhbF9zZW5kKHMsIGJ1ZiwgbGVuLCBmbGFncyk7DQorCQlicmVhazsNCisJY2FzZSBTT0NLX0RH
UkFNOg0KKwkJaWYgKHNpLT5ib3VuZCA9PSAwKSB7DQorCQkJcmV0ID0gc3dyYXBfYXV0b19iaW5k
KHNpKTsNCisJCQlpZiAocmV0ID09IC0xKSByZXR1cm4gLTE7DQorCQl9DQorCQkNCisJCXJldCA9
IHNvY2thZGRyX2NvbnZlcnRfdG9fdW4oc2ksIHRvLCB0b2xlbiwgJnVuX2FkZHIsIDAsICZiY2Fz
dCk7DQogCQlpZiAocmV0ID09IC0xKSByZXR1cm4gLTE7DQotCX0NCi0NCi0JcmV0ID0gc29ja2Fk
ZHJfY29udmVydF90b191bihzaSwgdG8sIHRvbGVuLCAmdW5fYWRkciwgMCwgJmJjYXN0KTsNCi0J
aWYgKHJldCA9PSAtMSkgcmV0dXJuIC0xOw0KLQ0KLQlpZiAoYmNhc3QpIHsNCi0JCXN0cnVjdCBz
dGF0IHN0Ow0KLQkJdW5zaWduZWQgaW50IGlmYWNlOw0KLQkJdW5zaWduZWQgaW50IHBydCA9IG50
b2hzKCgoY29uc3Qgc3RydWN0IHNvY2thZGRyX2luICopdG8pLT5zaW5fcG9ydCk7DQotCQljaGFy
IHR5cGU7DQotDQotCQl0eXBlID0gU09DS0VUX1RZUEVfQ0hBUl9VRFA7DQotDQotCQlmb3IoaWZh
Y2U9MDsgaWZhY2UgPD0gTUFYX1dSQVBQRURfSU5URVJGQUNFUzsgaWZhY2UrKykgew0KLQkJCXNu
cHJpbnRmKHVuX2FkZHIuc3VuX3BhdGgsIHNpemVvZih1bl9hZGRyLnN1bl9wYXRoKSwgIiVzLyJT
T0NLRVRfRk9STUFULCANCi0JCQkJIHNvY2tldF93cmFwcGVyX2RpcigpLCB0eXBlLCBpZmFjZSwg
cHJ0KTsNCi0JCQlpZiAoc3RhdCh1bl9hZGRyLnN1bl9wYXRoLCAmc3QpICE9IDApIGNvbnRpbnVl
Ow0KLQ0KLQkJCS8qIGlnbm9yZSB0aGUgYW55IGVycm9ycyBpbiBicm9hZGNhc3Qgc2VuZHMgKi8N
Ci0JCQlyZWFsX3NlbmR0byhzLCBidWYsIGxlbiwgZmxhZ3MsIChzdHJ1Y3Qgc29ja2FkZHIgKikm
dW5fYWRkciwgc2l6ZW9mKHVuX2FkZHIpKTsNCisJCQ0KKwkJaWYgKGJjYXN0KSB7DQorCQkJc3Ry
dWN0IHN0YXQgc3Q7DQorCQkJdW5zaWduZWQgaW50IGlmYWNlOw0KKwkJCXVuc2lnbmVkIGludCBw
cnQgPSBudG9ocygoKGNvbnN0IHN0cnVjdCBzb2NrYWRkcl9pbiAqKXRvKS0+c2luX3BvcnQpOw0K
KwkJCWNoYXIgdHlwZTsNCisJCQkNCisJCQl0eXBlID0gU09DS0VUX1RZUEVfQ0hBUl9VRFA7DQor
CQkJDQorCQkJZm9yKGlmYWNlPTA7IGlmYWNlIDw9IE1BWF9XUkFQUEVEX0lOVEVSRkFDRVM7IGlm
YWNlKyspIHsNCisJCQkJc25wcmludGYodW5fYWRkci5zdW5fcGF0aCwgc2l6ZW9mKHVuX2FkZHIu
c3VuX3BhdGgpLCAiJXMvIlNPQ0tFVF9GT1JNQVQsIA0KKwkJCQkJIHNvY2tldF93cmFwcGVyX2Rp
cigpLCB0eXBlLCBpZmFjZSwgcHJ0KTsNCisJCQkJaWYgKHN0YXQodW5fYWRkci5zdW5fcGF0aCwg
JnN0KSAhPSAwKSBjb250aW51ZTsNCisJCQkJDQorCQkJCS8qIGlnbm9yZSB0aGUgYW55IGVycm9y
cyBpbiBicm9hZGNhc3Qgc2VuZHMgKi8NCisJCQkJcmVhbF9zZW5kdG8ocywgYnVmLCBsZW4sIGZs
YWdzLCAoc3RydWN0IHNvY2thZGRyICopJnVuX2FkZHIsIHNpemVvZih1bl9hZGRyKSk7DQorCQkJ
fQ0KKwkJCQ0KKwkJCXN3cmFwX2R1bXBfcGFja2V0KHNpLCB0bywgU1dSQVBfU0VORFRPLCBidWYs
IGxlbik7DQorCQkJDQorCQkJcmV0dXJuIGxlbjsNCiAJCX0NCi0NCi0JCXN3cmFwX2R1bXBfcGFj
a2V0KHNpLCB0bywgU1dSQVBfU0VORFRPLCBidWYsIGxlbik7DQotDQotCQlyZXR1cm4gbGVuOw0K
KwkJDQorCQlyZXQgPSByZWFsX3NlbmR0byhzLCBidWYsIGxlbiwgZmxhZ3MsIChzdHJ1Y3Qgc29j
a2FkZHIgKikmdW5fYWRkciwgc2l6ZW9mKHVuX2FkZHIpKTsNCisJCWJyZWFrOw0KKwlkZWZhdWx0
Og0KKwkJcmV0ID0gLTE7DQorCQllcnJubyA9IEVIT1NUVU5SRUFDSDsNCisJCWJyZWFrOw0KIAl9
DQotDQotCXJldCA9IHJlYWxfc2VuZHRvKHMsIGJ1ZiwgbGVuLCBmbGFncywgKHN0cnVjdCBzb2Nr
YWRkciAqKSZ1bl9hZGRyLCBzaXplb2YodW5fYWRkcikpOw0KLQ0KKwkJDQogCS8qIHRvIGdpdmUg
YmV0dGVyIGVycm9ycyAqLw0KIAlpZiAocmV0ID09IC0xICYmIGVycm5vID09IEVOT0VOVCkgew0K
IAkJZXJybm8gPSBFSE9TVFVOUkVBQ0g7DQo=


--=-DQ0UYvJAq8hTMIkJZ3yh--

--=-232FtEZ8rboVq3wUgPj0
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.7 (GNU/Linux)

iD8DBQBGHja8z4A8Wyi0NrsRAkYEAJ4uDa/GA3AmdU6//+1GMsVvI4hIdACeKasT
IqJZbDCx1VF77VU9O3Oq7dM=
=/STi
-----END PGP SIGNATURE-----

--=-232FtEZ8rboVq3wUgPj0--

