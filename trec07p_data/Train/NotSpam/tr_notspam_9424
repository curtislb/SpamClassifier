From samba-cvs-bounces+ktwarwic=speedy.uwaterloo.ca@lists.samba.org  Fri May 11 08:07:40 2007
Return-Path: <samba-cvs-bounces+ktwarwic=speedy.uwaterloo.ca@lists.samba.org>
Received: from lists.samba.org (mail.samba.org [66.70.73.150])
	by flax9.uwaterloo.ca (8.12.8/8.12.5) with ESMTP id l4BC7dqD022876
	for <ktwarwic@speedy.uwaterloo.ca>; Fri, 11 May 2007 08:07:39 -0400
Received: from dp.samba.org (localhost [127.0.0.1])
	by lists.samba.org (Postfix) with ESMTP id B0247163924
	for <ktwarwic@speedy.uwaterloo.ca>; Fri, 11 May 2007 12:07:37 +0000 (GMT)
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on dp.samba.org
X-Spam-Level: 
X-Spam-Status: No, score=1.0 required=3.8 tests=AWL,BAYES_50,NO_REAL_NAME 
	autolearn=no version=3.1.7
X-Original-To: samba-cvs@samba.org
Delivered-To: samba-cvs@samba.org
Received: from mtagate6.de.ibm.com (mtagate6.de.ibm.com [195.212.29.155])
	by lists.samba.org (Postfix) with ESMTP id CB3B11638FD
	for <samba-cvs@samba.org>; Fri, 11 May 2007 12:06:09 +0000 (GMT)
Received: from d12nrmr1607.megacenter.de.ibm.com
	(d12nrmr1607.megacenter.de.ibm.com [9.149.167.49])
	by mtagate6.de.ibm.com (8.13.8/8.13.8) with ESMTP id l4BC68s8390128
	for <samba-cvs@samba.org>; Fri, 11 May 2007 12:06:08 GMT
Received: from d12av02.megacenter.de.ibm.com (d12av02.megacenter.de.ibm.com
	[9.149.165.228])
	by d12nrmr1607.megacenter.de.ibm.com (8.13.8/8.13.8/NCO v8.3) with
	ESMTP id l4BC68L94047028
	for <samba-cvs@samba.org>; Fri, 11 May 2007 14:06:08 +0200
Received: from d12av02.megacenter.de.ibm.com (loopback [127.0.0.1])
	by d12av02.megacenter.de.ibm.com (8.12.11.20060308/8.13.3) with ESMTP
	id l4BC68GS019130
	for <samba-cvs@samba.org>; Fri, 11 May 2007 14:06:08 +0200
Received: from localhost (linux-psomogyi.bud.hu.ibm.com [9.157.226.68])
	by d12av02.megacenter.de.ibm.com (8.12.11.20060308/8.12.11) with SMTP
	id l4BC688k019121
	for <samba-cvs@samba.org>; Fri, 11 May 2007 14:06:08 +0200
Date: Fri, 11 May 2007 14:05:14 +0200
From: psomogyi@gamax.hu
To: samba-cvs@samba.org
Message-ID: <46445bfa.xB12inOB9Wy0lTD5%psomogyi@gamax.hu>
User-Agent: nail 11.25 7/29/05
MIME-Version: 1.0
Content-Type: text/plain; charset=us-ascii
Content-Transfer-Encoding: 7bit
Subject: Rev 95: merge from tridge in http://samba.org/~tridge/psomogyi/
X-BeenThere: samba-cvs@lists.samba.org
X-Mailman-Version: 2.1.5
Precedence: list
Reply-To: samba-technical@lists.samba.org
List-Id: Samba CVS and subversion commit messages <samba-cvs.lists.samba.org>
List-Unsubscribe: <https://lists.samba.org/mailman/listinfo/samba-cvs>,
	<mailto:samba-cvs-request@lists.samba.org?subject=unsubscribe>
List-Archive: <http://lists.samba.org/archive/samba-cvs>
List-Post: <mailto:samba-cvs@lists.samba.org>
List-Help: <mailto:samba-cvs-request@lists.samba.org?subject=help>
List-Subscribe: <https://lists.samba.org/mailman/listinfo/samba-cvs>,
	<mailto:samba-cvs-request@lists.samba.org?subject=subscribe>
Sender: samba-cvs-bounces+ktwarwic=speedy.uwaterloo.ca@lists.samba.org
Errors-To: samba-cvs-bounces+ktwarwic=speedy.uwaterloo.ca@lists.samba.org

------------------------------------------------------------
revno: 95
revision-id: psomogyi@gamax.hu-20070511114212-hctokiuaxv9fvdzr
parent: psomogyi@gamax.hu-20070511112450-wjf21qva3pjifxy9
parent: tridge@samba.org-20070511072921-1fmloqo3r1uzqxeq
committer: Peter Somogyi <psomogyi@gamax.hu>
branch nick: ctdb
timestamp: Fri 2007-05-11 13:42:12 +0200
message:
  merge from tridge
added:
  common/ctdb_recover.c          ctdb_recover.c-20070503002147-admmfgt1oj6gexfo-1
  common/ctdb_traverse.c         ctdb_traverse.c-20070503021550-ztfs5rwx8jfm8qqx-1
  direct/4nodes.txt              4nodes.txt-20070502024949-2rkyfp289w532z1l-1
  direct/ctdb_recoverd.c         recoverd.c-20070503213540-bvxuyd9jm1f7ig90-1
  lib/events/libevents.m4        libevents.m4-20070505071540-g8d5bc9j71yj33ct-1
  tests/recover.sh               recover.sh-20070502031230-tpuiet6m6tjdotta-1
  tools/monitor_recovery.sh      monitor_recovery.sh-20070508220533-oy7s689rcjsu7yte-1
modified:
  Makefile.in                    makefile.in-20061117234101-o3qt14umlg9en8z0-1
  autogen.sh                     autogen.sh-20061117234101-o3qt14umlg9en8z0-3
  common/cmdline.c               cmdline.c-20070416041216-w1zvz91bkdsgjckw-1
  common/ctdb.c                  ctdb.c-20061127094323-t50f58d65iaao5of-2
  common/ctdb_call.c             ctdb_call.c-20061128065342-to93h6eejj5kon81-1
  common/ctdb_client.c           ctdb_client.c-20070411010216-3kd8v37k61steeya-1
  common/ctdb_control.c          ctdb_control.c-20070426122724-j6gkpiofhbwdin63-1
  common/ctdb_daemon.c           ctdb_daemon.c-20070409200331-3el1kqgdb9m4ib0g-1
  common/ctdb_io.c               ctdb_io.c-20070409200335-dzfc7f3rra5rcf60-1
  common/ctdb_lockwait.c         ctdb_lockwait.c-20070416214118-n1aeonljj3vpdd9q-1
  common/ctdb_ltdb.c             ctdb_ltdb.c-20061128065342-to93h6eejj5kon81-2
  common/ctdb_message.c          ctdb_message.c-20070208224107-9dnio7x7z33prrmt-1
  common/ctdb_util.c             ctdb_util.c-20061128065342-to93h6eejj5kon81-3
  configure.ac                   configure.ac-20061117234101-o3qt14umlg9en8z0-10
  direct/ctdbd_test.c            ctdbd_test.c-20070411085057-17kgjzfktsh28g99-1
  include/ctdb.h                 ctdb.h-20061117234101-o3qt14umlg9en8z0-11
  include/ctdb_private.h         ctdb_private.h-20061117234101-o3qt14umlg9en8z0-13
  lib/events/config.m4           config.m4-20061117234101-o3qt14umlg9en8z0-24
  lib/events/events.c            events.c-20061117234101-o3qt14umlg9en8z0-26
  lib/events/events.h            events.h-20061117234101-o3qt14umlg9en8z0-27
  lib/events/events_aio.c        events_aio.c-20070501213746-4fxluwiq4rcxib8p-1
  lib/events/events_epoll.c      events_epoll.c-20070501213746-4fxluwiq4rcxib8p-2
  lib/events/events_internal.h   events_internal.h-20061117234101-o3qt14umlg9en8z0-28
  lib/events/events_liboop.c     events_liboop.c-20061117234101-o3qt14umlg9en8z0-29
  lib/events/events_select.c     events_select.c-20070501213746-4fxluwiq4rcxib8p-3
  lib/events/events_standard.c   events_standard.c-20061117234101-o3qt14umlg9en8z0-30
  lib/events/events_timed.c      events_timed.c-20070501213746-4fxluwiq4rcxib8p-5
  lib/popt/libpopt.m4            libpopt.m4-20070125040942-nz1rv4zkr26q77uw-7
  lib/popt/samba.m4              samba.m4-20070125040942-nz1rv4zkr26q77uw-14
  lib/replace/system/select.h    select.h-20070125040949-7t3f5zdl1q4z9hyv-88
  lib/tdb/Makefile.in            makefile.in-20070125040949-7t3f5zdl1q4z9hyv-59
  lib/tdb/common/lock.c          lock.c-20070220022425-m1wibgjq7n5hahs6-7
  lib/tdb/common/tdb.c           tdb.c-20070220022425-m1wibgjq7n5hahs6-9
  lib/tdb/configure.ac           configure.ac-20070125040949-7t3f5zdl1q4z9hyv-65
  lib/tdb/include/tdb.h          tdb.h-20070125040949-7t3f5zdl1q4z9hyv-101
  tests/ctdb_fetch.c             ctdb_fetch.c-20070405031748-f7gslozfj3rwh5ie-1
  tests/ctdb_test.c              ctdb_test.c-20061117234101-o3qt14umlg9en8z0-16
  tests/ctdbd.sh                 ctdbd.sh-20070411085038-phusiewluwzyqjpc-2
  tools/ctdb_control.c           ctdb_control.c-20070426122705-9ehj1l5lu2gn9kuj-1
    ------------------------------------------------------------
    revno: 44.1.233
    merged: tridge@samba.org-20070511072921-1fmloqo3r1uzqxeq
    parent: tridge@samba.org-20070511003343-mdcfsv1todutp5mz
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Fri 2007-05-11 17:29:21 +1000
    message:
      fixed debug message
    ------------------------------------------------------------
    revno: 44.1.232
    merged: tridge@samba.org-20070511003343-mdcfsv1todutp5mz
    parent: tridge@samba.org-20070510074345-gp2mm5z8rqhytnvu
    parent: sahlberg@ronnie-20070510200817-cd0cc3a541930600
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Fri 2007-05-11 10:33:43 +1000
    message:
      - merge from ronnie
      - increment rsn only in become_dmaster
      - add torture check for rsn regression in ctdb_ltdb_store
        ------------------------------------------------------------
        revno: 44.1.153.1.100
        merged: sahlberg@ronnie-20070510200817-cd0cc3a541930600
        parent: sahlberg@ronnie-20070510194011-4b6a20e4195d6b18
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Fri 2007-05-11 06:08:17 +1000
        message:
          we must bump the rsn everytime we do a REQ_DMASTER or a REPLY_DMASTER
          to make sure that the "merge records based on rsn during recovery" will
          merge correctly.
          
          this is extra important since samba3 never bumps the record when it 
          writes new data to it !
        ------------------------------------------------------------
        revno: 44.1.153.1.99
        merged: sahlberg@ronnie-20070510194011-4b6a20e4195d6b18
        parent: sahlberg@ronnie-20070510075951-10d944d8d76842c0
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Fri 2007-05-11 05:40:11 +1000
        message:
          make ctdb_control catdb work again
        ------------------------------------------------------------
        revno: 44.1.153.1.98
        merged: sahlberg@ronnie-20070510075951-10d944d8d76842c0
        parent: sahlberg@ronnie-20070510001058-a7ac6eddce1344a8
        parent: tridge@samba.org-20070510074345-gp2mm5z8rqhytnvu
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Thu 2007-05-10 17:59:51 +1000
        message:
          merge from tridge
    ------------------------------------------------------------
    revno: 44.1.231
    merged: tridge@samba.org-20070510074345-gp2mm5z8rqhytnvu
    parent: tridge@samba.org-20070510074308-pfgaxsep5jj1v3w4
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-10 17:43:45 +1000
    message:
      - got rid of the complex hand marshalling in the recovery controls
      
      - fixed the re-send of ctdb calls after a generation change
      
      - fixed a reqid idr leak in controls
      
      - removed the write_record test code
      
      - use the new nonblock lockall code to prevent ctdbd from ever doing a
        blocking lock that could deadlock with smbd
      
      - moved more of the recovery controls into ctdb_recover.c
    ------------------------------------------------------------
    revno: 44.1.230
    merged: tridge@samba.org-20070510074308-pfgaxsep5jj1v3w4
    parent: tridge@samba.org-20070510040648-0lwu9l2b8vl3zq86
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-10 17:43:08 +1000
    message:
      added nonblocking varients of the two lockall functions to tdb
    ------------------------------------------------------------
    revno: 44.1.229
    merged: tridge@samba.org-20070510040648-0lwu9l2b8vl3zq86
    parent: tridge@samba.org-20070510031558-ckupssp96wzoohkd
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-10 14:06:48 +1000
    message:
      better timeout handling for calls, controls and traverses
    ------------------------------------------------------------
    revno: 44.1.228
    merged: tridge@samba.org-20070510031558-ckupssp96wzoohkd
    parent: tridge@samba.org-20070510031023-yhipc23awqwfed3s
    parent: sahlberg@ronnie-20070510001058-a7ac6eddce1344a8
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-10 13:15:58 +1000
    message:
      merge from ronnie
        ------------------------------------------------------------
        revno: 44.1.153.1.97
        merged: sahlberg@ronnie-20070510001058-a7ac6eddce1344a8
        parent: sahlberg@ronnie-20070510000321-89f72cadfa94fb77
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Thu 2007-05-10 10:10:58 +1000
        message:
          create a correct vnnmap structure to prevent a segv
        ------------------------------------------------------------
        revno: 44.1.153.1.96
        merged: sahlberg@ronnie-20070510000321-89f72cadfa94fb77
        parent: sahlberg@ronnie-20070509234814-caea2e55dd3bc4e7
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Thu 2007-05-10 10:03:21 +1000
        message:
          update ctdb_control to create a correct ctdb_vnn_map->map array
        ------------------------------------------------------------
        revno: 44.1.153.1.95
        merged: sahlberg@ronnie-20070509234814-caea2e55dd3bc4e7
        parent: sahlberg@ronnie-20070509234610-5cdd047d69014c36
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Thu 2007-05-10 09:48:14 +1000
        message:
          when starting a new election, also force all nodes into recovery mode so 
          there is no internode traffic to interfere with our election
        ------------------------------------------------------------
        revno: 44.1.153.1.94
        merged: sahlberg@ronnie-20070509234610-5cdd047d69014c36
        parent: sahlberg@ronnie-20070509234428-38b8689cb7bd25fe
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Thu 2007-05-10 09:46:10 +1000
        message:
          when starting recovery repoint dmaster to an invalid node and not the 
          current vnn
        ------------------------------------------------------------
        revno: 44.1.153.1.93
        merged: sahlberg@ronnie-20070509234428-38b8689cb7bd25fe
        parent: sahlberg@ronnie-20070509234301-c9fe15e2fffd523e
        parent: tridge@samba.org-20070509222226-gxev7f84ugyfdkti
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Thu 2007-05-10 09:44:28 +1000
        message:
          merge from tridge
        ------------------------------------------------------------
        revno: 44.1.153.1.92
        merged: sahlberg@ronnie-20070509234301-c9fe15e2fffd523e
        parent: sahlberg@ronnie-20070509205528-ea549e31fa9af90b
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Thu 2007-05-10 09:43:01 +1000
        message:
          actually check the remote nodes and not just the local node
        ------------------------------------------------------------
        revno: 44.1.153.1.91
        merged: sahlberg@ronnie-20070509205528-ea549e31fa9af90b
        parent: sahlberg@ronnie-20070509040811-460ac8e7d6691f7f
        parent: tridge@samba.org-20070509015437-c9u6pubosc3jz0um
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Thu 2007-05-10 06:55:28 +1000
        message:
          merge from tridge
    ------------------------------------------------------------
    revno: 44.1.227
    merged: tridge@samba.org-20070510031023-yhipc23awqwfed3s
    parent: tridge@samba.org-20070509224957-9l3bc1ay2rluro28
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-10 13:10:23 +1000
    message:
      setup the random number generator a bit better
    ------------------------------------------------------------
    revno: 44.1.226
    merged: tridge@samba.org-20070509224957-9l3bc1ay2rluro28
    parent: tridge@samba.org-20070509222226-gxev7f84ugyfdkti
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-10 08:49:57 +1000
    message:
      remove old s3 recovery code
      fixed vnnmap wire format in recover daemon
    ------------------------------------------------------------
    revno: 44.1.225
    merged: tridge@samba.org-20070509222226-gxev7f84ugyfdkti
    parent: tridge@samba.org-20070509221319-2i6pfo0e6gudc6dz
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-10 08:22:26 +1000
    message:
      fixed setvnnmap to use wire structures too
    ------------------------------------------------------------
    revno: 44.1.224
    merged: tridge@samba.org-20070509221319-2i6pfo0e6gudc6dz
    parent: tridge@samba.org-20070509215546-6s0mhsloyilervjf
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-10 08:13:19 +1000
    message:
      separate the wire format and internal format for the vnn_map
    ------------------------------------------------------------
    revno: 44.1.223
    merged: tridge@samba.org-20070509215546-6s0mhsloyilervjf
    parent: tridge@samba.org-20070509214318-io4xhj2e6k91eosm
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-10 07:55:46 +1000
    message:
      moved the vnn_map initialisation out of the cmdline code
    ------------------------------------------------------------
    revno: 44.1.222
    merged: tridge@samba.org-20070509214318-io4xhj2e6k91eosm
    parent: tridge@samba.org-20070509015437-c9u6pubosc3jz0um
    parent: sahlberg@ronnie-20070509040811-460ac8e7d6691f7f
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-10 07:43:18 +1000
    message:
      merged ronnies code to delay client requests when in recovery mode
        ------------------------------------------------------------
        revno: 44.1.153.1.90
        merged: sahlberg@ronnie-20070509040811-460ac8e7d6691f7f
        parent: sahlberg@ronnie-20070509040647-f8724a40b8a205e5
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Wed 2007-05-09 14:08:11 +1000
        message:
          hang the event from the retry structure instead of the hdr structure
        ------------------------------------------------------------
        revno: 44.1.153.1.89
        merged: sahlberg@ronnie-20070509040647-f8724a40b8a205e5
        parent: sahlberg@ronnie-20070508235923-78a4589b69fa8935
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Wed 2007-05-09 14:06:47 +1000
        message:
          when we are in recovery mode and we get a REQ_CALL from a client,
          defer it for one second and try again   
    ------------------------------------------------------------
    revno: 44.1.221
    merged: tridge@samba.org-20070509015437-c9u6pubosc3jz0um
    parent: tridge@samba.org-20070508111629-cgamk1fazmat0dog
    parent: sahlberg@ronnie-20070508235923-78a4589b69fa8935
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Wed 2007-05-09 11:54:37 +1000
    message:
      merge from ronnie
        ------------------------------------------------------------
        revno: 44.1.153.1.88
        merged: sahlberg@ronnie-20070508235923-78a4589b69fa8935
        parent: sahlberg@ronnie-20070508233153-a5fc5d5efade086d
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Wed 2007-05-09 09:59:23 +1000
        message:
          add a command line flag to ctdbd to start a recovery daemon.
          
          update the recovery test script to start all ctdb daemons with a 
          recovery daemon
        ------------------------------------------------------------
        revno: 44.1.153.1.87
        merged: sahlberg@ronnie-20070508233153-a5fc5d5efade086d
        parent: sahlberg@ronnie-20070508220553-7d7bb02b7a822678
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Wed 2007-05-09 09:31:53 +1000
        message:
          change the name of the recovery daemon to ctdb_recoverd
        ------------------------------------------------------------
        revno: 44.1.153.1.86
        merged: sahlberg@ronnie-20070508220553-7d7bb02b7a822678
        parent: sahlberg@ronnie-20070508045155-5aa31feeab7611e4
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Wed 2007-05-09 08:05:53 +1000
        message:
          add a small tool to monitor recovery
        ------------------------------------------------------------
        revno: 44.1.153.1.85
        merged: sahlberg@ronnie-20070508045155-5aa31feeab7611e4
        parent: sahlberg@ronnie-20070508044200-c535ef000d25dde9
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Tue 2007-05-08 14:51:55 +1000
        message:
          we must repoint dmaster to an invalid node during recovery to stop the 
          shortcut from working
        ------------------------------------------------------------
        revno: 44.1.153.1.84
        merged: sahlberg@ronnie-20070508044200-c535ef000d25dde9
        parent: sahlberg@ronnie-20070506220726-342d114d8479620e
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Tue 2007-05-08 14:42:00 +1000
        message:
          fix alignment bug for pulldb
        ------------------------------------------------------------
        revno: 44.1.153.1.83
        merged: sahlberg@ronnie-20070506220726-342d114d8479620e
        parent: sahlberg@ronnie-20070506215417-d96e79c116240aad
        parent: tridge@samba.org-20070506215638-67wvsh0zwt7bbllo
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Mon 2007-05-07 08:07:26 +1000
        message:
          merge from tridge
    ------------------------------------------------------------
    revno: 44.1.220
    merged: tridge@samba.org-20070508111629-cgamk1fazmat0dog
    parent: tridge@samba.org-20070506215638-67wvsh0zwt7bbllo
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Tue 2007-05-08 21:16:29 +1000
    message:
      fixed a problem with the number of timed events growing without bound with the new seqnum code
    ------------------------------------------------------------
    revno: 44.1.219
    merged: tridge@samba.org-20070506215638-67wvsh0zwt7bbllo
    parent: tridge@samba.org-20070505074654-1cs2rodrtlo3dkjk
    parent: sahlberg@ronnie-20070506215417-d96e79c116240aad
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Mon 2007-05-07 07:56:38 +1000
    message:
      merged from ronnie
        ------------------------------------------------------------
        revno: 44.1.153.1.82
        merged: sahlberg@ronnie-20070506215417-d96e79c116240aad
        parent: sahlberg@ronnie-20070506214716-d88b489c9db3b15c
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Mon 2007-05-07 07:54:17 +1000
        message:
          hang the timeout event off state   and thus we dont need to explicitely 
          free it   and also we wont accidentally return from the function without 
          killing the event first
        ------------------------------------------------------------
        revno: 44.1.153.1.81
        merged: sahlberg@ronnie-20070506214716-d88b489c9db3b15c
        parent: sahlberg@ronnie-20070506205158-a1110272a8a362ad
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Mon 2007-05-07 07:47:16 +1000
        message:
          it now works to talloc_free() the timed event if we no longer want it to 
          trigger
          
          this must have been a sideeffect of a different bug in the recoverd.c 
          code that has now been fixed
        ------------------------------------------------------------
        revno: 44.1.153.1.80
        merged: sahlberg@ronnie-20070506205158-a1110272a8a362ad
        parent: sahlberg@ronnie-20070506190248-95317ce2ee808aa3
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Mon 2007-05-07 06:51:58 +1000
        message:
          recovery daemon with recovery master election
          
          election is primitive, it elects the lowest vnn as the recovery master
          
          two new controls, to get/set recovery master for a node
          
          
          
          to use recovery daemon,   start one  
          ./bin/recoverd --socket=ctdb.socket*
          for each ctdb daemon
          
          
          it has been briefly tested by deleting and adding nodes to a 4 node 
          cluster but needs more testing
        ------------------------------------------------------------
        revno: 44.1.153.1.79
        merged: sahlberg@ronnie-20070506190248-95317ce2ee808aa3
        parent: sahlberg@ronnie-20070506184112-5da5d1b472919956
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Mon 2007-05-07 05:02:48 +1000
        message:
          add new controls to get and set the recovery master node of a daemon
          i.e. which node is "elected" to check for and drive recovery
        ------------------------------------------------------------
        revno: 44.1.153.1.78
        merged: sahlberg@ronnie-20070506184112-5da5d1b472919956
        parent: sahlberg@ronnie-20070506024656-54065db42fc80030
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Mon 2007-05-07 04:41:12 +1000
        message:
          add a test in the function that checks whether the cluster needs 
          recovery or not  that all active nodes are in normal mode.
          If we discover that some node is still in recoverymode it may indicate 
          that a previous recovery ended prematurely and thus we should start a 
          new recovery 
        ------------------------------------------------------------
        revno: 44.1.153.1.77
        merged: sahlberg@ronnie-20070506024656-54065db42fc80030
        parent: sahlberg@ronnie-20070506005125-24f5190be388d944
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 12:46:56 +1000
        message:
          update a comment to be more desciptive
        ------------------------------------------------------------
        revno: 44.1.153.1.76
        merged: sahlberg@ronnie-20070506005125-24f5190be388d944
        parent: sahlberg@ronnie-20070506004218-e5dc99fda5598e6e
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 10:51:25 +1000
        message:
          change a lot of printf into debug statements
        ------------------------------------------------------------
        revno: 44.1.153.1.75
        merged: sahlberg@ronnie-20070506004218-e5dc99fda5598e6e
        parent: sahlberg@ronnie-20070506003844-cfa2e54767c22f74
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 10:42:18 +1000
        message:
          break out the code to update all nodes to the new vnnmap into a helper 
          function
        ------------------------------------------------------------
        revno: 44.1.153.1.74
        merged: sahlberg@ronnie-20070506003844-cfa2e54767c22f74
        parent: sahlberg@ronnie-20070506003018-5b7bebe70235b0fb
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 10:38:44 +1000
        message:
          create a helper function for recovery to push all local databases out 
          onto the remote nodes
        ------------------------------------------------------------
        revno: 44.1.153.1.73
        merged: sahlberg@ronnie-20070506003018-5b7bebe70235b0fb
        parent: sahlberg@ronnie-20070506002213-9ad049359f13100b
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 10:30:18 +1000
        message:
          add an extra blank line
        ------------------------------------------------------------
        revno: 44.1.153.1.72
        merged: sahlberg@ronnie-20070506002213-9ad049359f13100b
        parent: sahlberg@ronnie-20070506001648-69c865e04dda39ce
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 10:22:13 +1000
        message:
          break the code that repoints dmaster for all local and remote records 
          into a separate helper function
        ------------------------------------------------------------
        revno: 44.1.153.1.71
        merged: sahlberg@ronnie-20070506001648-69c865e04dda39ce
        parent: sahlberg@ronnie-20070506001242-2ad8fec87f6dea8b
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 10:16:48 +1000
        message:
          create a helper function for recovery that pulls and merges all remote 
          databases onto the local node
        ------------------------------------------------------------
        revno: 44.1.153.1.70
        merged: sahlberg@ronnie-20070506001242-2ad8fec87f6dea8b
        parent: sahlberg@ronnie-20070506000437-f1ba6eb009903e0e
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 10:12:42 +1000
        message:
          create a helper function to make sure the local node that does recovery 
          has all the databases that exist on any other remote node
        ------------------------------------------------------------
        revno: 44.1.153.1.69
        merged: sahlberg@ronnie-20070506000437-f1ba6eb009903e0e
        parent: sahlberg@ronnie-20070505235312-47eb2e7327632b8f
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 10:04:37 +1000
        message:
          add a helper function to create all missing remote databases detected 
          during recovery
        ------------------------------------------------------------
        revno: 44.1.153.1.68
        merged: sahlberg@ronnie-20070505235312-47eb2e7327632b8f
        parent: sahlberg@ronnie-20070505220522-a85200c3738602cb
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 09:53:12 +1000
        message:
          break out the setting/clearing of recovery mode into a dedicated helper 
          function
        ------------------------------------------------------------
        revno: 44.1.153.1.67
        merged: sahlberg@ronnie-20070505220522-a85200c3738602cb
        parent: sahlberg@ronnie-20070505215220-9645a5e6c1f75971
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 08:05:22 +1000
        message:
          dont allocate arrays where we can just return a single integer
        ------------------------------------------------------------
        revno: 44.1.153.1.66
        merged: sahlberg@ronnie-20070505215220-9645a5e6c1f75971
        parent: sahlberg@ronnie-20070505213216-a6ffc7923cad6b0c
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 07:52:20 +1000
        message:
          dont use arrays where a uint32_t works just as well
        ------------------------------------------------------------
        revno: 44.1.153.1.65
        merged: sahlberg@ronnie-20070505213216-a6ffc7923cad6b0c
        parent: sahlberg@ronnie-20070505210747-ae90637e16bf5cb7
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 07:32:16 +1000
        message:
          add a ifdeffed out block to the call.
          
          we really should kill the event in case the call completed before the 
          timeout   so that we can also make timed_out non-static
        ------------------------------------------------------------
        revno: 44.1.153.1.64
        merged: sahlberg@ronnie-20070505210747-ae90637e16bf5cb7
        parent: sahlberg@ronnie-20070505205801-e674f5fc04467b37
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 07:07:47 +1000
        message:
          hte timed_out variable needs to be static and can not be on the stack   
          since if the command times out and we return from ctdb_control   we may 
          have events that can trigger later which will overwrite data that is no 
          longer in our stackframe
        ------------------------------------------------------------
        revno: 44.1.153.1.63
        merged: sahlberg@ronnie-20070505205801-e674f5fc04467b37
        parent: sahlberg@ronnie-20070505200639-0d19e58cc0e77781
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 06:58:01 +1000
        message:
          update to rhe recovery daemon
          ctdb_ctrl_ calls are timedout due to nodes arriving or leaving the 
          cluster it crashes the recovery daemon afterwards with a SEGV but no 
          useful stack backtrace
        ------------------------------------------------------------
        revno: 44.1.153.1.62
        merged: sahlberg@ronnie-20070505200639-0d19e58cc0e77781
        parent: sahlberg@ronnie-20070505195315-2f67bc95926668e5
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 06:06:39 +1000
        message:
          in the recover test
          start the daemons with explicit socketnames and explicit ip address/port
          
          remove all --socket=  from all ctdb_control calls since they are not 
          needed anymore
        ------------------------------------------------------------
        revno: 44.1.153.1.61
        merged: sahlberg@ronnie-20070505195315-2f67bc95926668e5
        parent: sahlberg@ronnie-20070505183841-3ee39c2e0abe51ca
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 05:53:15 +1000
        message:
          add support in catdb to dump the content of a specific nodes tdb instead 
          of traversing the full cluster.
          this makes it easier to debug recovery
          
          update the test script for recovery to reflect the newish signatures to
          ctdb_control
          
          
          
          the catdb control does still segfault however when there are missing 
          nodes in the cluster   as there are toward the end of the recovery test
        ------------------------------------------------------------
        revno: 44.1.153.1.60
        merged: sahlberg@ronnie-20070505183841-3ee39c2e0abe51ca
        parent: sahlberg@ronnie-20070505183122-09dfca19dab5ec41
        parent: tridge@samba.org-20070505074654-1cs2rodrtlo3dkjk
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 04:38:41 +1000
        message:
          merge from tridge
        ------------------------------------------------------------
        revno: 44.1.153.1.59
        merged: sahlberg@ronnie-20070505183122-09dfca19dab5ec41
        parent: sahlberg@ronnie-20070505065134-e92a7a2ea17d523b
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sun 2007-05-06 04:31:22 +1000
        message:
          add a control to get the pid of a daemon.
          this makes it possible to kill a specific daemon in the recover test 
          script
        ------------------------------------------------------------
        revno: 44.1.153.1.58
        merged: sahlberg@ronnie-20070505065134-e92a7a2ea17d523b
        parent: sahlberg@ronnie-20070505031726-667ed50c2053a8aa
        parent: tridge@samba.org-20070505040946-iji1cxsyb8ail7bk
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sat 2007-05-05 16:51:34 +1000
        message:
          merge from tridge
    ------------------------------------------------------------
    revno: 44.1.218
    merged: tridge@samba.org-20070505074654-1cs2rodrtlo3dkjk
    parent: tridge@samba.org-20070505073528-7a0k8rak6j00p6bl
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Sat 2007-05-05 17:46:54 +1000
    message:
      merge relevant lib code from samba4
    ------------------------------------------------------------
    revno: 44.1.217
    merged: tridge@samba.org-20070505073528-7a0k8rak6j00p6bl
    parent: tridge@samba.org-20070505071959-wvf5a3e37mch3vy3
    parent: sahlberg@ronnie-20070505031726-667ed50c2053a8aa
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Sat 2007-05-05 17:35:28 +1000
    message:
      merged vnn map broadcast from ronnie
        ------------------------------------------------------------
        revno: 44.1.153.1.57
        merged: sahlberg@ronnie-20070505031726-667ed50c2053a8aa
        parent: sahlberg@ronnie-20070505014644-64544864493dc596
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sat 2007-05-05 13:17:26 +1000
        message:
          split the vnn broadcast address into two
          one broadcast address for all nodes
          and one broadcast address for all nodes in the current vnnmap
          
          update all useage of the old flag to now only broadcast to the vnnmap
          except for tools/ctdb_control where it makes more sense to broadcast to 
          all nodes
        ------------------------------------------------------------
        revno: 44.1.153.1.56
        merged: sahlberg@ronnie-20070505014644-64544864493dc596
        parent: sahlberg@ronnie-20070504152230-2e8efa9c50c6791a
        parent: tridge@samba.org-20070505010310-wlknjyla4cqkbdld
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sat 2007-05-05 11:46:44 +1000
        message:
          merge from tridge
    ------------------------------------------------------------
    revno: 44.1.216
    merged: tridge@samba.org-20070505071959-wvf5a3e37mch3vy3
    parent: tridge@samba.org-20070505071843-gdt3kgn66sa3xds0
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Sat 2007-05-05 17:19:59 +1000
    message:
      - take advantage of the new EVENT_FD_AUTOCLOSE flag
      - use the tdb_chainlock_mark() call to allow us to guarantee forward progress in the ctdb_lockwait code
    ------------------------------------------------------------
    revno: 44.1.215
    merged: tridge@samba.org-20070505071843-gdt3kgn66sa3xds0
    parent: tridge@samba.org-20070505071806-hatj3yhl0nl335p3
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Sat 2007-05-05 17:18:43 +1000
    message:
      allow the events system to be chosen on the command line
    ------------------------------------------------------------
    revno: 44.1.214
    merged: tridge@samba.org-20070505071806-hatj3yhl0nl335p3
    parent: tridge@samba.org-20070505071725-5n1dbqmzop11bmcp
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Sat 2007-05-05 17:18:06 +1000
    message:
      use the new lib/events autoconf code
    ------------------------------------------------------------
    revno: 44.1.213
    merged: tridge@samba.org-20070505071725-5n1dbqmzop11bmcp
    parent: tridge@samba.org-20070505071433-i3i06lprinozpxhe
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Sat 2007-05-05 17:17:25 +1000
    message:
      - added a EVENT_FD_AUTOCLOSE flag that allows you to tell the event system to close the fd automatically when a fd_event is freed. This prevents races which can lead to epoll missing events
      - added autoconf rules for automatically building with epoll support
    ------------------------------------------------------------
    revno: 44.1.212
    merged: tridge@samba.org-20070505071433-i3i06lprinozpxhe
    parent: tridge@samba.org-20070505040946-iji1cxsyb8ail7bk
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Sat 2007-05-05 17:14:33 +1000
    message:
      added tdb_chainlock_mark() call, which can be used to mark a chain locked without actually locking it. This will be used to guarantee forward progress in the ctdb non-blocking lockwait code
    ------------------------------------------------------------
    revno: 44.1.211
    merged: tridge@samba.org-20070505040946-iji1cxsyb8ail7bk
    parent: tridge@samba.org-20070505010310-wlknjyla4cqkbdld
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Sat 2007-05-05 14:09:46 +1000
    message:
      show number of connected clients in status output
    ------------------------------------------------------------
    revno: 44.1.210
    merged: tridge@samba.org-20070505010310-wlknjyla4cqkbdld
    parent: tridge@samba.org-20070504223335-oai3wi0jsmp8ywwp
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Sat 2007-05-05 11:03:10 +1000
    message:
      added a dumpmemory control, used to find memory leaks
    ------------------------------------------------------------
    revno: 44.1.209
    merged: tridge@samba.org-20070504223335-oai3wi0jsmp8ywwp
    parent: tridge@samba.org-20070504221154-bzrdobzto7dh90ze
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Sat 2007-05-05 08:33:35 +1000
    message:
      - fixed a crash bug after client disconnect in ctdb_control
      - added total memory used to ctdb_control status output
    ------------------------------------------------------------
    revno: 44.1.208
    merged: tridge@samba.org-20070504221154-bzrdobzto7dh90ze
    parent: tridge@samba.org-20070504213923-5u40be09hum8yclu
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Sat 2007-05-05 08:11:54 +1000
    message:
      - added counters for controls in ctdb_control status
    ------------------------------------------------------------
    revno: 44.1.207
    merged: tridge@samba.org-20070504213923-5u40be09hum8yclu
    parent: tridge@samba.org-20070504121800-qg2ked2z7jg5eywl
    parent: sahlberg@ronnie-20070504152230-2e8efa9c50c6791a
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Sat 2007-05-05 07:39:23 +1000
    message:
      merged from ronnie
        ------------------------------------------------------------
        revno: 44.1.153.1.55
        merged: sahlberg@ronnie-20070504152230-2e8efa9c50c6791a
        parent: sahlberg@ronnie-20070504070528-02cb56ca5c37e8d8
        parent: tridge@samba.org-20070504121800-qg2ked2z7jg5eywl
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Sat 2007-05-05 01:22:30 +1000
        message:
          merge from tridge
        ------------------------------------------------------------
        revno: 44.1.153.1.54
        merged: sahlberg@ronnie-20070504070528-02cb56ca5c37e8d8
        parent: sahlberg@ronnie-20070504052557-558731e832131140
        parent: tridge@samba.org-20070504032530-ni45j80aucjdgxfe
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Fri 2007-05-04 17:05:28 +1000
        message:
          merge from tridge
        ------------------------------------------------------------
        revno: 44.1.153.1.53
        merged: sahlberg@ronnie-20070504052557-558731e832131140
        parent: sahlberg@ronnie-20070504052140-b809d96139570fb5
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Fri 2007-05-04 15:25:57 +1000
        message:
          remove a exit from the test script
        ------------------------------------------------------------
        revno: 44.1.153.1.52
        merged: sahlberg@ronnie-20070504052140-b809d96139570fb5
        parent: sahlberg@ronnie-20070504015745-d868b2ec34e8a893
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Fri 2007-05-04 15:21:40 +1000
        message:
          recovery daemon
          
          this program is a client to the local ctdb daemon
          
          every second it pulls all vnnmap and nodemaps from all nodes that are 
          available and checks if a recovery is required
          
          a recovery is required if :
          * all nodes do NOT have an identical vnnmap and generation
          * all nodes do NOT have an identical nodemap
          * there are active nodes that are NOT in the nodemap
          * there are nodes in the nodemap that are NOT active
          
          During recovery,  the recovery tool will also make sure that all nodes 
          know about and have created all databases.
        ------------------------------------------------------------
        revno: 44.1.153.1.51
        merged: sahlberg@ronnie-20070504015745-d868b2ec34e8a893
        parent: sahlberg@ronnie-20070504015107-7ed0989f18a1fe6c
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Fri 2007-05-04 11:57:45 +1000
        message:
          also verify that the generation id is the same on all the nodes and if 
          not, trigger a recovery
        ------------------------------------------------------------
        revno: 44.1.153.1.50
        merged: sahlberg@ronnie-20070504015107-7ed0989f18a1fe6c
        parent: sahlberg@ronnie-20070503234553-4bf967bca57c0ba6
        parent: tridge@samba.org-20070504014129-3vxt4shmb042ov3d
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Fri 2007-05-04 11:51:07 +1000
        message:
          merge from tridge
    ------------------------------------------------------------
    revno: 44.1.206
    merged: tridge@samba.org-20070504121800-qg2ked2z7jg5eywl
    parent: tridge@samba.org-20070504053328-94qersgg4p3pmr1r
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Fri 2007-05-04 22:18:00 +1000
    message:
      added seqnum propogation code to ctdb
    ------------------------------------------------------------
    revno: 44.1.205
    merged: tridge@samba.org-20070504053328-94qersgg4p3pmr1r
    parent: tridge@samba.org-20070504052910-297ykux8e77ka6p0
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Fri 2007-05-04 15:33:28 +1000
    message:
      added a ctdb control for enabling the tdb seqnum
    ------------------------------------------------------------
    revno: 44.1.204
    merged: tridge@samba.org-20070504052910-297ykux8e77ka6p0
    parent: tridge@samba.org-20070504032530-ni45j80aucjdgxfe
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Fri 2007-05-04 15:29:10 +1000
    message:
      added a tdb_enable_seqnum() function
    ------------------------------------------------------------
    revno: 44.1.203
    merged: tridge@samba.org-20070504032530-ni45j80aucjdgxfe
    parent: tridge@samba.org-20070504021839-0d8138o2tzki943u
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Fri 2007-05-04 13:25:30 +1000
    message:
      make catdb take a dbname instead of an id
    ------------------------------------------------------------
    revno: 44.1.202
    merged: tridge@samba.org-20070504021839-0d8138o2tzki943u
    parent: tridge@samba.org-20070504014129-3vxt4shmb042ov3d
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Fri 2007-05-04 12:18:39 +1000
    message:
      nicer interface to ctdb traverse
    ------------------------------------------------------------
    revno: 44.1.201
    merged: tridge@samba.org-20070504014129-3vxt4shmb042ov3d
    parent: tridge@samba.org-20070504004339-kn6qu8t7ek3z1co5
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Fri 2007-05-04 11:41:29 +1000
    message:
      - changed the REQ_REGISTER PDU to be a control
      
      - allow controls to know which client invoked them
      
      - added a client_id to clients, so they can be identified remotely
      
      - added the ability to remove registered srvids
      
      - in the list_keys code, register a temp srvid, then remove it afterwards
    ------------------------------------------------------------
    revno: 44.1.200
    merged: tridge@samba.org-20070504004339-kn6qu8t7ek3z1co5
    parent: tridge@samba.org-20070503071223-l9hybdfd0lwdswu0
    parent: sahlberg@ronnie-20070503234553-4bf967bca57c0ba6
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Fri 2007-05-04 10:43:39 +1000
    message:
      merge from ronnie
        ------------------------------------------------------------
        revno: 44.1.153.1.49
        merged: sahlberg@ronnie-20070503234553-4bf967bca57c0ba6
        parent: sahlberg@ronnie-20070503230101-9fc8d7cbbc2fc6b8
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Fri 2007-05-04 09:45:53 +1000
        message:
          update getvnnmap control to take a timeout parameter
          dont explicitely free the vnnmap pointer in the getvnnmap control  this 
          is freed by the mem_ctx instead
          
          add code to the recoverd to detect when/if recovery is required
          veiry that the number of active nodes, the nodemap and the vnn map is 
          consistent across the entire cluster and if not   trigger a recovery 
          (which right now just prints "we need to do recovery" to the screen.
        ------------------------------------------------------------
        revno: 44.1.153.1.48
        merged: sahlberg@ronnie-20070503230101-9fc8d7cbbc2fc6b8
        parent: sahlberg@ronnie-20070503223202-6defdbe314660e83
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Fri 2007-05-04 09:01:01 +1000
        message:
          change the signature for ctdb_ctrl_getnodemap() so that a timeout 
          parameter is added.
          change ctdb_get_connected_nodes in the same way
        ------------------------------------------------------------
        revno: 44.1.153.1.47
        merged: sahlberg@ronnie-20070503223202-6defdbe314660e83
        parent: sahlberg@ronnie-20070503223018-0799fc78283a686f
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Fri 2007-05-04 08:32:02 +1000
        message:
          ctdb_control should use the provided timeout and not hardcode to 1.0 
          seconds
        ------------------------------------------------------------
        revno: 44.1.153.1.46
        merged: sahlberg@ronnie-20070503223018-0799fc78283a686f
        parent: sahlberg@ronnie-20070503071638-802462107800a0a8
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Fri 2007-05-04 08:30:18 +1000
        message:
          start working on a recovery daemon
          
          change ctdb_control so it takes a timeval pointer as argument.
          this is the timeout. if the node has not responded within hte timeout
          ctdb_control will return an error instead of hanging.
          if the timeval pointer is NULL then the call will block indefinitely if 
          there is no response.
          
          this is used for now in the createdb control   but all the helpers 
          ctdb_ctrl_* should probably be updated to take a timeout parameter as 
          well.
        ------------------------------------------------------------
        revno: 44.1.153.1.45
        merged: sahlberg@ronnie-20070503071638-802462107800a0a8
        parent: sahlberg@ronnie-20070503061803-7e09396b07253194
        parent: tridge@samba.org-20070503071223-l9hybdfd0lwdswu0
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Thu 2007-05-03 17:16:38 +1000
        message:
          merge from tridge
        ------------------------------------------------------------
        revno: 44.1.153.1.44
        merged: sahlberg@ronnie-20070503061803-7e09396b07253194
        parent: sahlberg@ronnie-20070503044253-a4389b52c03c42ba
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Thu 2007-05-03 16:18:03 +1000
        message:
          cleanup the control "write record"
        ------------------------------------------------------------
        revno: 44.1.153.1.43
        merged: sahlberg@ronnie-20070503044253-a4389b52c03c42ba
        parent: sahlberg@ronnie-20070503033038-5042e3eb473e382c
        parent: tridge@samba.org-20070503035354-r8chwmgxqwl5o8fx
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Thu 2007-05-03 14:42:53 +1000
        message:
          merge from tridge
    ------------------------------------------------------------
    revno: 44.1.199
    merged: tridge@samba.org-20070503071223-l9hybdfd0lwdswu0
    parent: tridge@samba.org-20070503035354-r8chwmgxqwl5o8fx
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-03 17:12:23 +1000
    message:
      first version of traverse is working
    ------------------------------------------------------------
    revno: 44.1.198
    merged: tridge@samba.org-20070503035354-r8chwmgxqwl5o8fx
    parent: tridge@samba.org-20070503034427-cafju1wds7214w62
    parent: sahlberg@ronnie-20070503033038-5042e3eb473e382c
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-03 13:53:54 +1000
    message:
      merged from ronnie
        ------------------------------------------------------------
        revno: 44.1.153.1.42
        merged: sahlberg@ronnie-20070503033038-5042e3eb473e382c
        parent: sahlberg@ronnie-20070503030734-4752259c9631bf82
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Thu 2007-05-03 13:30:38 +1000
        message:
          cleanup getnodemap
        ------------------------------------------------------------
        revno: 44.1.153.1.41
        merged: sahlberg@ronnie-20070503030734-4752259c9631bf82
        parent: sahlberg@ronnie-20070503010624-725efe92ef4466ad
        parent: tridge@samba.org-20070503011301-1nqmvtrhlnzcd6i7
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Thu 2007-05-03 13:07:34 +1000
        message:
          fixup getdbmap control so it looks a bit nicer
    ------------------------------------------------------------
    revno: 44.1.197
    merged: tridge@samba.org-20070503034427-cafju1wds7214w62
    parent: tridge@samba.org-20070503021603-p9q4auw135pzf905
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-03 13:44:27 +1000
    message:
      don't zero beyond packet header unnecessarily
    ------------------------------------------------------------
    revno: 44.1.196
    merged: tridge@samba.org-20070503021603-p9q4auw135pzf905
    parent: tridge@samba.org-20070503011301-1nqmvtrhlnzcd6i7
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-03 12:16:03 +1000
    message:
      first stage of efficient non-blocking ctdb traverse
    ------------------------------------------------------------
    revno: 44.1.195
    merged: tridge@samba.org-20070503011301-1nqmvtrhlnzcd6i7
    parent: tridge@samba.org-20070502214808-txyq9v6djt0tm7m4
    parent: sahlberg@ronnie-20070503010624-725efe92ef4466ad
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-03 11:13:01 +1000
    message:
      merged cleanup from ronnie
        ------------------------------------------------------------
        revno: 44.1.153.1.40
        merged: sahlberg@ronnie-20070503010624-725efe92ef4466ad
        parent: sahlberg@ronnie-20070502212129-ea81e17dee5122ae
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Thu 2007-05-03 11:06:24 +1000
        message:
          break set/get vnn map out from ctdb_control and put it in ctdb_recover.c 
          for the time being
          
          remove all the [de]marshalling and just pass a structure around instead
    ------------------------------------------------------------
    revno: 44.1.194
    merged: tridge@samba.org-20070502214808-txyq9v6djt0tm7m4
    parent: tridge@samba.org-20070502211929-dvwisi77qmhpxz7u
    parent: sahlberg@ronnie-20070502212129-ea81e17dee5122ae
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-03 07:48:08 +1000
    message:
      merge from ronnie
        ------------------------------------------------------------
        revno: 44.1.153.1.39
        merged: sahlberg@ronnie-20070502212129-ea81e17dee5122ae
        parent: sahlberg@ronnie-20070502195245-601cd27bc95d4712
        parent: tridge@samba.org-20070502211929-dvwisi77qmhpxz7u
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Thu 2007-05-03 07:21:29 +1000
        message:
          merge from tridge
        ------------------------------------------------------------
        revno: 44.1.153.1.38
        merged: sahlberg@ronnie-20070502195245-601cd27bc95d4712
        parent: sahlberg@ronnie-20070502120048-4a6d39d2c036946a
        parent: tridge@samba.org-20070502192114-f33n5eur6vzyi8xt
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Thu 2007-05-03 05:52:45 +1000
        message:
          merge from tridge
    ------------------------------------------------------------
    revno: 44.1.193
    merged: tridge@samba.org-20070502211929-dvwisi77qmhpxz7u
    parent: tridge@samba.org-20070502195146-3e77ekh35mpfa42k
    parent: sahlberg@ronnie-20070502120048-4a6d39d2c036946a
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-03 07:19:29 +1000
    message:
      merge from ronnie
        ------------------------------------------------------------
        revno: 44.1.153.1.37
        merged: sahlberg@ronnie-20070502120048-4a6d39d2c036946a
        parent: sahlberg@ronnie-20070502113120-f18e1dc10a714c94
        parent: tridge@samba.org-20070502051111-kol2q81ec0oz8o1k
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Wed 2007-05-02 22:00:48 +1000
        message:
          merge from tridge
        ------------------------------------------------------------
        revno: 44.1.153.1.36
        merged: sahlberg@ronnie-20070502113120-f18e1dc10a714c94
        parent: sahlberg@ronnie-20070502111437-97c77ad0177796e8
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Wed 2007-05-02 21:31:20 +1000
        message:
          do a real recovery by killing a node and then calling the recover 
          control
        ------------------------------------------------------------
        revno: 44.1.153.1.35
        merged: sahlberg@ronnie-20070502111437-97c77ad0177796e8
        parent: sahlberg@ronnie-20070502110002-20b32db806bab4f0
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Wed 2007-05-02 21:14:37 +1000
        message:
          recover.sh test script that build a few database and populates them with 
          a record  then performs a recovery which merges all records onto node 0
        ------------------------------------------------------------
        revno: 44.1.153.1.34
        merged: sahlberg@ronnie-20070502110002-20b32db806bab4f0
        parent: sahlberg@ronnie-20070502033142-06b6c60af183f6b9
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Wed 2007-05-02 21:00:02 +1000
        message:
          add a recover test   change alignment for the pull/push db structures
        ------------------------------------------------------------
        revno: 44.1.153.1.33
        merged: sahlberg@ronnie-20070502033142-06b6c60af183f6b9
        parent: sahlberg@ronnie-20070502031412-4c8d86f68d542932
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Wed 2007-05-02 13:31:42 +1000
        message:
          discard REQ/REPLY DMASTER when generation id is wrong or when in 
          recovery mode
        ------------------------------------------------------------
        revno: 44.1.153.1.32
        merged: sahlberg@ronnie-20070502031412-4c8d86f68d542932
        parent: sahlberg@ronnie-20070502024335-851a396c038c86a8
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Wed 2007-05-02 13:14:12 +1000
        message:
          remove sleep from the fetch test
          
          add a test script to start 4 daemons to test recovery
        ------------------------------------------------------------
        revno: 44.1.153.1.31
        merged: sahlberg@ronnie-20070502024335-851a396c038c86a8
        parent: sahlberg@ronnie-20070502010910-2b2c4f1db2b87767
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Wed 2007-05-02 12:43:35 +1000
        message:
          add a control to create a database
        ------------------------------------------------------------
        revno: 44.1.153.1.30
        merged: sahlberg@ronnie-20070502010910-2b2c4f1db2b87767
        parent: sahlberg@ronnie-20070502010658-31ae7f10fe7e85b2
        committer: Ronnie Sahlberg <sahlberg@ronnie>
        branch nick: ctdb
        timestamp: Wed 2007-05-02 11:09:10 +1000
        message:
          remove test code in the fetch test to keep the daemons running forever 
          (so one has lots of tiume to play with ctdb_control)
    ------------------------------------------------------------
    revno: 44.1.192
    merged: tridge@samba.org-20070502195146-3e77ekh35mpfa42k
    parent: tridge@samba.org-20070502192114-f33n5eur6vzyi8xt
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-03 05:51:46 +1000
    message:
      fixed a memory leak in the ctdb_control code
    ------------------------------------------------------------
    revno: 44.1.191
    merged: tridge@samba.org-20070502192114-f33n5eur6vzyi8xt
    parent: tridge@samba.org-20070502051111-kol2q81ec0oz8o1k
    committer: Andrew Tridgell <tridge@samba.org>
    branch nick: tridge
    timestamp: Thu 2007-05-03 05:21:14 +1000
    message:
      enabled built in popt if system doesn't have it

Diff too large for email (6796, the limit is 1000).

