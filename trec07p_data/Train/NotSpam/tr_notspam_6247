From samba-technical-bounces+ktwarwic=speedy.uwaterloo.ca@lists.samba.org  Mon Apr 30 03:44:18 2007
Return-Path: <samba-technical-bounces+ktwarwic=speedy.uwaterloo.ca@lists.samba.org>
Received: from lists.samba.org (mail.samba.org [66.70.73.150])
	by speedy.uwaterloo.ca (8.12.8/8.12.5) with ESMTP id l3U7iI6w010088
	for <ktwarwic@speedy.uwaterloo.ca>; Mon, 30 Apr 2007 03:44:18 -0400
Received: from dp.samba.org (localhost [127.0.0.1])
	by lists.samba.org (Postfix) with ESMTP id 9F0F9162C2E
	for <ktwarwic@speedy.uwaterloo.ca>; Mon, 30 Apr 2007 07:44:16 +0000 (GMT)
X-Spam-Checker-Version: SpamAssassin 3.1.7 (2006-10-05) on dp.samba.org
X-Spam-Level: 
X-Spam-Status: No, score=-1.6 required=3.8 tests=ALL_TRUSTED,AWL,BAYES_00,
	RCVD_IN_DSBL autolearn=ham version=3.1.7
X-Original-To: samba-technical@samba.org
Delivered-To: samba-technical@samba.org
Received: from [127.0.0.1] (dp [66.70.73.150])
	by lists.samba.org (Postfix) with ESMTP id 94198162B00;
	Mon, 30 Apr 2007 07:43:31 +0000 (GMT)
From: Andrew Bartlett <abartlet@samba.org>
To: Jelmer Vernooij <jelmer@samba.org>
In-Reply-To: <4635A737.3030503@samba.org>
References: <1177862246.6033.44.camel@localhost.localdomain>
	<463594C7.3010807@samba.org>
	<1177915672.31472.16.camel@localhost.localdomain>
	<4635A737.3030503@samba.org>
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature";
	boundary="=-7FEuC+heqYjqTRGNi8JL"
Date: Mon, 30 Apr 2007 09:43:23 +0200
Message-Id: <1177919003.31472.32.camel@localhost.localdomain>
Mime-Version: 1.0
X-Mailer: Evolution 2.10.1 (2.10.1-4.fc7) 
Cc: samba-technical@samba.org
Subject: Re: [SAMBA4] we should create just one test environment
X-BeenThere: samba-technical@lists.samba.org
X-Mailman-Version: 2.1.5
Precedence: list
List-Id: "Discussions on Samba internals. For general questions please
	subscribe to the list samba@samba.org"
	<samba-technical.lists.samba.org>
List-Unsubscribe: <https://lists.samba.org/mailman/listinfo/samba-technical>, 
	<mailto:samba-technical-request@lists.samba.org?subject=unsubscribe>
List-Archive: <http://lists.samba.org/archive/samba-technical>
List-Post: <mailto:samba-technical@lists.samba.org>
List-Help: <mailto:samba-technical-request@lists.samba.org?subject=help>
List-Subscribe: <https://lists.samba.org/mailman/listinfo/samba-technical>,
	<mailto:samba-technical-request@lists.samba.org?subject=subscribe>
Sender: samba-technical-bounces+ktwarwic=speedy.uwaterloo.ca@lists.samba.org
Errors-To: samba-technical-bounces+ktwarwic=speedy.uwaterloo.ca@lists.samba.org
Status: O
Content-Length: 4123
Lines: 101


--=-7FEuC+heqYjqTRGNi8JL
Content-Type: text/plain
Content-Transfer-Encoding: quoted-printable

On Mon, 2007-04-30 at 10:22 +0200, Jelmer Vernooij wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>=20
> Andrew Bartlett wrote:
> > On Mon, 2007-04-30 at 09:03 +0200, Jelmer Vernooij wrote:
> >> Andrew Bartlett wrote:
> >> Nothing prevents test environments for guaranteeing both a dc and two
> >> members will be up, for example.=20
> > I'm asking that that be the default, that we create exactly one test
> > environment for the vast majority of the tests we run. =20
> I don't see what that would add. Why should we set up a domain member if
> we just one need a dc to run against?
>=20
> If we'd have one such "sane default", then there is no point in having
> multiple environments at all.

Indeed, and aside from the value in allowing a 'none' environment, and
possibly the Samba3 stuff, I'm yet to be convinced of the need for
multiple environments.=20

> >> Also, the current code makes it very easy to add support for other
> >> targets (Samba3, for example) that don't support all test environments
> >> (yet).
> >>
> >> Perhaps you would simply like to make sure that all test environments
> >> are set up in 'make testenv' ?=20
> > No, then the tests will constantly differ from the environment in which
> > they are normally run, even worse than the current situation.
> In that case, why not add an ENV=3D variable so you can run "make testenv
> ENV=3Dmember" ? Or perhaps we can simply add "make testenv-dc" and "make
> testenv-member"?
>=20
> We can print out the environment name for failed tests, if that would hel=
p.

I just think it's getting too complex.  It used to be very simple, and
it isn't any more. =20

> > I'm afraid that the selftest setup is becoming too complex to reproduce
> > - I want to be able to easily reproduce any failure in 'make
> > testenv' (which you will recall is my primary work tool), without first
> > wondering 'oh, what environment did it declare, what environment did it
> > get, and what environment do I have now'.
> That will make other things more complex. For example, we'd need to
> change the environment variables to be $DC1_IP, $DC1_USERNAME,
> $DC2_PASSWORD, etc because the tests can be run against either of the
> dcs or domain member.

Well, the first point is that DC1 and DC2 *should* be sharing the same
username and passwords.  The member server will have additional local
users (to verify the local SAM), but the whole point of a member server
is to use the same passwords...

> It also makes things like "make test TESTS=3DSAMR" slower as the
> provisioning is two or three times as slow.

Provisioning for an additional DC should not be particularly expensive.
I expect to do some work to allow two DCs to share a ldb (for one modal
of replication), and for the DRSUAPI replicated case, we just need to
setup a skeleton.=20

> > It doesn't seem too much of a price to always have a simple network
> > running, that contains the DC (or 2), and member servers.  Then we can
> > be very consistent in how our tests run, and are debugged.=20
> It's not just the time it takes to set up the environment, also the fact
> that it makes it harder to support other targets (because of the
> complexity of the environment they need to support) and the inability to
> mix environments.

I really don't understand what you mean here. =20

I don't mind having other environments, but I would much rather one
'test network' than the current fragmented setup.=20

Andrew Bartlett

--=20
Andrew Bartlett                                http://samba.org/~abartlet/
Authentication Developer, Samba Team           http://samba.org
Samba Developer, Red Hat Inc.                  http://redhat.com


--=-7FEuC+heqYjqTRGNi8JL
Content-Type: application/pgp-signature; name=signature.asc
Content-Description: This is a digitally signed message part

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.7 (GNU/Linux)

iD8DBQBGNZ4az4A8Wyi0NrsRAnJNAKCIsPF9IefHUiTixVmtsQdZRu0uzwCfRGqG
bk3N7y9waEo0yM9PQ6jxIVQ=
=Cg2t
-----END PGP SIGNATURE-----

--=-7FEuC+heqYjqTRGNi8JL--

